/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[12],{132:function(e,t,a){"use strict";a.d(t,"i",(function(){return p})),a.d(t,"d",(function(){return b})),a.d(t,"f",(function(){return f})),a.d(t,"j",(function(){return E})),a.d(t,"k",(function(){return g})),a.d(t,"h",(function(){return h})),a.d(t,"g",(function(){return x})),a.d(t,"a",(function(){return y})),a.d(t,"e",(function(){return j})),a.d(t,"c",(function(){return O})),a.d(t,"b",(function(){return k}));var l=a(2),r=a.n(l),i=a(67),n=a(27),o=a(65),s=a.n(o),c=a(1),u=a(13),m=a(18),d=a(12);const p={headerFormatter:e=>s()(e.value).format("Y-MM-DD HH:mm:ss")},b=20,f={s:c.i18n.translate("xpack.infra.alerts.timeLabels.seconds",{defaultMessage:"seconds"}),m:c.i18n.translate("xpack.infra.alerts.timeLabels.minutes",{defaultMessage:"minutes"}),h:c.i18n.translate("xpack.infra.alerts.timeLabels.hours",{defaultMessage:"hours"}),d:c.i18n.translate("xpack.infra.alerts.timeLabels.days",{defaultMessage:"days"})},E=(e,t)=>Object(l.useMemo)((()=>"number"==typeof e&&"number"==typeof t?Object(i.niceTimeFormatter)([e,t]):e=>`${e}`),[e,t]),g=d.a,h=(e,t=!1)=>{let a=null,l=null;const r=e.reduce(((e,t)=>(t.points.forEach((t=>{const a=e[t.timestamp]||[];e[t.timestamp]=[...a,t.value]})),e)),{});Object.values(r).forEach((e=>{const r=t?Object(n.sum)(e):Object(n.max)(e),i=Object(n.min)(e);r&&(!l||r>l)&&(l=r),i&&(!a||i<a)&&(a=i)}));const i=Object.keys(r).map(Number),o=Object(n.min)(i)||0,s=Object(n.max)(i)||0;return{yMin:a||0,yMax:l||0,xMin:o,xMax:s}},x=e=>e?i.DARK_THEME:i.LIGHT_THEME,v=({children:e})=>r.a.createElement("div",{style:{width:"100%",height:150,display:"flex",justifyContent:"center",alignItems:"center"}},e),y=({children:e})=>r.a.createElement("div",{style:{width:"100%",height:150}},e),j=()=>r.a.createElement(v,null,r.a.createElement(u.EuiText,{color:"subdued","data-test-subj":"noChartData"},r.a.createElement(m.FormattedMessage,{id:"xpack.infra.alerts.charts.noDataMessage",defaultMessage:"No chart data available"}))),O=()=>r.a.createElement(v,null,r.a.createElement(u.EuiText,{color:"subdued","data-test-subj":"loadingData"},r.a.createElement(m.FormattedMessage,{id:"xpack.infra.alerts.charts.loadingMessage",defaultMessage:"Loading"}))),k=()=>r.a.createElement(v,null,r.a.createElement(u.EuiText,{color:"subdued","data-test-subj":"chartErrorState"},r.a.createElement(m.FormattedMessage,{id:"xpack.infra.alerts.charts.errorMessage",defaultMessage:"Uh oh, something went wrong"})))},175:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var l=a(67),r=a(27),i=a(2),n=a.n(i),o=a(6),s=a(90);const c=.3,u=({threshold:e,sortedThresholds:t,comparator:a,color:i,id:u,firstTimestamp:m,lastTimestamp:d,domain:p})=>{if(!a||!e)return null;const b=[o.b.GT,o.b.GT_OR_EQ].includes(a),f=[o.b.LT,o.b.LT_OR_EQ].includes(a);return n.a.createElement(n.a.Fragment,null,n.a.createElement(l.LineAnnotation,{id:`${u}-thresholds`,domainType:l.AnnotationDomainType.YDomain,"data-test-subj":"threshold-line",dataValues:t.map((e=>({dataValue:e}))),style:{line:{strokeWidth:2,stroke:Object(s.b)(i),opacity:1}}}),2===t.length&&a===o.b.BETWEEN?n.a.createElement(n.a.Fragment,null,n.a.createElement(l.RectAnnotation,{id:`${u}-lower-threshold`,"data-test-subj":"between-rect",style:{fill:Object(s.b)(i),opacity:c},dataValues:[{coordinates:{x0:m,x1:d,y0:Object(r.first)(e),y1:Object(r.last)(e)}}]})):null,2===t.length&&a===o.b.OUTSIDE_RANGE?n.a.createElement(n.a.Fragment,null,n.a.createElement(l.RectAnnotation,{id:`${u}-lower-threshold`,"data-test-subj":"outside-range-lower-rect",style:{fill:Object(s.b)(i),opacity:c},dataValues:[{coordinates:{x0:m,x1:d,y0:p.min,y1:Object(r.first)(e)}}]}),n.a.createElement(l.RectAnnotation,{id:`${u}-upper-threshold`,"data-test-subj":"outside-range-upper-rect",style:{fill:Object(s.b)(i),opacity:c},dataValues:[{coordinates:{x0:m,x1:d,y0:Object(r.last)(e),y1:p.max}}]})):null,f&&null!=Object(r.first)(e)?n.a.createElement(l.RectAnnotation,{id:`${u}-upper-threshold`,"data-test-subj":"below-rect",style:{fill:Object(s.b)(i),opacity:c},dataValues:[{coordinates:{x0:m,x1:d,y0:p.min,y1:Object(r.first)(e)}}]}):null,b&&null!=Object(r.first)(e)?n.a.createElement(l.RectAnnotation,{id:`${u}-upper-threshold`,"data-test-subj":"above-rect",style:{fill:Object(s.b)(i),opacity:c},dataValues:[{coordinates:{x0:m,x1:d,y0:Object(r.first)(e),y1:p.max}}]}):null)}},293:function(e,t,a){"use strict";a.r(t),a.d(t,"defaultExpression",(function(){return Y})),a.d(t,"Expressions",(function(){return J})),a.d(t,"ExpressionRow",(function(){return ae})),a.d(t,"nodeTypes",(function(){return ie}));var l=a(13),r=a(1),i=a(18),n=a(27),o=a(2),s=a.n(o),c=a(17),u=a(72),m=a(6),d=a(92),p=a(88),b=a(219),f=a(221),E=a(220),g=a(222),h=a(217),x=a(216),v=a(218),y=a(89),j=a(150),O=a(133),k=a(20),w=a(147),T=a(112),C=a(67),M=a(65),F=a.n(M),S=a(90),I=a(148),L=a(91),z=a(149),R=a(118),W=a(146),P=a(117),D=a(94),A=a(132),B=a(175);const Q=({expression:e,filterQuery:t,nodeType:a,sourceId:r})=>{var c,u,m,d,p;const b=Object(o.useMemo)((()=>({interval:`${e.timeSize||1}${e.timeUnit}`,from:F()().subtract(20*(e.timeSize||1),e.timeUnit).valueOf(),to:F()().valueOf(),forceInterval:!0,ignoreLookback:!0})),[e.timeSize,e.timeUnit]),f=e=>({...e,type:"custom"}),E=Object(L.d)(),{loading:g,nodes:h}=Object(I.a)(t,"custom"===e.metric?[f(e.customMetric)]:[{type:e.metric}],[],a,r,0,E.accountId,E.region,!0,b),{uiSettings:x}=Object(k.b)().services,v={field:e.metric,aggregation:"avg",color:S.a.color0},y=(null==x?void 0:x.get("theme:darkMode"))||!1,j=Object(o.useMemo)((()=>{var e,t,a,l;const r=null===(e=h[0])||void 0===e||null===(t=e.metrics[0])||void 0===t?void 0:t.timeseries,i=null===(a=Object(n.first)(null==r?void 0:r.rows))||void 0===a?void 0:a.timestamp,o=null===(l=Object(n.last)(null==r?void 0:r.rows))||void 0===l?void 0:l.timestamp;return null==i||null==o?e=>`${e}`:Object(C.niceTimeFormatter)([i,o])}),[h]),O=Object(o.useCallback)(Object(z.a)("custom"===e.metric?f(e.customMetric):{type:e.metric}),[e.metric]);if(g||!h)return s.a.createElement(A.c,null);const w=t=>U(e.metric,t),T=e.threshold.map(w),M=null!==(c=null===(u=e.warningThreshold)||void 0===u?void 0:u.map(w))&&void 0!==c?c:[],Q=T.slice().sort(),G=M.slice().sort(),_=[...Q,...G].sort(),N=null===(m=h[0])||void 0===m||null===(d=m.metrics[0])||void 0===d?void 0:d.timeseries;if(!N||!N.rows||0===N.rows.length)return s.a.createElement(A.e,null);const $={...N,id:null===(p=h[0])||void 0===p?void 0:p.name,rows:N.rows.map((e=>{const t={...e};return _.forEach(((e,a)=>{t[Object(W.a)(v,`threshold_${a}`)]=e})),t}))},H=Object(n.first)(N.rows).timestamp,V=Object(n.last)(N.rows).timestamp,q=Object(R.a)($,[v],!1),K={max:1.1*Math.max(q.max,Object(n.last)(_)||q.max),min:.9*Math.min(q.min,Object(n.first)(_)||q.min)};K.min===Object(n.first)(T)&&(K.min=.9*K.min);const{timeSize:Y,timeUnit:J}=e,X=A.f[J];return s.a.createElement(s.a.Fragment,null,s.a.createElement(A.a,null,s.a.createElement(C.Chart,null,s.a.createElement(P.a,{type:D.b.bar,metric:v,id:"0",series:$,stack:!1}),s.a.createElement(B.a,{comparator:e.comparator,threshold:T,sortedThresholds:Q,color:S.a.color1,id:"critical",firstTimestamp:H,lastTimestamp:V,domain:K}),e.warningComparator&&e.warningThreshold&&s.a.createElement(B.a,{comparator:e.warningComparator,threshold:M,sortedThresholds:G,color:S.a.color5,id:"warning",firstTimestamp:H,lastTimestamp:V,domain:K}),s.a.createElement(C.Axis,{id:"timestamp",position:C.Position.Bottom,showOverlappingTicks:!0,tickFormat:j}),s.a.createElement(C.Axis,{id:"values",position:C.Position.Left,tickFormat:O,domain:K}),s.a.createElement(C.Settings,{tooltip:A.i,theme:Object(A.g)(y)}))),s.a.createElement("div",{style:{textAlign:"center"}},"ALL"!==$.id?s.a.createElement(l.EuiText,{size:"xs",color:"subdued"},s.a.createElement(i.FormattedMessage,{id:"xpack.infra.metrics.alerts.dataTimeRangeLabelWithGrouping",defaultMessage:"Last {lookback} {timeLabel} of data for {id}",values:{id:$.id,timeLabel:X,lookback:20*Y}})):s.a.createElement(l.EuiText,{size:"xs",color:"subdued"},s.a.createElement(i.FormattedMessage,{id:"xpack.infra.metrics.alerts.dataTimeRangeLabel",defaultMessage:"Last {lookback} {timeLabel}",values:{timeLabel:X,lookback:20*Y}}))))},U=(e,t)=>G[e]?G[e](t):t,G={cpu:e=>Number(e)/100,memory:e=>Number(e)/100};var _=a(119);const N={avg:r.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.avg",{defaultMessage:"Average"}),max:r.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.max",{defaultMessage:"Max"}),min:r.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.min",{defaultMessage:"Min"}),rate:r.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.rate",{defaultMessage:"Rate"})},$=d.b.map((e=>({text:N[e],value:e}))),H=({metric:e,metrics:t,customMetric:a,fields:c,errors:u,onChange:m,onChangeCustom:p,popupPosition:b})=>{var f;const[E,g]=Object(o.useState)(!1),[h,x]=Object(o.useState)("custom"===(null==e?void 0:e.value)),[v,y]=Object(o.useState)(null==e?void 0:e.value),[j,O]=Object(o.useState)(null==a?void 0:a.label),k={text:r.i18n.translate("xpack.infra.metrics.alertFlyout.expression.metric.selectFieldLabel",{defaultMessage:"Select a metric"}),value:""},w=Object(o.useMemo)((()=>c.filter((e=>e.aggregatable&&"number"===e.type&&!((null==a?void 0:a.field)===e.name))).map((e=>({label:e.name})))),[c,null==a?void 0:a.field]),T=Object(o.useMemo)((()=>h?(null==a?void 0:a.field)&&Object(_.a)(a):(null==e?void 0:e.text)||k.text),[h,e,a,k]),C=Object(o.useCallback)((e=>{"metric-popover-custom"===e?(x(!0),m("custom")):(x(!1),m(v))}),[x,m,v]),M=Object(o.useCallback)((e=>{const t=e.target.value,l=d.c.is(t)?t:"avg",r={...a,aggregation:l};d.d.is(r)&&p(r)}),[a,p]),F=Object(o.useCallback)((e=>{const t={...a,field:e[0].label};d.d.is(t)&&p(t)}),[a,p]),S=Object(n.debounce)(p,500),I=Object(o.useCallback)((e=>{O(e.target.value);const t={...a,label:e.target.value};d.d.is(t)&&S(t)}),[a,S]),L=t.map((e=>({label:e.text,value:e.value})),[]);return s.a.createElement(l.EuiPopover,{id:"metricPopover",button:s.a.createElement(l.EuiExpression,{description:r.i18n.translate("xpack.infra.metrics.alertFlyout.expression.metric.whenLabel",{defaultMessage:"When"}),value:T,isActive:Boolean(E||u.metric&&u.metric.length>0),onClick:()=>{g(!0)},color:null!==(f=u.metric)&&void 0!==f&&f.length?"danger":"success"}),isOpen:E,closePopover:()=>{g(!1)},anchorPosition:null!=b?b:"downRight",zIndex:8e3},s.a.createElement("div",{style:{width:620}},s.a.createElement(V,{onClose:()=>g(!1)},s.a.createElement(i.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.expression.metric.popoverTitle",defaultMessage:"Metric"})),s.a.createElement(l.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:"Metric type",options:[{id:"metric-popover-default",label:"Default metric"},{id:"metric-popover-custom",label:"Custom metric"}],idSelected:h?"metric-popover-custom":"metric-popover-default",onChange:C}),s.a.createElement(l.EuiSpacer,{size:"m"}),h?s.a.createElement(s.a.Fragment,null,s.a.createElement(l.EuiFormRow,{fullWidth:!0},s.a.createElement(l.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},s.a.createElement(l.EuiFlexItem,{grow:!1},s.a.createElement(l.EuiSelect,{onChange:M,value:(null==a?void 0:a.aggregation)||"avg",options:$,fullWidth:!0})),s.a.createElement(l.EuiFlexItem,{grow:!1},s.a.createElement(l.EuiText,{color:"subdued"},s.a.createElement("span",null,r.i18n.translate("xpack.infra.waffle.customMetrics.of",{defaultMessage:"of"})))),s.a.createElement(l.EuiFlexItem,null,s.a.createElement(l.EuiComboBox,{fullWidth:!0,placeholder:r.i18n.translate("xpack.infra.waffle.customMetrics.fieldPlaceholder",{defaultMessage:"Select a field"}),singleSelection:{asPlainText:!0},selectedOptions:null!=a&&a.field?[{label:a.field}]:[],options:w,onChange:F,isClearable:!1,isInvalid:u.metric.length>0})))),s.a.createElement(l.EuiFormRow,{label:r.i18n.translate("xpack.infra.waffle.alerting.customMetrics.labelLabel",{defaultMessage:"Metric name (optional)"}),display:"rowCompressed",fullWidth:!0,helpText:r.i18n.translate("xpack.infra.waffle.alerting.customMetrics.helpText",{defaultMessage:'Choose a name to help identify your custom metric. Defaults to "<function> of <field name>".'})},s.a.createElement(l.EuiFieldText,{name:"label",placeholder:r.i18n.translate("xpack.infra.waffle.customMetrics.labelPlaceholder",{defaultMessage:'Choose a name to appear in the "Metric" dropdown'}),value:j,fullWidth:!0,onChange:I}))):s.a.createElement(l.EuiFormRow,{fullWidth:!0},s.a.createElement(l.EuiFlexGroup,null,s.a.createElement(l.EuiFlexItem,{className:"actOf__metricContainer"},s.a.createElement(l.EuiComboBox,{fullWidth:!0,singleSelection:{asPlainText:!0},"data-test-subj":"availablefieldsOptionsComboBox",isInvalid:u.metric.length>0,placeholder:k.text,options:L,noSuggestions:!L.length,selectedOptions:e?L.filter((t=>t.value===e.value)):[],renderOption:e=>e.label,onChange:e=>{e.length>0?(m(e[0].value),y(e[0].value)):m()}}))))))},V=({children:e,onClose:t})=>s.a.createElement(l.EuiPopoverTitle,null,s.a.createElement(l.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},s.a.createElement(l.EuiFlexItem,null,e),s.a.createElement(l.EuiFlexItem,{grow:!1},s.a.createElement(l.EuiButtonIcon,{iconType:"cross",color:"danger","aria-label":r.i18n.translate("xpack.infra.metrics.expressionItems.components.closablePopoverTitle.closeLabel",{defaultMessage:"Close"}),onClick:()=>t()})))),q=({value:e,options:t,onChange:a,popupPosition:n})=>{const[c,u]=Object(o.useState)(!1);return s.a.createElement(l.EuiPopover,{button:s.a.createElement(l.EuiExpression,{"data-test-subj":"nodeTypeExpression",description:r.i18n.translate("xpack.infra.metrics.alertFlyout.expression.for.descriptionLabel",{defaultMessage:"For"}),value:t[e].text,isActive:c,onClick:()=>{u(!0)}}),isOpen:c,closePopover:()=>{u(!1)},ownFocus:!0,anchorPosition:null!=n?n:"downLeft"},s.a.createElement("div",null,s.a.createElement(K,{onClose:()=>u(!1)},s.a.createElement(i.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.expression.for.popoverTitle",defaultMessage:"Node Type"})),s.a.createElement(l.EuiSelect,{"data-test-subj":"forExpressionSelect",value:e,fullWidth:!0,onChange:e=>{a(e.target.value),u(!1)},options:Object.values(t).map((e=>e))})))},K=({children:e,onClose:t})=>s.a.createElement(l.EuiPopoverTitle,null,s.a.createElement(l.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},s.a.createElement(l.EuiFlexItem,null,e),s.a.createElement(l.EuiFlexItem,{grow:!1},s.a.createElement(l.EuiButtonIcon,{iconType:"cross",color:"danger","aria-label":r.i18n.translate("xpack.infra.metrics.expressionItems.components.closablePopoverTitle.closeLabel",{defaultMessage:"Close"}),onClick:()=>t()})))),Y={metric:"cpu",comparator:m.b.GT,threshold:[],timeSize:1,timeUnit:"m",customMetric:{type:"custom",id:"alert-custom-metric",field:"",aggregation:"avg"}},J=e=>{const{http:t,notifications:a}=Object(k.b)().services,{setRuleParams:c,ruleParams:p,errors:b,metadata:f}=e,{source:E,createDerivedIndexPattern:g}=Object(O.a)({sourceId:"default",fetch:t.fetch,toastWarning:a.toasts.addWarning}),[h,x]=Object(o.useState)(1),[v,y]=Object(o.useState)("m"),j=Object(o.useMemo)((()=>g()),[g]),C=Object(o.useCallback)(((e,t)=>{const a=p.criteria?p.criteria.slice():[];a[e]=t,c("criteria",a)}),[c,p.criteria]),M=Object(o.useCallback)((()=>{var e;const t=(null===(e=p.criteria)||void 0===e?void 0:e.slice())||[];t.push({...Y,timeSize:null!=h?h:Y.timeSize,timeUnit:null!=v?v:Y.timeUnit}),c("criteria",t)}),[c,p.criteria,h,v]),F=Object(o.useCallback)((e=>{const t=p.criteria.slice();t.length>1&&(t.splice(e,1),c("criteria",t))}),[c,p.criteria]),S=Object(o.useCallback)((e=>{c("filterQueryText",e||"");try{c("filterQuery",Object(T.a)(e,j,!1)||"")}catch(e){c("filterQuery",m.e)}}),[j,c]),I=Object(o.useCallback)(Object(n.debounce)(S,500),[S]),L=Object(o.useMemo)((()=>({aggField:[],timeSizeUnit:[],timeWindowSize:[]})),[]),z=Object(o.useCallback)((e=>{const t=p.criteria.map((t=>({...t,timeSize:e})));x(e||void 0),c("criteria",t)}),[p.criteria,c]),R=Object(o.useCallback)((e=>{const t=p.criteria.map((t=>({...t,timeUnit:e})));y(e),c("criteria",t)}),[p.criteria,c]),W=Object(o.useCallback)((e=>{c("nodeType",e)}),[c]),P=Object(o.useCallback)((e=>S(e.target.value)),[S]),D=Object(o.useCallback)((()=>{const e=f;e&&e.options?c("criteria",[{...Y,metric:e.options.metric.type,customMetric:d.d.is(e.options.metric)?e.options.metric:Y.customMetric}]):c("criteria",[Y])}),[f,c]),A=Object(o.useCallback)((()=>{const e=f;e&&e.filter&&(c("filterQueryText",e.filter),c("filterQuery",Object(T.a)(e.filter,j)||""))}),[f,j,c]);return Object(o.useEffect)((()=>{const e=f;p.nodeType||(e&&e.nodeType?c("nodeType",e.nodeType):c("nodeType","host")),p.criteria&&p.criteria.length?(x(p.criteria[0].timeSize),y(p.criteria[0].timeUnit)):D(),p.filterQuery||A(),p.sourceId||c("sourceId",(null==E?void 0:E.id)||"default")}),[f,j,Y,E]),s.a.createElement(s.a.Fragment,null,s.a.createElement(l.EuiSpacer,{size:"m"}),s.a.createElement(l.EuiText,{size:"xs"},s.a.createElement("h4",null,s.a.createElement(i.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.conditions",defaultMessage:"Conditions"}))),s.a.createElement(ee,null,s.a.createElement(Z,null,s.a.createElement(X,null,s.a.createElement(q,{options:ie,value:p.nodeType||"host",onChange:W})))),s.a.createElement(l.EuiSpacer,{size:"xs"}),p.criteria&&p.criteria.map(((e,t)=>s.a.createElement(ae,{nodeType:p.nodeType,canDelete:p.criteria.length>1,remove:F,addExpression:M,key:t,expressionId:t,setRuleParams:C,errors:b[t]||L,expression:e||{},fields:j.fields},s.a.createElement(Q,{expression:e,filterQuery:p.filterQuery,nodeType:p.nodeType,sourceId:p.sourceId,"data-test-subj":"preview-chart"})))),s.a.createElement(X,null,s.a.createElement(u.ForLastExpression,{timeWindowSize:h,timeWindowUnit:v,errors:L,onChangeWindowSize:z,onChangeWindowUnit:R})),s.a.createElement("div",null,s.a.createElement(l.EuiButtonEmpty,{color:"primary",iconSide:"left",flush:"left",iconType:"plusInCircleFilled",onClick:M},s.a.createElement(i.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.addCondition",defaultMessage:"Add condition"}))),s.a.createElement(l.EuiSpacer,{size:"m"}),s.a.createElement(l.EuiCheckbox,{id:"metrics-alert-no-data-toggle",label:s.a.createElement(s.a.Fragment,null,r.i18n.translate("xpack.infra.metrics.alertFlyout.alertOnNoData",{defaultMessage:"Alert me if there's no data"})," ",s.a.createElement(l.EuiToolTip,{content:r.i18n.translate("xpack.infra.metrics.alertFlyout.noDataHelpText",{defaultMessage:"Enable this to trigger the action if the metric(s) do not report any data over the expected time period, or if the alert fails to query Elasticsearch"})},s.a.createElement(l.EuiIcon,{type:"questionInCircle",color:"subdued"}))),checked:p.alertOnNoData,onChange:e=>c("alertOnNoData",e.target.checked)}),s.a.createElement(l.EuiSpacer,{size:"m"}),s.a.createElement(l.EuiFormRow,{label:r.i18n.translate("xpack.infra.metrics.alertFlyout.filterLabel",{defaultMessage:"Filter (optional)"}),helpText:r.i18n.translate("xpack.infra.metrics.alertFlyout.filterHelpText",{defaultMessage:"Use a KQL expression to limit the scope of your alert trigger."}),fullWidth:!0,display:"rowCompressed"},f&&s.a.createElement(w.a,{derivedIndexPattern:j,onSubmit:S,onChange:I,value:p.filterQueryText})||s.a.createElement(l.EuiFieldSearch,{onChange:P,value:p.filterQueryText,fullWidth:!0})),s.a.createElement(l.EuiSpacer,{size:"m"}))};t.default=J;const X=c.euiStyled.div`
  margin-left: 28px;
`,Z=Object(c.euiStyled)(l.EuiFlexGroup)`
  display: flex;
  flex-wrap: wrap;
  margin: 0 -4px;
`,ee=c.euiStyled.div`
  padding: 0 4px;
`,te=Object(c.euiStyled)(l.EuiHealth)`
  margin-left: 4px;
`,ae=e=>{var t,a,c;const[u,p]=Object(o.useState)(!0),O=Object(o.useCallback)((()=>p(!u)),[u]),{children:k,setRuleParams:w,expression:T,errors:C,expressionId:M,remove:F,canDelete:S,fields:I}=e,{metric:L,comparator:z=m.b.GT,threshold:R=[],customMetric:W,warningThreshold:P=[],warningComparator:D}=T,[A,B]=Object(o.useState)(Boolean(null==P?void 0:P.length)),Q=Object(o.useCallback)((e=>{const t=y.f.is(e)?e:Boolean(e)?"custom":void 0,a={...T,metric:t};w(M,a)}),[M,T,w]),U=Object(o.useCallback)((e=>{d.d.is(e)&&w(M,{...T,customMetric:e})}),[M,T,w]),G=Object(o.useCallback)((e=>{w(M,{...T,comparator:e})}),[M,T,w]),_=Object(o.useCallback)((e=>{w(M,{...T,warningComparator:e})}),[M,T,w]),N=Object(o.useCallback)((e=>{e.join()!==T.threshold.join()&&w(M,{...T,threshold:e})}),[M,T,w]),$=Object(o.useCallback)((e=>{var t;e.join()!==(null===(t=T.warningThreshold)||void 0===t?void 0:t.join())&&w(M,{...T,warningThreshold:e})}),[M,T,w]),V=Object(o.useCallback)((()=>{A?(B(!1),w(M,Object(n.omit)(T,"warningComparator","warningThreshold"))):(B(!0),w(M,{...T,warningComparator:z,warningThreshold:[]}))}),[A,B,w,z,T,M]),q=s.a.createElement(le,{comparator:z,threshold:R,updateComparator:G,updateThreshold:N,errors:null!==(t=C.critical)&&void 0!==t?t:{},metric:L}),K=A&&s.a.createElement(le,{comparator:D||z,threshold:P,updateComparator:_,updateThreshold:$,errors:null!==(a=C.warning)&&void 0!==a?a:{},metric:L}),Y=Object(o.useMemo)((()=>{let t=x.b;switch(e.nodeType){case"awsEC2":t=b.b;break;case"awsRDS":t=f.b;break;case"awsS3":t=E.b;break;case"awsSQS":t=g.b;break;case"host":t=x.b;break;case"pod":t=v.b;break;case"container":t=h.b}return t.map(j.a)}),[e.nodeType]);return s.a.createElement(s.a.Fragment,null,s.a.createElement(l.EuiFlexGroup,{gutterSize:"xs"},s.a.createElement(l.EuiFlexItem,{grow:!1},s.a.createElement(l.EuiButtonIcon,{iconType:u?"arrowDown":"arrowRight",onClick:O,"aria-label":r.i18n.translate("xpack.infra.metrics.alertFlyout.expandRowLabel",{defaultMessage:"Expand row."})})),s.a.createElement(l.EuiFlexItem,{grow:!0},s.a.createElement(Z,null,s.a.createElement(ee,null,s.a.createElement(H,{metric:{value:L,text:(null===(c=Y.find((e=>(null==e?void 0:e.value)===L)))||void 0===c?void 0:c.text)||""},metrics:Y.filter((e=>void 0!==e&&void 0!==e.value)),onChange:Q,onChangeCustom:U,errors:C,customMetric:W,fields:I})),!A&&q),A&&s.a.createElement(s.a.Fragment,null,s.a.createElement(Z,null,q,s.a.createElement(te,{color:"danger"},s.a.createElement(i.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.criticalThreshold",defaultMessage:"Alert"}))),s.a.createElement(Z,null,K,s.a.createElement(te,{color:"warning"},s.a.createElement(i.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.warningThreshold",defaultMessage:"Warning"})),s.a.createElement(l.EuiButtonIcon,{"aria-label":r.i18n.translate("xpack.infra.metrics.alertFlyout.removeWarningThreshold",{defaultMessage:"Remove warningThreshold"}),iconSize:"s",color:"text",iconType:"crossInACircleFilled",onClick:V}))),!A&&s.a.createElement(s.a.Fragment,null," ",s.a.createElement(l.EuiSpacer,{size:"xs"}),s.a.createElement(Z,null,s.a.createElement(l.EuiButtonEmpty,{color:"primary",flush:"left",size:"xs",iconType:"plusInCircleFilled",onClick:V},s.a.createElement(i.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.addWarningThreshold",defaultMessage:"Add warning threshold"}))))),S&&s.a.createElement(l.EuiFlexItem,{grow:!1},s.a.createElement(l.EuiButtonIcon,{"aria-label":r.i18n.translate("xpack.infra.metrics.alertFlyout.removeCondition",{defaultMessage:"Remove condition"}),color:"danger",iconType:"trash",onClick:()=>F(M)}))),u?s.a.createElement("div",{style:{padding:"0 0 0 28px"}},k):null,s.a.createElement(l.EuiSpacer,{size:"s"}))},le=({updateComparator:e,updateThreshold:t,threshold:a,metric:r,comparator:i,errors:n})=>{var o;return s.a.createElement(s.a.Fragment,null,s.a.createElement(ee,null,s.a.createElement(u.ThresholdExpression,{thresholdComparator:i||m.b.GT,threshold:a,onChangeSelectedThresholdComparator:e,onChangeSelectedThreshold:t,errors:n})),r&&s.a.createElement("div",{style:{alignSelf:"center"}},s.a.createElement(l.EuiText,{size:"s"},(null===(o=ne[r])||void 0===o?void 0:o.label)||"")))},re=e=>Object(p.b)(e).displayName,ie={host:{text:re("host"),value:"host"},pod:{text:re("pod"),value:"pod"},container:{text:re("container"),value:"container"},awsEC2:{text:re("awsEC2"),value:"awsEC2"},awsS3:{text:re("awsS3"),value:"awsS3"},awsRDS:{text:re("awsRDS"),value:"awsRDS"},awsSQS:{text:re("awsSQS"),value:"awsSQS"}},ne={count:{label:""},cpu:{label:"%"},memory:{label:"%"},rx:{label:"bits/s"},tx:{label:"bits/s"},logRate:{label:"/s"},diskIOReadBytes:{label:"bytes/s"},diskIOWriteBytes:{label:"bytes/s"},s3BucketSize:{label:"bytes"},s3TotalRequests:{label:""},s3NumberOfObjects:{label:""},s3UploadBytes:{label:"bytes"},s3DownloadBytes:{label:"bytes"},sqsOldestMessage:{label:"seconds"},rdsLatency:{label:"ms"},custom:{label:""}}}}]);