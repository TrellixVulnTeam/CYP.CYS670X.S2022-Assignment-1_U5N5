/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[21],{765:function(e,t,a){"use strict";a.r(t),a.d(t,"OverviewPage",(function(){return ee}));var s=a(16),i=a.n(s),n=a(44),o=a(45),l=a(76),c=a(137),r=a(72),u=a(193),b=a(194),d=a(12);const j=()=>{const{services:{docLinks:e}}=Object(r.b)(),t=e.links.ml.guide,[a,s]=Object(u.a)(b.d,!1);return a?null:Object(d.jsx)(i.a.Fragment,null,Object(d.jsx)(n.EuiCallOut,{"data-test-subj":"mlGettingStartedCallout",title:Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.gettingStartedSectionTitle",defaultMessage:"Getting started"}),iconType:"iInCircle"},Object(d.jsx)("p",null,Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.gettingStartedSectionText",defaultMessage:"Welcome to Machine Learning. Get started by reviewing our {docs} or creating a new job.",values:{docs:Object(d.jsx)(n.EuiLink,{href:t,target:"blank"},Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.gettingStartedSectionDocs",defaultMessage:"documentation"}))}})),Object(d.jsx)("p",null,Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.feedbackSectionText",defaultMessage:"If you have input or suggestions regarding your experience, please submit {feedbackLink}.",values:{feedbackLink:Object(d.jsx)(n.EuiLink,{href:"https://www.elastic.co/community/",target:"blank"},Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.feedbackSectionLink",defaultMessage:"feedback online"}))}})),Object(d.jsx)("p",null,Object(d.jsx)(n.EuiButton,{color:"primary",onClick:s.bind(null,!0),"data-test-subj":"mlDismissGettingStartedCallout"},Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.gettingStartedSectionDismiss",defaultMessage:"Dismiss"})))),Object(d.jsx)(n.EuiSpacer,{size:"m"}))};var m=a(2),g=a(8),p=a(82),O=a(0);function v(){const e=Object(r.d)(),t=Object(r.g)(),a=Object(r.e)();return[{isPrimary:!0,name:m.i18n.translate("xpack.ml.overview.anomalyDetection.viewJobsActionName",{defaultMessage:"View jobs"}),description:m.i18n.translate("xpack.ml.overview.anomalyDetection.resultActions.openInJobManagementText",{defaultMessage:"View jobs"}),icon:"list",type:"icon",onClick:async t=>{const s=await(null==e?void 0:e.getUrl({page:O.b.ANOMALY_DETECTION_JOBS_MANAGE,pageState:{groupIds:[t.id]}}));await a(s)}},{isPrimary:!1,name:m.i18n.translate("xpack.ml.overview.anomalyDetection.viewResultsActionName",{defaultMessage:"View in Anomaly Explorer"}),description:m.i18n.translate("xpack.ml.overview.anomalyDetection.resultActions.openJobsInAnomalyExplorerText",{defaultMessage:"View in Anomaly Explorer"}),icon:"visTable",type:"icon",onClick:async s=>{const i=await(null==e?void 0:e.getUrl({page:O.b.ANOMALY_EXPLORER,pageState:{jobIds:s.jobIds,timeRange:t.getTime()}}));await a(i)}}]}var x=a(164),w=a(215),f=a(98),y=a(151),S=a(373);let M;!function(e){e.id="id",e.maxAnomalyScore="max_anomaly_score",e.overallSwimLane="overallSwimLane",e.jobIds="jobIds",e.latestTimestamp="latest_timestamp",e.docsProcessed="docs_processed",e.jobsInGroup="jobs_in_group"}(M||(M={}));const T=({items:e,statsBarData:t})=>{const a=Object.values(e),[l,c]=Object(s.useState)(0),[u,b]=Object(s.useState)(10),[j,g]=Object(s.useState)(M.id),[T,h]=Object(s.useState)("asc"),A=Object(S.a)(),E=Object(r.c)({page:O.b.ANOMALY_DETECTION_JOBS_MANAGE}),k=[{field:M.id,name:m.i18n.translate("xpack.ml.overview.anomalyDetection.tableId",{defaultMessage:"Group ID"}),render:e=>Object(d.jsx)(w.a,{id:e,isGroup:"ungrouped"!==e}),sortable:!0,truncateText:!0,width:"15%"},{name:Object(d.jsx)(n.EuiToolTip,{content:m.i18n.translate("xpack.ml.overview.anomalyDetection.tableOverallScoreTooltip",{defaultMessage:"Overall anomaly scores within selected time range"})},Object(d.jsx)("span",null,m.i18n.translate("xpack.ml.overview.anomalyDetection.overallScore",{defaultMessage:"Overall score"}),Object(d.jsx)(n.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),render:e=>{const t=e.overallSwimLane;if(!t)return null;const a=t.points.length>0?Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.anomalyDetection.noAnomaliesFoundMessage",defaultMessage:"No anomalies found"}):Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.anomalyDetection.noResultsFoundMessage",defaultMessage:"No results found"});return Object(d.jsx)(y.b,{timeBuckets:A,swimlaneData:e.overallSwimLane,swimlaneType:"overall",onResize:()=>{},isLoading:!1,id:e.id,showTimeline:!1,showYAxis:!1,showLegend:!1,noDataWarning:a})},width:"300px"},{field:M.jobsInGroup,name:m.i18n.translate("xpack.ml.overview.anomalyDetection.tableNumJobs",{defaultMessage:"Jobs in group"}),sortable:!0,truncateText:!0,width:"10%"},{field:M.latestTimestamp,name:m.i18n.translate("xpack.ml.overview.anomalyDetection.tableLatestTimestamp",{defaultMessage:"Latest timestamp"}),dataType:"date",render:e=>Object(p.b)(e),textOnly:!0,truncateText:!0,sortable:!0,width:"25%"},{field:M.docsProcessed,name:m.i18n.translate("xpack.ml.overview.anomalyDetection.tableDocsProcessed",{defaultMessage:"Docs processed"}),render:e=>Object(f.g)(e),textOnly:!0,sortable:!0,width:"15%"},{name:m.i18n.translate("xpack.ml.overview.anomalyDetection.tableActionLabel",{defaultMessage:"Actions"}),actions:v(),width:"80px",align:"right"}],L={initialPageIndex:l,initialPageSize:u,totalItemCount:a.length,pageSizeOptions:[10,20,50],hidePerPageOptions:!1},_={sort:{field:j,direction:T}};return Object(d.jsx)(i.a.Fragment,null,Object(d.jsx)(n.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween",gutterSize:"s"},Object(d.jsx)(n.EuiFlexItem,{grow:!1},Object(d.jsx)(n.EuiText,{size:"m"},Object(d.jsx)("h3",null,m.i18n.translate("xpack.ml.overview.anomalyDetection.panelTitle",{defaultMessage:"Anomaly Detection"})))),Object(d.jsx)(n.EuiFlexItem,{grow:!1},Object(d.jsx)(n.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(d.jsx)(n.EuiFlexItem,{grow:!1},Object(d.jsx)(x.a,{stats:t,dataTestSub:"mlOverviewJobStatsBar"})),Object(d.jsx)(n.EuiFlexItem,{grow:!1},Object(d.jsx)(n.EuiButton,{size:"m",fill:!0,href:E},m.i18n.translate("xpack.ml.overview.anomalyDetection.manageJobsButtonText",{defaultMessage:"Manage jobs"})))))),Object(d.jsx)(n.EuiSpacer,null),Object(d.jsx)(n.EuiInMemoryTable,{allowNeutralSort:!1,className:"mlAnomalyDetectionTable",columns:k,hasActions:!0,isExpandable:!1,isSelectable:!1,items:a,itemId:M.id,onTableChange:({page:e={index:0,size:10},sort:t={field:M.id,direction:"asc"}})=>{const{index:a,size:s}=e;c(a),b(s);const{field:i,direction:n}=t;g(i),h(n)},pagination:L,sorting:_,"data-test-subj":"mlOverviewTableAnomalyDetection"}))};var h=a(73),A=a(18);var E=a(149),k=a(77),L=a(207),_=a(135),D=a(283);const I=({jobCreationDisabled:e,setLazyJobCount:t})=>{const{services:{uiSettings:a,mlServices:{mlApiServices:i}}}=Object(r.b)(),{displayErrorToast:o}=Object(k.c)(),l=Object(r.g)(),c=Object(s.useMemo)((()=>new L.AnomalyTimelineService(l,a,Object(_.mlResultsServiceProvider)(i))),[l,a,i]),u=Object(E.a)(),[b,j]=Object(s.useState)(!1),[p,O]=Object(s.useState)({}),[v,x]=Object(s.useState)(0),[w,f]=Object(s.useState)(),[y,S]=Object(s.useState)(),M=async()=>{j(!0);let e=0;try{const a=(await h.ml.jobs.jobsSummary([])).map((t=>(t.latestTimestampSortValue=t.latestTimestampMs||0,t.awaitingNodeAssignment&&e++,t))),{groups:s,count:i}=function(e){const t={ungrouped:{id:"ungrouped",jobs:[],jobIds:[],docs_processed:0,latest_timestamp:0,max_anomaly_score:null,jobs_in_group:0}};e.forEach((e=>{e.groups.length>0?e.groups.forEach((a=>{void 0===t[a]?t[a]={id:a,jobs:[e],jobIds:[e.id],docs_processed:e.processed_record_count,latest_timestamp:e.latestTimestampMs,max_anomaly_score:null,jobs_in_group:1}:(t[a].jobs.push(e),t[a].jobIds.push(e.id),t[a].docs_processed+=e.processed_record_count,t[a].jobs_in_group++,(void 0===t[a].latest_timestamp||e.latestTimestampMs&&e.latestTimestampMs>t[a].latest_timestamp)&&(t[a].latest_timestamp=e.latestTimestampMs))})):(t.ungrouped.jobs.push(e),t.ungrouped.jobIds.push(e.id),t.ungrouped.docs_processed+=e.processed_record_count,t.ungrouped.jobs_in_group++,e.latestTimestampMs&&e.latestTimestampMs>t.ungrouped.latest_timestamp&&(t.ungrouped.latest_timestamp=e.latestTimestampMs))})),0===t.ungrouped.jobIds.length&&delete t.ungrouped;const a=Object.values(t).length;return{groups:t,count:a}}(a),n=function(e){const t={activeNodes:{label:m.i18n.translate("xpack.ml.overviewJobsList.statsBar.activeMLNodesLabel",{defaultMessage:"Active ML nodes"}),value:0,show:!0},total:{label:m.i18n.translate("xpack.ml.overviewJobsList.statsBar.totalJobsLabel",{defaultMessage:"Total jobs"}),value:0,show:!0},open:{label:m.i18n.translate("xpack.ml.overviewJobsList.statsBar.openJobsLabel",{defaultMessage:"Open jobs"}),value:0,show:!0},closed:{label:m.i18n.translate("xpack.ml.overviewJobsList.statsBar.closedJobsLabel",{defaultMessage:"Closed jobs"}),value:0,show:!0},failed:{label:m.i18n.translate("xpack.ml.overviewJobsList.statsBar.failedJobsLabel",{defaultMessage:"Failed jobs"}),value:0,show:!1},activeDatafeeds:{label:m.i18n.translate("xpack.ml.jobsList.statsBar.activeDatafeedsLabel",{defaultMessage:"Active datafeeds"}),value:0,show:!0}};if(void 0===e)return t;const a={};let s=0;return e.forEach((e=>{e.jobState===A.c.OPENED?t.open.value++:e.jobState===A.c.CLOSED?t.closed.value++:e.jobState===A.c.FAILED&&s++,e.hasDatafeed&&e.datafeedState===A.a.STARTED&&t.activeDatafeeds.value++,void 0!==e.nodeName&&(a[e.nodeName]={})})),t.total.value=e.length,s?(t.failed.value=s,t.failed.show=!0):t.failed.show=!1,t.activeNodes.value=Object.keys(a).length,t}(a);j(!1),S(void 0),f(n),x(i),O(s),I(s),t(e)}catch(e){S(void 0!==e.message?e.message:JSON.stringify(e)),j(!1)}},I=async e=>{try{const t=Object.fromEntries(Object.entries(e).filter((([e,t])=>t.jobs.length>0)).map((([e,t])=>[e,c.loadOverallData(t.jobs,300)]))),a=Object(g.zipObject)(Object.keys(t),await Promise.all(Object.values(t))),s={...e};for(const e in s)s.hasOwnProperty(e)&&(s[e].overallSwimLane=a[e]);O(s)}catch(e){o(e,m.i18n.translate("xpack.ml.overview.anomalyDetection.errorWithFetchingSwimLanesData",{defaultMessage:"An error occurred fetching anomaly results"}))}};Object(s.useEffect)((()=>{M()}),[null==u?void 0:u.timeRange]);const C=Object(d.jsx)(s.Fragment,null,Object(d.jsx)(n.EuiCallOut,{title:m.i18n.translate("xpack.ml.overview.anomalyDetection.errorPromptTitle",{defaultMessage:"An error occurred getting the anomaly detection jobs list."}),color:"danger",iconType:"alert"},Object(d.jsx)("pre",null,y))),J=b?"mlOverviewPanel__isLoading":"mlOverviewPanel";return!y&&!1===b&&void 0===y&&0===v?Object(d.jsx)(D.a,null):Object(d.jsx)(n.EuiPanel,{className:J,hasShadow:!1,hasBorder:!0},void 0!==y&&C,b&&Object(d.jsx)(n.EuiLoadingSpinner,{className:"mlOverviewPanel__spinner",size:"xl"}),!1===b&&void 0===y&&v>0?Object(d.jsx)(T,{items:p,statsBarData:w}):null)};var C=a(74),J=a(103),N=a(271),F=a(199);const P=({item:e})=>{const{disabled:t,tooltipContent:a}=Object(F.a)(e),i=m.i18n.translate("xpack.ml.overview.analytics.resultActions.openJobText",{defaultMessage:"View job results"}),o=!1===t?i:a,l=Object(s.useMemo)((()=>Object(C.m)(e.config.analysis)),[e]),c=Object(r.c)({page:O.b.DATA_FRAME_ANALYTICS_EXPLORATION,pageState:{jobId:e.id,analysisType:l}});return Object(d.jsx)(n.EuiToolTip,{position:"top",content:o},Object(d.jsx)(n.EuiButtonIcon,{href:c,size:"xs",iconType:"visTable","aria-label":i,"data-test-subj":"mlOverviewAnalyticsJobViewButton",isDisabled:t}))};function z(){const e=Object(r.d)(),t=Object(r.e)();return[{isPrimary:!1,name:m.i18n.translate("xpack.ml.overview.analytics.viewJobActionName",{defaultMessage:"View job"}),description:m.i18n.translate("xpack.ml.overview.analytics.viewJobActionName",{defaultMessage:"View job"}),type:"icon",icon:"list",onClick:async a=>{const s=await(null==e?void 0:e.getUrl({page:O.b.DATA_FRAME_ANALYTICS_JOBS_MANAGE,pageState:{jobId:a.id}}));await t(s)}},{isPrimary:!1,name:m.i18n.translate("xpack.ml.overview.analytics.viewResultsActionName",{defaultMessage:"View results"}),description:m.i18n.translate("xpack.ml.overview.analytics.resultActions.openJobText",{defaultMessage:"View job results"}),render:e=>Object(d.jsx)(P,{item:e})}]}const B=({items:e})=>{const[t,a]=Object(s.useState)(0),[i,o]=Object(s.useState)(10),[l,c]=Object(s.useState)(J.c.id),[r,u]=Object(s.useState)("asc"),b=[{field:J.c.id,name:m.i18n.translate("xpack.ml.overview.analyticsList.id",{defaultMessage:"ID"}),sortable:!0,truncateText:!1,width:"20%"},{name:m.i18n.translate("xpack.ml.overview.analyticsList.type",{defaultMessage:"Type"}),sortable:e=>Object(C.m)(e.config.analysis),truncateText:!0,render:e=>Object(d.jsx)(n.EuiBadge,{color:"hollow"},Object(C.m)(e.config.analysis)),width:"150px"},{name:m.i18n.translate("xpack.ml.overview.analyticsList.status",{defaultMessage:"Status"}),sortable:e=>e.stats.state,truncateText:!0,render:e=>Object(N.b)(e.stats.state,e.stats.failure_reason),width:"100px"},N.c,{field:J.c.configCreateTime,name:m.i18n.translate("xpack.ml.overview.analyticsList.reatedTimeColumnName",{defaultMessage:"Creation time"}),dataType:"date",render:e=>Object(p.b)(e),textOnly:!0,truncateText:!0,sortable:!0,width:"25%"},{name:m.i18n.translate("xpack.ml.overview.analyticsList.tableActionLabel",{defaultMessage:"Actions"}),actions:z(),width:"80px"}],j={initialPageIndex:t,initialPageSize:i,totalItemCount:e.length,pageSizeOptions:[10,20,50],hidePerPageOptions:!1},g={sort:{field:l,direction:r}};return Object(d.jsx)(n.EuiInMemoryTable,{allowNeutralSort:!1,className:"mlAnalyticsTable",columns:b,hasActions:!0,isExpandable:!1,isSelectable:!1,items:e,itemId:J.c.id,onTableChange:({page:e={index:0,size:10},sort:t={field:J.c.id,direction:"asc"}})=>{const{index:s,size:i}=e;a(s),o(i);const{field:n,direction:l}=t;c(n),u(l)},pagination:j,sorting:g,"data-test-subj":"mlOverviewTableAnalytics"})};var R=a(179),G=a(398),V=a(399);const Y=({jobCreationDisabled:e,setLazyJobCount:t})=>{const a=Object(E.a)(),[o,l]=Object(s.useState)([]),[c,u]=Object(s.useState)(void 0),[b,j]=Object(s.useState)(),[g,p]=Object(s.useState)(!1),[v,w]=Object(s.useState)(!1),f=Object(r.c)({page:O.b.DATA_FRAME_ANALYTICS_JOBS_MANAGE}),y=Object(R.d)(l,u,j,p,t,!1,!1);Object(s.useEffect)((()=>{y(!0)}),[a]);const S=Object(d.jsx)(n.EuiCallOut,{title:m.i18n.translate("xpack.ml.overview.analyticsList.errorPromptTitle",{defaultMessage:"An error occurred getting the data frame analytics list."}),color:"danger",iconType:"alert"},Object(d.jsx)("pre",null,b&&void 0!==b.message?b.message:JSON.stringify(b))),M=!1===g?"mlOverviewPanel__isLoading":"mlOverviewPanel",T=void 0===b&&!0===g&&0===o.length;return Object(d.jsx)(i.a.Fragment,null,T?Object(d.jsx)(V.a,{disabled:e,onCreateFirstJobClick:w.bind(null,!0)}):Object(d.jsx)(n.EuiPanel,{className:M,hasShadow:!1,hasBorder:!0},void 0!==b?S:null,!1===g&&Object(d.jsx)(n.EuiLoadingSpinner,{className:"mlOverviewPanel__spinner",size:"xl"}),!0===g&&o.length>0&&Object(d.jsx)(i.a.Fragment,null,Object(d.jsx)(n.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween"},Object(d.jsx)(n.EuiFlexItem,{grow:!1},Object(d.jsx)(n.EuiText,{size:"m"},Object(d.jsx)("h3",null,m.i18n.translate("xpack.ml.overview.analyticsList.PanelTitle",{defaultMessage:"Analytics"})))),Object(d.jsx)(n.EuiFlexItem,{grow:!1},Object(d.jsx)(n.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},void 0!==c?Object(d.jsx)(n.EuiFlexItem,{grow:!1},Object(d.jsx)(x.a,{stats:c,dataTestSub:"mlOverviewAnalyticsStatsBar"})):null,Object(d.jsx)(n.EuiFlexItem,{grow:!1},Object(d.jsx)(n.EuiButton,{size:"m",fill:!0,href:f},m.i18n.translate("xpack.ml.overview.analyticsList.manageJobsButtonText",{defaultMessage:"Manage jobs"})))))),Object(d.jsx)(n.EuiSpacer,null),Object(d.jsx)(B,{items:o}))),v?Object(d.jsx)(G.a,{onClose:()=>w(!1)}):null)},U=({createAnomalyDetectionJobDisabled:e,createAnalyticsJobDisabled:t,setAdLazyJobCount:a,setDfaLazyJobCount:s})=>Object(d.jsx)(i.a.Fragment,null,Object(d.jsx)(I,{jobCreationDisabled:e,setLazyJobCount:a}),Object(d.jsx)(n.EuiSpacer,{size:"m"}),Object(d.jsx)(Y,{jobCreationDisabled:t,setLazyJobCount:s}));var W=a(280),X=a(165),q=a(281),H=a(282),K=a(111),Q=a(392),Z=a(187),$=a(91);const ee=()=>{const e=Object(l.e)("canViewMlNodes"),t=!Object(l.e)("canCreateJob")||!Object(c.c)(),a=!Object(c.c)()||!Object(l.e)("canCreateDataFrameAnalytics")||!Object(l.e)("canStartStopDataFrameAnalytics"),{services:{docLinks:u}}=Object(r.b)(),b=u.links.ml.guide,m=Object(r.g)({timeRangeSelector:!0,autoRefreshSelector:!0}),[g,p]=Object(s.useState)(0),[O,v]=Object(s.useState)(0);return Object(d.jsx)("div",null,Object(d.jsx)($.a,null,Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.overview.overviewLabel",defaultMessage:"Overview"})),Object(d.jsx)(W.a,null),Object(d.jsx)(X.a,{jobCount:g+O}),Object(d.jsx)(q.a,{onCloseFlyout:()=>{const{from:e,to:t}=m.getTime(),a={start:e,end:t};Z.a.next({lastRefresh:Date.now(),timeRange:a})}}),Object(d.jsx)(H.a,null),Object(d.jsx)(j,null),e?Object(d.jsx)(i.a.Fragment,null,Object(d.jsx)(n.EuiPanel,{hasShadow:!1,hasBorder:!0},Object(d.jsx)(Q.a,{compactView:!0})),Object(d.jsx)(n.EuiSpacer,{size:"m"})):null,Object(d.jsx)(U,{createAnomalyDetectionJobDisabled:t,createAnalyticsJobDisabled:a,setAdLazyJobCount:p,setDfaLazyJobCount:v}),Object(d.jsx)(K.a,{docLink:b}))};t.default=ee}}]);