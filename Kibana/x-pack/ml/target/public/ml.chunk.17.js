/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[17],{265:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(150);function i(e,t,a){const i=["kuery"===t.language?Object(n.f)(Object(n.d)(t.query)):Object(n.e)(t.query)],c=[];for(const t of e){if(t.meta.disabled||void 0!==a&&t.meta.controlledBy===a)continue;const{meta:{negate:e,type:n,key:s}}=t;let o=t.query;void 0===o&&"exists"===n&&(o={exists:{field:s}}),o&&(e?c.push(o):i.push(o))}return{bool:{must:i,must_not:c}}}},266:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(25),i=a(28),c=a(8),s=a(29);function o(e,t,a){return e.pipe(Object(i.pluck)("jobIds"),Object(i.distinctUntilChanged)(c.isEqual),Object(i.switchMap)((e=>t.getJobs$(e))),Object(i.map)((e=>e.map((e=>{const t=Object(s.a)(e.analysis_config.bucket_span);return{id:e.job_id,selected:!0,bucketSpanSeconds:t.asSeconds()}})))),Object(i.catchError)((e=>{var t;return a(null!==(t=e.body)&&void 0!==t?t:e),Object(n.of)(void 0)})))}},770:function(e,t,a){"use strict";a.r(t),a.d(t,"EmbeddableSwimLaneContainer",(function(){return f}));var n=a(16),i=a(44),c=a(45),s=a(25),o=a(28),l=a(110),r=a(85),b=a(47),u=a(151),d=a(50),j=a(265),O=a(41),m=a(266);var p=a(178),g=a(12);const f=({id:e,embeddableContext:t,embeddableInput:a,services:f,refresh:v,onInputChange:S,onOutputChange:w})=>{const[y,h]=Object(n.useState)(0),[E,x]=Object(n.useState)(1),[{},{uiActions:M}]=f,[_,T]=Object(n.useState)(),[I,k,C,P,A,L,R]=function(e,t,a,i,c,p){const[{uiSettings:g},,{anomalyTimelineService:f,anomalyDetectorService:v}]=i,[S,w]=Object(n.useState)(),[y,h]=Object(n.useState)(),[E,x]=Object(n.useState)(),[M,_]=Object(n.useState)(),[T,I]=Object(n.useState)(!1),k=Object(n.useMemo)((()=>new s.Subject),[]),C=Object(n.useMemo)((()=>Object(m.a)(e,v,x).pipe(Object(o.shareReplay)(1))),[]),P=Object(n.useMemo)((()=>Object(s.combineLatest)([C,k,e.pipe(Object(o.pluck)("timeRange"))]).pipe(Object(o.skipWhile)((([e,t])=>!Array.isArray(e)||!t)),Object(o.tap)((([,,e])=>{f.setTimeRange(e)})),Object(o.map)((([e,t])=>f.getSwimlaneBucketInterval(e,t))),Object(o.distinctUntilChanged)(((e,t)=>e.asSeconds()===t.asSeconds())))),[]),A=Object(n.useMemo)((()=>new s.Subject),[]),L=Object(n.useMemo)((()=>new s.Subject),[]),R=Object(n.useMemo)((()=>new l.a({"histogram:maxBars":g.get(b.UI_SETTINGS.HISTOGRAM_MAX_BARS),"histogram:barTarget":g.get(b.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:g.get("dateFormat"),"dateFormat:scaled":g.get("dateFormat:scaled")})),[]);return Object(n.useEffect)((()=>{const n=Object(s.combineLatest)([C,e,P,A,L.pipe(Object(o.startWith)(void 0),Object(o.distinctUntilChanged)(((e,t)=>void 0===e&&t===r.i))),a.pipe(Object(o.startWith)(null))]).pipe(Object(o.tap)(I.bind(null,!0)),Object(o.debounceTime)(500),Object(o.switchMap)((([e,a,n,i,c])=>{if(!e)return Object(s.of)(void 0);const{viewBy:l,swimlaneType:b,perPage:m,filters:p,query:g,viewMode:v}=a;let w;y||h(b);try{w=Object(j.a)(p,g,O.CONTROLLED_BY_SWIM_LANE_FILTER)}catch(e){return x(e),Object(s.of)(void 0)}return Object(s.from)(f.loadOverallData(e,void 0,n)).pipe(Object(o.switchMap)((a=>{const{earliest:j,latest:O}=a;var p;return a&&b===r.h.VIEW_BY?(void 0===c&&_(null!=m?m:r.i),v===d.ViewMode.EDIT&&c!==m&&t({perPage:c}),Object(s.from)(f.loadViewBySwimlane([],{earliest:j,latest:O},e,l,Object(u.c)(S)?S.cardinality:r.a,null!==(p=null!=c?c:m)&&void 0!==p?p:r.i,i,void 0,w,n)).pipe(Object(o.map)((e=>({...e,earliest:j,latest:O}))))):Object(s.of)(a)})))})),Object(o.catchError)((e=>(x(e.body),Object(s.of)(void 0))))).subscribe((e=>{void 0!==e&&(x(null),w(e),I(!1))}));return()=>{n.unsubscribe()}}),[]),Object(n.useEffect)((()=>{A.next(p)}),[p]),Object(n.useEffect)((()=>{void 0!==M&&L.next(M)}),[M]),Object(n.useEffect)((()=>{k.next(c)}),[c]),[y,S,null!=M?M:r.i,_,R,T,E]}(a,S,v,f,y,E);Object(n.useEffect)((()=>{w({perPage:C,fromPage:E,interval:null==k?void 0:k.interval})}),[C,E,k]);const B=Object(n.useCallback)((e=>{T(e),e&&M.getTrigger(p.a).exec({embeddable:t,data:e,updateCallback:T.bind(null,void 0)})}),[k,C,E,T]);return R?Object(g.jsx)(i.EuiCallOut,{title:Object(g.jsx)(c.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.errorMessage",defaultMessage:"Unable to load the ML swim lane data"}),color:"danger",iconType:"alert",style:{width:"100%"}},Object(g.jsx)("p",null,R.message)):Object(g.jsx)("div",{style:{width:"100%",padding:"8px"},"data-test-subj":"mlAnomalySwimlaneEmbeddableWrapper"},Object(g.jsx)(u.b,{id:e,"data-test-subj":`mlSwimLaneEmbeddable_${t.id}`,timeBuckets:A,swimlaneData:k,swimlaneType:I,fromPage:E,perPage:C,swimlaneLimit:Object(u.c)(k)?k.cardinality:void 0,onResize:h,selection:_,onCellsSelection:B,onPaginationChange:e=>{e.fromPage&&x(e.fromPage),e.perPage&&(x(1),P(e.perPage))},isLoading:L,noDataWarning:Object(g.jsx)(i.EuiEmptyPrompt,{titleSize:"xxs",style:{padding:0},title:Object(g.jsx)("h2",null,Object(g.jsx)(c.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.noDataFound",defaultMessage:"No anomalies found"}))})}))};t.default=f}}]);