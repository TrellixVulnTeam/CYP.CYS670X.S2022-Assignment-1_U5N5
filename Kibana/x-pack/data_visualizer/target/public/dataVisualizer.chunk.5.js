/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.dataVisualizer_bundle_jsonpfunction=window.dataVisualizer_bundle_jsonpfunction||[]).push([[5],{48:function(e,t,s){"use strict";s.r(t),s.d(t,"FileDataVisualizer",(function(){return a.FileDataVisualizer})),s.d(t,"IndexDataVisualizer",(function(){return p}));var a=s(89),i=(s(76),s(0)),r=s(41),n=s(7),c=s(23),d=s(6),o=s(1),l=s(27),u=s(3),h=s(62),b=s(10),v=s(49),j=s(12),S=s(84),f=s(88),O=s(5);const I=e=>{const t=Object(b.d)(e.urlSearchString);let s={indexPatternId:t.index,searchSessionId:e.searchSessionId};if(e.savedSearchId&&(s.savedSearchId=e.savedSearchId),t){if(t._g){const{time:e,refreshInterval:a}=t._g;s.timeRange=e,s.refreshInterval=a}t._a&&t._a[S.a]&&(s={...s,...t._a[S.a]})}return s},g=({IndexDataVisualizerComponent:e,additionalLinks:t})=>{const{services:s}=Object(v.a)(),{data:{indexPatterns:a,search:l},savedObjects:{client:u},notifications:{toasts:h}}=s,S=Object(r.useHistory)(),{search:g}=Object(r.useLocation)(),[p,x]=Object(i.useState)(void 0),[y,m]=Object(i.useState)(null),[E,w]=Object(i.useState)(void 0);Object(i.useEffect)((()=>{const e=Object(b.d)(g);if(l.session&&l.session.enableStorage({getName:async()=>f.a,getLocatorData:async()=>({id:j.a,initialState:I({...s,urlSearchString:g,indexPatternId:null==p?void 0:p.id,savedSearchId:null==y?void 0:y.id,shouldRestoreSearchSession:!1,searchSessionId:l.session.getSessionId()}),restoreState:I({...s,urlSearchString:g,indexPatternId:null==p?void 0:p.id,savedSearchId:null==y?void 0:y.id,shouldRestoreSearchSession:!0,searchSessionId:l.session.getSessionId()})})}),void 0!==e.searchSessionId&&e.searchSessionId!==E){var t;null===(t=l.session)||void 0===t||t.restore(e.searchSessionId),w(e.searchSessionId)}else{var a;const e=null===(a=l.session)||void 0===a?void 0:a.start();w(e)}return()=>{l.session.clear()}}),[l.session,g]),Object(i.useEffect)((()=>{const e=g,t=Object(n.parse)(e,{sort:!1});(async()=>{if("string"==typeof(null==t?void 0:t.savedSearchId)){const s=t.savedSearchId;try{var e;const t=await u.get("search",s),i=null===(e=t.references.find((e=>"index-pattern"===e.type)))||void 0===e?void 0:e.id;if(void 0!==i&&t)try{const e=await a.get(i);m(t),x(e)}catch(e){h.addError(e,{title:o.i18n.translate("xpack.dataVisualizer.index.dataViewErrorMessage",{defaultMessage:"Error finding data view"})})}}catch(e){h.addError(e,{title:o.i18n.translate("xpack.dataVisualizer.index.savedSearchErrorMessage",{defaultMessage:"Error retrieving saved search {savedSearchId}",values:{savedSearchId:s}})})}}if("string"==typeof(null==t?void 0:t.index)){const e=await a.get(t.index);x(e)}})()}),[u,h,a,g]);const V=Object(i.useCallback)(((e,t,s,a)=>{const i=g,r=Object(b.d)(i),o=Object(n.parse)(i,{sort:!1});if(Object.prototype.hasOwnProperty.call(r,e)||(r[e]={}),"string"==typeof t){if(Object(c.isEqual)(Object(b.b)(r,`${e}.${t}`),s))return i;r[e][t]=s}else{const s=t;Object.keys(s).forEach((t=>{r[e][t]=s[t]}))}try{const e=Object(n.stringify)(o,{sort:!1,encode:!1});Object.keys(r).forEach((e=>{Object(b.c)(e)?o[e]=Object(d.encode)(r[e]):o[e]=r[e]}));if(e!==Object(n.stringify)(o,{sort:!1,encode:!1})){const e=Object(n.stringify)(o,{sort:!1});a?S.replace({search:e}):S.push({search:e})}}catch(e){console.error("Could not save url state",e)}}),[S,g]);return Object(O.jsx)(b.a,{value:{searchString:g,setUrlState:V}},p?Object(O.jsx)(e,{currentIndexPattern:p,currentSavedSearch:y,additionalLinks:t,currentSessionId:E}):Object(O.jsx)("div",null))},p=({additionalLinks:e})=>{const t=Object(u.a)(),{data:s,maps:a,embeddable:i,share:r,security:n,fileUpload:c,lens:d,dataViewFieldEditor:o,uiActions:b,charts:v}=Object(u.b)(),j={data:s,maps:a,embeddable:i,share:r,security:n,fileUpload:c,lens:d,dataViewFieldEditor:o,uiActions:b,charts:v,...t};return Object(O.jsx)(l.KibanaThemeProvider,{theme$:t.theme.theme$},Object(O.jsx)(l.KibanaContextProvider,{services:{...j}},Object(O.jsx)(g,{IndexDataVisualizerComponent:h.a,additionalLinks:e})))}}}]);