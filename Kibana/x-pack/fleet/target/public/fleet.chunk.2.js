/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.fleet_bundle_jsonpfunction=window.fleet_bundle_jsonpfunction||[]).push([[2],{142:function(e,t,a){"use strict";t.decode=t.parse=a(283),t.encode=t.stringify=a(284)},279:function(e,t,a){"use strict";var n=a(280),l=a(282);function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=y,t.resolve=function(e,t){return y(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?y(e,!1,!0).resolveObject(t):t},t.format=function(e){l.isString(e)&&(e=y(e));return e instanceof i?e.format():i.prototype.format.call(e)},t.Url=i;var s=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,o=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(c),d=["%","/","?",";","#"].concat(u),g=["/","?","#"],m=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},E={javascript:!0,"javascript:":!0},h={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=a(142);function y(e,t,a){if(e&&l.isObject(e)&&e instanceof i)return e;var n=new i;return n.parse(e,t,a),n}i.prototype.parse=function(e,t,a){if(!l.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),r=-1!==i&&i<e.indexOf("#")?"?":"#",c=e.split(r);c[0]=c[0].replace(/\\/g,"/");var y=e=c.join(r);if(y=y.trim(),!a&&1===e.split("#").length){var v=o.exec(y);if(v)return this.path=y,this.href=y,this.pathname=v[1],v[2]?(this.search=v[2],this.query=t?b.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var k=s.exec(y);if(k){var x=(k=k[0]).toLowerCase();this.protocol=x,y=y.substr(k.length)}if(a||k||y.match(/^\/\/[^@\/]+@[^@\/]+/)){var M="//"===y.substr(0,2);!M||k&&E[k]||(y=y.substr(2),this.slashes=!0)}if(!E[k]&&(M||k&&!h[k])){for(var O,F,S=-1,j=0;j<g.length;j++){-1!==(I=y.indexOf(g[j]))&&(-1===S||I<S)&&(S=I)}-1!==(F=-1===S?y.lastIndexOf("@"):y.lastIndexOf("@",S))&&(O=y.slice(0,F),y=y.slice(F+1),this.auth=decodeURIComponent(O)),S=-1;for(j=0;j<d.length;j++){var I;-1!==(I=y.indexOf(d[j]))&&(-1===S||I<S)&&(S=I)}-1===S&&(S=y.length),this.host=y.slice(0,S),y=y.slice(S),this.parseHost(),this.hostname=this.hostname||"";var C="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!C)for(var P=this.hostname.split(/\./),w=(j=0,P.length);j<w;j++){var T=P[j];if(T&&!T.match(m)){for(var L="",A=0,_=T.length;A<_;A++)T.charCodeAt(A)>127?L+="x":L+=T[A];if(!L.match(m)){var D=P.slice(0,j),N=P.slice(j+1),B=T.match(p);B&&(D.push(B[1]),N.unshift(B[2])),N.length&&(y="/"+N.join(".")+y),this.hostname=D.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),C||(this.hostname=n.toASCII(this.hostname));var R=this.port?":"+this.port:"",z=this.hostname||"";this.host=z+R,this.href+=this.host,C&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!f[x])for(j=0,w=u.length;j<w;j++){var U=u[j];if(-1!==y.indexOf(U)){var H=encodeURIComponent(U);H===U&&(H=escape(U)),y=y.split(U).join(H)}}var q=y.indexOf("#");-1!==q&&(this.hash=y.substr(q),y=y.slice(0,q));var G=y.indexOf("?");if(-1!==G?(this.search=y.substr(G),this.query=y.substr(G+1),t&&(this.query=b.parse(this.query)),y=y.slice(0,G)):t&&(this.search="",this.query={}),y&&(this.pathname=y),h[x]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){R=this.pathname||"";var W=this.search||"";this.path=R+W}return this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",a=this.pathname||"",n=this.hash||"",i=!1,s="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&l.isObject(this.query)&&Object.keys(this.query).length&&(s=b.stringify(this.query));var r=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||h[t])&&!1!==i?(i="//"+(i||""),a&&"/"!==a.charAt(0)&&(a="/"+a)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),r&&"?"!==r.charAt(0)&&(r="?"+r),t+i+(a=a.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(r=r.replace("#","%23"))+n},i.prototype.resolve=function(e){return this.resolveObject(y(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if(l.isString(e)){var t=new i;t.parse(e,!1,!0),e=t}for(var a=new i,n=Object.keys(this),s=0;s<n.length;s++){var r=n[s];a[r]=this[r]}if(a.hash=e.hash,""===e.href)return a.href=a.format(),a;if(e.slashes&&!e.protocol){for(var o=Object.keys(e),c=0;c<o.length;c++){var u=o[c];"protocol"!==u&&(a[u]=e[u])}return h[a.protocol]&&a.hostname&&!a.pathname&&(a.path=a.pathname="/"),a.href=a.format(),a}if(e.protocol&&e.protocol!==a.protocol){if(!h[e.protocol]){for(var d=Object.keys(e),g=0;g<d.length;g++){var m=d[g];a[m]=e[m]}return a.href=a.format(),a}if(a.protocol=e.protocol,e.host||E[e.protocol])a.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),a.pathname=p.join("/")}if(a.search=e.search,a.query=e.query,a.host=e.host||"",a.auth=e.auth,a.hostname=e.hostname||e.host,a.port=e.port,a.pathname||a.search){var f=a.pathname||"",b=a.search||"";a.path=f+b}return a.slashes=a.slashes||e.slashes,a.href=a.format(),a}var y=a.pathname&&"/"===a.pathname.charAt(0),v=e.host||e.pathname&&"/"===e.pathname.charAt(0),k=v||y||a.host&&e.pathname,x=k,M=a.pathname&&a.pathname.split("/")||[],O=(p=e.pathname&&e.pathname.split("/")||[],a.protocol&&!h[a.protocol]);if(O&&(a.hostname="",a.port=null,a.host&&(""===M[0]?M[0]=a.host:M.unshift(a.host)),a.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),k=k&&(""===p[0]||""===M[0])),v)a.host=e.host||""===e.host?e.host:a.host,a.hostname=e.hostname||""===e.hostname?e.hostname:a.hostname,a.search=e.search,a.query=e.query,M=p;else if(p.length)M||(M=[]),M.pop(),M=M.concat(p),a.search=e.search,a.query=e.query;else if(!l.isNullOrUndefined(e.search)){if(O)a.hostname=a.host=M.shift(),(C=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=C.shift(),a.host=a.hostname=C.shift());return a.search=e.search,a.query=e.query,l.isNull(a.pathname)&&l.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.href=a.format(),a}if(!M.length)return a.pathname=null,a.search?a.path="/"+a.search:a.path=null,a.href=a.format(),a;for(var F=M.slice(-1)[0],S=(a.host||e.host||M.length>1)&&("."===F||".."===F)||""===F,j=0,I=M.length;I>=0;I--)"."===(F=M[I])?M.splice(I,1):".."===F?(M.splice(I,1),j++):j&&(M.splice(I,1),j--);if(!k&&!x)for(;j--;j)M.unshift("..");!k||""===M[0]||M[0]&&"/"===M[0].charAt(0)||M.unshift(""),S&&"/"!==M.join("/").substr(-1)&&M.push("");var C,P=""===M[0]||M[0]&&"/"===M[0].charAt(0);O&&(a.hostname=a.host=P?"":M.length?M.shift():"",(C=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=C.shift(),a.host=a.hostname=C.shift()));return(k=k||a.host&&M.length)&&!P&&M.unshift(""),M.length?a.pathname=M.join("/"):(a.pathname=null,a.path=null),l.isNull(a.pathname)&&l.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.auth=e.auth||a.auth,a.slashes=a.slashes||e.slashes,a.href=a.format(),a},i.prototype.parseHost=function(){var e=this.host,t=r.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},280:function(e,t,a){(function(e,n){var l;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(i){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof n&&n;s.global!==s&&s.window!==s&&s.self;var r,o=2147483647,c=36,u=/^xn--/,d=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,m={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,f=String.fromCharCode;function E(e){throw new RangeError(m[e])}function h(e,t){for(var a=e.length,n=[];a--;)n[a]=t(e[a]);return n}function b(e,t){var a=e.split("@"),n="";return a.length>1&&(n=a[0]+"@",e=a[1]),n+h((e=e.replace(g,".")).split("."),t).join(".")}function y(e){for(var t,a,n=[],l=0,i=e.length;l<i;)(t=e.charCodeAt(l++))>=55296&&t<=56319&&l<i?56320==(64512&(a=e.charCodeAt(l++)))?n.push(((1023&t)<<10)+(1023&a)+65536):(n.push(t),l--):n.push(t);return n}function v(e){return h(e,(function(e){var t="";return e>65535&&(t+=f((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=f(e)})).join("")}function k(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function x(e,t,a){var n=0;for(e=a?p(e/700):e>>1,e+=p(e/t);e>455;n+=c)e=p(e/35);return p(n+36*e/(e+38))}function M(e){var t,a,n,l,i,s,r,u,d,g,m,f=[],h=e.length,b=0,y=128,k=72;for((a=e.lastIndexOf("-"))<0&&(a=0),n=0;n<a;++n)e.charCodeAt(n)>=128&&E("not-basic"),f.push(e.charCodeAt(n));for(l=a>0?a+1:0;l<h;){for(i=b,s=1,r=c;l>=h&&E("invalid-input"),((u=(m=e.charCodeAt(l++))-48<10?m-22:m-65<26?m-65:m-97<26?m-97:c)>=c||u>p((o-b)/s))&&E("overflow"),b+=u*s,!(u<(d=r<=k?1:r>=k+26?26:r-k));r+=c)s>p(o/(g=c-d))&&E("overflow"),s*=g;k=x(b-i,t=f.length+1,0==i),p(b/t)>o-y&&E("overflow"),y+=p(b/t),b%=t,f.splice(b++,0,y)}return v(f)}function O(e){var t,a,n,l,i,s,r,u,d,g,m,h,b,v,M,O=[];for(h=(e=y(e)).length,t=128,a=0,i=72,s=0;s<h;++s)(m=e[s])<128&&O.push(f(m));for(n=l=O.length,l&&O.push("-");n<h;){for(r=o,s=0;s<h;++s)(m=e[s])>=t&&m<r&&(r=m);for(r-t>p((o-a)/(b=n+1))&&E("overflow"),a+=(r-t)*b,t=r,s=0;s<h;++s)if((m=e[s])<t&&++a>o&&E("overflow"),m==t){for(u=a,d=c;!(u<(g=d<=i?1:d>=i+26?26:d-i));d+=c)M=u-g,v=c-g,O.push(f(k(g+M%v,0))),u=p(M/v);O.push(f(k(u,0))),i=x(a,b,n==l),a=0,++n}++a,++t}return O.join("")}r={version:"1.4.1",ucs2:{decode:y,encode:v},decode:M,encode:O,toASCII:function(e){return b(e,(function(e){return d.test(e)?"xn--"+O(e):e}))},toUnicode:function(e){return b(e,(function(e){return u.test(e)?M(e.slice(4).toLowerCase()):e}))}},void 0===(l=function(){return r}.call(t,a,t,e))||(e.exports=l)}()}).call(this,a(281)(e),a(49))},281:function(e,t,a){e.exports=a(29)(434)},282:function(e,t,a){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},283:function(e,t,a){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,a,i){t=t||"&",a=a||"=";var s={};if("string"!=typeof e||0===e.length)return s;var r=/\+/g;e=e.split(t);var o=1e3;i&&"number"==typeof i.maxKeys&&(o=i.maxKeys);var c=e.length;o>0&&c>o&&(c=o);for(var u=0;u<c;++u){var d,g,m,p,f=e[u].replace(r,"%20"),E=f.indexOf(a);E>=0?(d=f.substr(0,E),g=f.substr(E+1)):(d=f,g=""),m=decodeURIComponent(d),p=decodeURIComponent(g),n(s,m)?l(s[m])?s[m].push(p):s[m]=[s[m],p]:s[m]=p}return s};var l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},284:function(e,t,a){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,a,r){return t=t||"&",a=a||"=",null===e&&(e=void 0),"object"==typeof e?i(s(e),(function(s){var r=encodeURIComponent(n(s))+a;return l(e[s])?i(e[s],(function(e){return r+encodeURIComponent(n(e))})).join(t):r+encodeURIComponent(n(e[s]))})).join(t):r?encodeURIComponent(n(r))+a+encodeURIComponent(n(e)):""};var l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function i(e,t){if(e.map)return e.map(t);for(var a=[],n=0;n<e.length;n++)a.push(t(e[n],n));return a}var s=Object.keys||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.push(a);return t}},285:function(e,t,a){const n=a(48);e.exports=(e,t,a)=>n(e,t,a)>=0},286:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(37),l=a(0),i=n.__importDefault(a(141)),s=a(287),r={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};t.default=s.isClient&&window.ResizeObserver?function(){var e=l.useState(null),t=e[0],a=e[1],n=l.useState(r),s=n[0],o=n[1],c=l.useMemo((function(){return new window.ResizeObserver((function(e){if(e[0]){var t=e[0].contentRect,a=t.x,n=t.y,l=t.width,i=t.height,s=t.top,r=t.left,c=t.bottom,u=t.right;o({x:a,y:n,width:l,height:i,top:s,left:r,bottom:c,right:u})}}))}),[]);return i.default((function(){if(t)return c.observe(t),function(){c.disconnect()}}),[t]),[a,s]}:function(){return[function(){},r]}},287:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDeepEqual=t.off=t.on=t.isClient=void 0;var n=a(37).__importDefault(a(288));t.isClient="object"==typeof window,t.on=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return e.addEventListener.apply(e,t)},t.off=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return e.removeEventListener.apply(e,t)},t.isDeepEqual=n.default},288:function(e,t,a){"use strict";e.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var n,l,i;if(Array.isArray(t)){if((n=t.length)!=a.length)return!1;for(l=n;0!=l--;)if(!e(t[l],a[l]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((n=(i=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(l=n;0!=l--;)if(!Object.prototype.hasOwnProperty.call(a,i[l]))return!1;for(l=n;0!=l--;){var s=i[l];if(("_owner"!==s||!t.$$typeof)&&!e(t[s],a[s]))return!1}return!0}return t!=t&&a!=a}},291:function(e,t,a){"use strict";a.r(t),a.d(t,"ProtectedRoute",(function(){return Pa})),a.d(t,"renderApp",(function(){return Ta})),a.d(t,"teardownFleet",(function(){return La}));var n=a(0),l=a.n(n),i=a(65),s=a.n(i),r=a(12),o=a(76),c=a(6),u=a(63),d=a(4),g=a(64),m=a.n(g),p=a(140),f=a.n(p),E=a(21),h=a(66),b=a(78),y=a(77),v=a(79),k=a(86),x=a(89),M=a(82),O=a.n(M),F=a(5);const S=m()(c.EuiFlyout).withConfig({displayName:"FlyoutWithHigherZIndex",componentId:"sc-4bxzaq-0"})(["z-index:",";"],(e=>e.theme.eui.euiZLevel5)),j=({onClose:e,as:t,...a})=>{const{notifications:i}=Object(o.rb)(),s=Object(o.Q)().fleet.all,[r,g]=Object(n.useState)({name:"",description:"",namespace:"default",monitoring_enabled:Object.values(F.dataTypes)}),[m,p]=Object(n.useState)(!1),[f,E]=Object(n.useState)(!0),h=Object(x.g)(r),b=l.a.createElement(c.EuiFlyoutHeader,{hasBorder:!0,"aria-labelledby":"CreateAgentPolicyFlyoutTitle"},l.a.createElement(c.EuiTitle,{size:"m"},l.a.createElement("h2",{id:"CreateAgentPolicyFlyoutTitle"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.flyoutTitle",defaultMessage:"Create agent policy"}))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiText,{size:"s"},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.flyoutTitleDescription",defaultMessage:"Agent policies are used to manage settings across a group of agents. You can add integrations to your agent policy to specify what data your agents collect. When you edit an agent policy, you can use Fleet to deploy updates to a specified group of agents."})))),y=l.a.createElement(c.EuiFlyoutBody,null,l.a.createElement(x.c,{agentPolicy:r,updateAgentPolicy:e=>{g({...r,...e})},withSysMonitoring:f,updateSysMonitoring:e=>E(e),validation:h})),v=l.a.createElement(c.EuiFlyoutFooter,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{onClick:()=>e(),flush:"left"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.cancelButtonLabel",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,isLoading:m,isDisabled:!s||m||Object.keys(h).length>0,onClick:async()=>{p(!0);try{const{data:t,error:a}=await(async()=>await Object(o.i)(r,{withSysMonitoring:f}))();p(!1),t?(i.toasts.addSuccess(d.i18n.translate("xpack.fleet.createAgentPolicy.successNotificationTitle",{defaultMessage:"Agent policy '{name}' created",values:{name:r.name}})),e(t.item)):i.toasts.addDanger(a?a.message:d.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"}))}catch(e){p(!1),i.toasts.addDanger(d.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"}))}},"data-test-subj":"createAgentPolicyFlyoutBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.submitButtonLabel",defaultMessage:"Create agent policy"})))));return l.a.createElement(S,O()({onClose:()=>e(),size:"l",maxWidth:400},a),b,y,v)},I=()=>{var e,t;Object(o.R)("policies_list");const{getPath:a}=Object(o.lb)(),i=Object(o.Q)().fleet.all,{agents:{enabled:s}}=Object(o.T)(),{urlParams:g,toUrlParams:m}=Object(o.ub)(),[p,f]=Object(n.useState)(Array.isArray(g.kuery)?g.kuery[g.kuery.length-1]:null!==(e=g.kuery)&&void 0!==e?e:""),{pagination:E,pageSizeOptions:h,setPagination:b}=Object(o.nb)(),{sorting:k,setSorting:M}=Object(o.qb)({field:"updated_at",direction:"desc"}),O=Object(r.useHistory)(),F="create"in g,S=Object(n.useCallback)((e=>{if(e!==F)if(e)O.push(`${a("policies_list")}?${m({...g,create:null})}`);else{const{create:e,...t}=g;O.push(`${a("policies_list")}?${m(t)}`)}}),[a,O,F,m,g]),{isLoading:I,data:C,resendRequest:P}=Object(o.W)({page:E.currentPage,perPage:E.pageSize,sortField:null==k?void 0:k.field,sortOrder:null==k?void 0:k.direction,kuery:p}),w=Object(n.useMemo)((()=>{const e=[{field:"name",sortable:!0,name:d.i18n.translate("xpack.fleet.agentPolicyList.nameColumnTitle",{defaultMessage:"Name"}),width:"20%",render:(e,t)=>l.a.createElement(y.e,{policy:t})},{field:"description",name:d.i18n.translate("xpack.fleet.agentPolicyList.descriptionColumnTitle",{defaultMessage:"Description"}),width:"35%",render:e=>l.a.createElement(c.EuiTextColor,{color:"subdued",className:"eui-textTruncate",title:e},e)},{field:"updated_at",sortable:!0,name:d.i18n.translate("xpack.fleet.agentPolicyList.updatedOnColumnTitle",{defaultMessage:"Last updated on"}),render:e=>l.a.createElement(u.FormattedDate,{value:e,year:"numeric",month:"short",day:"2-digit"})},{field:"agents",name:d.i18n.translate("xpack.fleet.agentPolicyList.agentsColumnTitle",{defaultMessage:"Agents"}),dataType:"number",render:(e,t)=>l.a.createElement(x.f,{count:e,agentPolicyId:t.id})},{field:"package_policies",name:d.i18n.translate("xpack.fleet.agentPolicyList.packagePoliciesCountColumnTitle",{defaultMessage:"Integrations"}),dataType:"number",render:e=>e?e.length:0},{field:"actions",name:d.i18n.translate("xpack.fleet.agentPolicyList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>l.a.createElement(x.a,{agentPolicy:e,onCopySuccess:()=>P()})}]}];return s?e:e.filter((e=>!("field"in e)||"agents"!==e.field))}),[s,P]),T=Object(n.useMemo)((()=>l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",isDisabled:!i,onClick:()=>S(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.addButton",defaultMessage:"Create agent policy"}))),[i,S]),L=Object(n.useMemo)((()=>l.a.createElement(c.EuiEmptyPrompt,{title:l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.noAgentPoliciesPrompt",defaultMessage:"No agent policies"})),actions:T})),[T]);return l.a.createElement(l.a.Fragment,null,F?l.a.createElement(j,{onClose:()=>{S(!1),P()}}):null,l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"m"},l.a.createElement(c.EuiFlexItem,{grow:4},l.a.createElement(y.p,{value:p,onChange:e=>{b({...E,currentPage:1}),f(e)},fieldPrefix:v.c})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{color:"primary",iconType:"refresh",onClick:()=>P()},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.reloadAgentPoliciesButtonText",defaultMessage:"Reload"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},T)),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiBasicTable,{loading:I,hasActions:!0,noItemsMessage:I?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.loadingAgentPoliciesMessage",defaultMessage:"Loading agent policies…"}):p.trim()||0!==(null!==(t=null==C?void 0:C.total)&&void 0!==t?t:0)?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.noFilteredAgentPoliciesPrompt",defaultMessage:"No agent policies found. {clearFiltersLink}",values:{clearFiltersLink:l.a.createElement(c.EuiLink,{onClick:()=>f("")},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentPolicyList.clearFiltersLinkText",defaultMessage:"Clear filters"}))}}):L,items:C?C.items:[],itemId:"id",columns:w,isSelectable:!1,pagination:{pageIndex:E.currentPage-1,pageSize:E.pageSize,totalItemCount:C?C.total:0,pageSizeOptions:h},sorting:{sort:k},onChange:e=>{const t={...E,currentPage:e.page.index+1,pageSize:e.page.size};b(t),M(e.sort)}}))};var C=a(80);const P=l.a.createContext({refresh:()=>{}});var w=a(7);const T=(e,t)=>e.localeCompare(t),L=e=>({name:e,value:e}),A=({packagePolicies:e,agentPolicy:t,...a})=>{const{application:i}=Object(o.rb)(),s=Object(o.Q)().integrations.writeIntegrationPolicies,r=Object(o.Q)().integrations.readIntegrationPolicies,{updatableIntegrations:g}=Object(o.mb)(),{getHref:m}=Object(o.lb)(),[p,f]=Object(n.useMemo)((()=>{const t=new Set;return[e.map((e=>{var a,n,l,i,s,r,o,c;e.namespace&&t.add(e.namespace);const u=g.get(null!==(a=null===(n=e.package)||void 0===n?void 0:n.name)&&void 0!==a?a:""),d=!!u&&u.policiesToUpgrade.some((({pkgPolicyId:t})=>t===e.id));return{...e,packageName:null!==(l=null===(i=e.package)||void 0===i?void 0:i.name)&&void 0!==l?l:"",packageTitle:null!==(s=null===(r=e.package)||void 0===r?void 0:r.title)&&void 0!==s?s:"",packageVersion:null!==(o=null===(c=e.package)||void 0===c?void 0:c.version)&&void 0!==o?o:"",hasUpgrade:d}})),[...t].sort(T).map(L)]}),[e,g]),E=Object(n.useMemo)((()=>[{field:"name",sortable:!0,truncateText:!0,name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.nameColumnTitle",{defaultMessage:"Name"}),render:(e,a)=>l.a.createElement(c.EuiLink,O()({title:e},r?{href:m("edit_integration",{policyId:t.id,packagePolicyId:a.id})}:{disabled:!0}),l.a.createElement("span",{className:"eui-textTruncate",title:e},e),a.description?l.a.createElement("span",null," ",l.a.createElement(c.EuiToolTip,{content:a.description},l.a.createElement(c.EuiIcon,{type:"help"}))):null)},{field:"packageTitle",sortable:!0,name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.packageNameColumnTitle",{defaultMessage:"Integration"}),render:(e,a)=>l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{"data-test-subj":"PackagePoliciesTableLink",grow:!1},l.a.createElement(c.EuiLink,{href:a.package&&m("integration_details_overview",{pkgkey:Object(C.n)(a.package)})},l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},a.package&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(y.n,{packageName:a.package.name,version:a.package.version,size:"m",tryApi:!0})),l.a.createElement(c.EuiFlexItem,{grow:!1},e),a.package&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.packagePoliciesTable.packageVersion",defaultMessage:"v{version}",values:{version:a.package.version}})))))),a.hasUpgrade&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiToolTip,{content:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.upgradeAvailable",{defaultMessage:"Upgrade Available"})},l.a.createElement(c.EuiIcon,{type:"alert",color:"warning"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{"data-test-subj":"PackagePoliciesTableUpgradeButton",size:"s",minWidth:"0",isDisabled:!s,href:`${m("upgrade_package_policy",{policyId:t.id,packagePolicyId:a.id})}?from=fleet-policy-list`},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.packagePoliciesTable.upgradeButton",defaultMessage:"Upgrade"})))))},{field:"namespace",name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.namespaceColumnTitle",{defaultMessage:"Namespace"}),render:e=>e?l.a.createElement(c.EuiBadge,{color:"hollow"},e):""},{name:d.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>s?l.a.createElement(y.o,{agentPolicy:t,packagePolicy:e,upgradePackagePolicyHref:`${m("upgrade_package_policy",{policyId:t.id,packagePolicyId:e.id})}?from=fleet-policy-list`}):l.a.createElement(l.a.Fragment,null)}]}]),[t,m,s,r]);return l.a.createElement(c.EuiInMemoryTable,O()({itemId:"id",items:p,columns:E,sorting:{sort:{field:"name",direction:"asc"}}},a,{search:{toolsRight:t.is_managed?[]:[l.a.createElement(c.EuiButton,{key:"addPackagePolicyButton",fill:!0,isDisabled:!s,iconType:"plusInCircle",onClick:()=>{i.navigateToApp(F.INTEGRATIONS_PLUGIN_ID,{path:w.t.integrations_all({})[1],state:{forAgentPolicyId:t.id}})},"data-test-subj":"addPackagePolicyButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.addPackagePolicyButtonText",defaultMessage:"Add integration"}))],box:{incremental:!0,schema:!0},filters:[{type:"field_value_selection",field:"namespace",name:"Namespace",options:f,multiSelect:"or",operator:"exact"}]},isSelectable:!1}))},_=Object(n.memo)((({policyId:e})=>{const{application:t}=Object(o.rb)(),a=Object(o.Q)().integrations.writeIntegrationPolicies;return l.a.createElement(c.EuiEmptyPrompt,{iconType:"plusInCircle",title:l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstTitle",defaultMessage:"Add your first integration"})),body:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstMessage",defaultMessage:"This policy does not have any integrations yet."}),actions:l.a.createElement(c.EuiButton,{isDisabled:!a,fill:!0,onClick:()=>t.navigateToApp(v.k,{path:v.n.integrations_all({})[1],state:{forAgentPolicyId:e}}),"data-test-subj":"addPackagePolicyButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstButtonText",defaultMessage:"Add integration"}))})})),D=Object(n.memo)((({agentPolicy:e})=>(Object(o.R)("policy_details",{policyName:e.name}),0===e.package_policies.length?l.a.createElement(_,{policyId:e.id}):l.a.createElement(A,{agentPolicy:e,packagePolicies:e.package_policies||[]})))),N=m.a.div.withConfig({displayName:"FormWrapper",componentId:"sc-1b9jodr-0"})(["max-width:800px;margin-right:auto;margin-left:auto;"]),B=Object(n.memo)((({agentPolicy:e})=>{Object(o.R)("policy_details",{policyName:e.name});const{notifications:t}=Object(o.rb)(),{agents:{enabled:a}}=Object(o.T)(),i=Object(r.useHistory)(),{getPath:s}=Object(o.lb)(),g=Object(o.Q)().fleet.all,m=Object(o.P)(),[p,f]=Object(n.useState)({...e}),[E,h]=Object(n.useState)(!1),[b,y]=Object(n.useState)(!1),[v,k]=Object(n.useState)(0),[M,O]=Object(n.useState)(!0),F=Object(x.g)(p),S=async()=>{h(!0);try{const{name:e,description:a,namespace:n,monitoring_enabled:l,unenroll_timeout:i}=p,{data:s,error:r}=await Object(o.M)(p.id,{name:e,description:a,namespace:n,monitoring_enabled:l,unenroll_timeout:i});s?(t.toasts.addSuccess(d.i18n.translate("xpack.fleet.editAgentPolicy.successNotificationTitle",{defaultMessage:"Successfully updated '{name}' settings",values:{name:p.name}})),m(),y(!1)):t.toasts.addDanger(r?r.message:d.i18n.translate("xpack.fleet.editAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to update agent policy"}))}catch(e){t.toasts.addDanger(d.i18n.translate("xpack.fleet.editAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to update agent policy"}))}h(!1)};return l.a.createElement(N,null,v?l.a.createElement(x.e,{agentCount:v,agentPolicy:p,onConfirm:()=>{k(0),S()},onCancel:()=>{k(0),h(!1)}}):null,l.a.createElement(x.c,{agentPolicy:p,updateAgentPolicy:e=>{f({...p,...e}),y(!0)},withSysMonitoring:M,updateSysMonitoring:e=>O(e),validation:F,isEditing:!0,onDelete:()=>{i.push(s("policies_list"))}}),b?l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiBottomBar,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.unsavedChangesText",defaultMessage:"You have unsaved changes"})),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",onClick:()=>{f({...e}),y(!1)}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.cancelButtonText",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{onClick:async()=>{if(a){h(!0);const{data:e}=await Object(o.q)({policyId:p.id});null!=e&&e.results.total?k(e.results.total):await S()}else await S()},isLoading:E,isDisabled:!g||E||Object.keys(F).length>0,iconType:"save",color:"primary",fill:!0},E?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.savingButtonText",defaultMessage:"Saving…"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.saveButtonText",defaultMessage:"Save changes"})))))))):null)})),R=({isLoading:e,policyId:t,agentPolicy:a})=>{const{getHref:n}=Object(o.lb)();return l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"s",alignItems:"flexStart"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiButtonEmpty,{iconType:"arrowLeft",href:n("policies_list"),flush:"left",size:"xs"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.viewAgentListTitle",defaultMessage:"View all agent policies"}))),l.a.createElement(c.EuiFlexItem,null,e?l.a.createElement(y.l,null):l.a.createElement(c.EuiFlexGroup,{alignItems:"center",wrap:!0,responsive:!1,gutterSize:"s"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiTitle,null,l.a.createElement("h1",null,a&&a.name||l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.policyDetailsTitle",defaultMessage:"Policy '{id}'",values:{id:t}})))),(null==a?void 0:a.is_managed)&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiIconTip,{title:"Hosted agent policy",content:d.i18n.translate("xpack.fleet.policyDetails.policyDetailsHostedPolicyTooltip",{defaultMessage:"This policy is managed outside of Fleet. Most actions related to this policy are unavailable."}),type:"lock",size:"l",color:"subdued"})))),a&&a.description?l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiText,{color:"subdued",size:"s",className:"eui-textBreakWord"},a.description)):null)},z=m.a.div.withConfig({displayName:"Divider",componentId:"sc-1n9nfzq-0"})(["width:0;height:100%;border-left:",";"],(e=>e.theme.eui.euiBorderThin)),U=({isLoading:e,policyId:t,agentPolicy:a,agentStatus:n,addAgent:i,onCancelEnrollment:s,isAddAgentHelpPopoverOpen:g,setIsAddAgentHelpPopoverOpen:m})=>{var p;const{getPath:f}=Object(o.lb)(),E=Object(r.useHistory)();if(!a)return null;const h=l.a.createElement(c.EuiLink,{onClick:i},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.addAgentButton",defaultMessage:"Add agent"}));return l.a.createElement(c.EuiFlexGroup,{justifyContent:"flexEnd",direction:"row"},[{label:d.i18n.translate("xpack.fleet.policyDetails.summary.revision",{defaultMessage:"Revision"}),content:null!==(p=null==a?void 0:a.revision)&&void 0!==p?p:0},{isDivider:!0},{label:d.i18n.translate("xpack.fleet.policyDetails.summary.integrations",{defaultMessage:"Integrations"}),content:l.a.createElement(c.EuiI18nNumber,{value:a&&a.package_policies&&a.package_policies.length||0})},{isDivider:!0},{label:d.i18n.translate("xpack.fleet.policyDetails.summary.usedBy",{defaultMessage:"Agents"}),content:n&&n.total?l.a.createElement(x.f,{count:n.total,agentPolicyId:a&&a.id||"",showAgentText:!0}):null!=a&&a.is_managed?l.a.createElement(x.f,{count:0,agentPolicyId:a&&a.id||"",showAgentText:!0}):l.a.createElement(y.a,{button:h,isOpen:g,offset:15,closePopover:()=>{m(!1)}})},{isDivider:!0},{label:d.i18n.translate("xpack.fleet.policyDetails.summary.lastUpdated",{defaultMessage:"Last updated on"}),content:a&&l.a.createElement(u.FormattedDate,{value:null==a?void 0:a.updated_at,year:"numeric",month:"short",day:"2-digit"})||""},{isDivider:!0},{content:a&&l.a.createElement(x.a,{agentPolicy:a,fullButton:!0,onCopySuccess:e=>{E.push(f("policy_details",{policyId:e.id}))},onCancelEnrollment:s})}].map(((e,t)=>{var a;return l.a.createElement(c.EuiFlexItem,{grow:!1,key:t},null!==(a=e.isDivider)&&void 0!==a&&a?l.a.createElement(z,null):e.label?l.a.createElement(c.EuiDescriptionList,{compressed:!0,textStyle:"reverse",style:{textAlign:"right"}},l.a.createElement(c.EuiDescriptionListTitle,{className:"eui-textNoWrap"},e.label),l.a.createElement(c.EuiDescriptionListDescription,{className:"eui-textNoWrap"},e.content)):e.content)})))},H=()=>{var e;const{params:{policyId:t,tabId:a=""}}=Object(r.useRouteMatch)(),{getHref:i}=Object(o.lb)(),s=Object(o.ab)(t),g=s.data?s.data.item:null,{isLoading:m,error:p,sendRequest:f}=s,E=new URLSearchParams(Object(r.useLocation)().search),h="true"===E.get("openEnrollmentFlyout"),b="true"===E.get("showAddAgentHelp"),[v]=Object(n.useState)(!1),[x,M]=Object(n.useState)(h),[O,F]=Object(n.useState)(b),S=function(e,t){const a=Object(o.pb)({path:C.c.getStatusPath(),query:{policyId:e},method:"get",...t});return{isLoading:a.isLoading,data:a.data,error:a.error,refreshAgentStatus:()=>a.resendRequest}}(t),{refreshAgentStatus:j}=S,{application:{navigateToApp:I}}=Object(o.rb)(),w=Object(o.hb)(),T=null===(e=S.data)||void 0===e?void 0:e.results,{isReady:L}=Object(o.V)(),A=Object(n.useMemo)((()=>{if(w&&w.onDoneNavigateTo&&L){const[e,t]=w.onDoneNavigateTo;return()=>I(e,t)}}),[L,I,w]),_=Object(n.useCallback)((()=>{F(!1),M(!0)}),[]),D=Object(n.useMemo)((()=>[{id:"integrations",name:d.i18n.translate("xpack.fleet.policyDetails.subTabs.packagePoliciesTabText",{defaultMessage:"Integrations"}),href:i("policy_details",{policyId:t,tabId:"integrations"}),isSelected:""===a||"integrations"===a},{id:"settings",name:d.i18n.translate("xpack.fleet.policyDetails.subTabs.settingsTabText",{defaultMessage:"Settings"}),href:i("policy_details",{policyId:t,tabId:"settings"}),isSelected:"settings"===a}]),[i,t,a]),N=Object(n.useMemo)((()=>v?l.a.createElement(r.Redirect,{to:"/"}):m?l.a.createElement(y.l,null):p?l.a.createElement(y.h,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.unexceptedErrorTitle",defaultMessage:"An error happened while loading the agent policy"}),error:p}):g?l.a.createElement(l.a.Fragment,null,x&&l.a.createElement(c.EuiPortal,null,l.a.createElement(y.b,{agentPolicy:g,onClose:A||(()=>M(!1))})),l.a.createElement(q,{agentPolicy:g})):l.a.createElement(y.h,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.policyDetails.unexceptedErrorTitle",defaultMessage:"An error happened while loading the agent policy"}),error:d.i18n.translate("xpack.fleet.policyDetails.policyNotFoundErrorTitle",{defaultMessage:"Policy '{id}' not found",values:{id:t}})})),[v,m,p,g,x,A,t]),B=l.a.createElement(R,{agentPolicy:g,policyId:t,isLoading:m}),z=l.a.createElement(U,{agentPolicy:g,agentStatus:T,policyId:t,onCancelEnrollment:A,isLoading:m,isAddAgentHelpPopoverOpen:O,setIsAddAgentHelpPopoverOpen:F,addAgent:_});return l.a.createElement(o.a.Provider,{value:{refresh:f}},l.a.createElement(P.Provider,{value:{refresh:j}},l.a.createElement(k.c,{leftColumn:B,rightColumn:z,tabs:D},N)))},q=({agentPolicy:e})=>(Object(o.R)("policy_details",{policyName:e.name}),l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:v.g.policy_details_settings,render:()=>l.a.createElement(B,{agentPolicy:e})}),l.a.createElement(r.Route,{path:v.g.policy_details,render:()=>l.a.createElement(D,{agentPolicy:e})})));var G=a(120);const W=Object(n.memo)((()=>{const{params:{packagePolicyId:e}}=Object(r.useRouteMatch)(),{search:t}=Object(r.useLocation)(),a=new URLSearchParams(t).get("from");let n;return a&&"fleet-policy-list"===a?n="upgrade-from-fleet-policy-list":a&&"integrations-policy-list"===a&&(n="upgrade-from-integrations-policy-list"),l.a.createElement(G.a,{packagePolicyId:e,from:n,forceUpgrade:!0})})),$=()=>{Object(o.R)("policies");const e=Object(r.useHistory)();return l.a.createElement(r.Router,{history:e},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:v.g.edit_integration},l.a.createElement(G.b,null)),l.a.createElement(r.Route,{path:v.g.upgrade_package_policy},l.a.createElement(W,null)),l.a.createElement(r.Route,{path:v.g.policy_details},l.a.createElement(H,null)),l.a.createElement(r.Route,{path:v.g.policies_list},l.a.createElement(k.a,{section:"agent_policies"},l.a.createElement(I,null)))))},V=Object(n.memo)((({datastream:e})=>{const{dashboards:t}=e,a=[],n=l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.viewDashboardActionText",defaultMessage:"View dashboard"}),i=l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.viewDashboardsActionText",defaultMessage:"View dashboards"}),s=d.i18n.translate("xpack.fleet.dataStreamList.viewDashboardsPanelTitle",{defaultMessage:"View dashboards"});return t&&0!==t.length?1===t.length?a.push({id:0,items:[{icon:"dashboardApp",href:Object(o.ib)(`/dashboard/${t[0].id||""}`),name:n}]}):(a.push({id:0,items:[{icon:"dashboardApp",panel:1,name:i}]}),a.push({id:1,title:s,items:t.map((e=>({icon:"dashboardApp",href:Object(o.ib)(`/dashboard/${e.id||""}`),name:e.title})))})):a.push({id:0,items:[{icon:"dashboardApp",disabled:!0,name:n}]}),l.a.createElement(y.f,{panels:a})})),K=()=>{Object(o.R)("data_streams");const{data:{fieldFormats:e}}=Object(o.rb)(),{pagination:t,pageSizeOptions:a}=Object(o.nb)(),{isLoading:i,data:s,resendRequest:r}=Object(o.X)(),g=Object(n.useMemo)((()=>[{field:"dataset",sortable:!0,width:"25%",name:d.i18n.translate("xpack.fleet.dataStreamList.datasetColumnTitle",{defaultMessage:"Dataset"})},{field:"type",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.typeColumnTitle",{defaultMessage:"Type"})},{field:"namespace",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.namespaceColumnTitle",{defaultMessage:"Namespace"}),render:e=>e?l.a.createElement(c.EuiBadge,{color:"hollow"},e):""},{field:"package",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.integrationColumnTitle",{defaultMessage:"Integration"}),render:(e,t)=>l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},t.package_version&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(y.n,{packageName:e,version:t.package_version,size:"m",tryApi:!0})),l.a.createElement(c.EuiFlexItem,{grow:!1},e))},{field:"last_activity_ms",sortable:!0,width:"25%",dataType:"date",name:d.i18n.translate("xpack.fleet.dataStreamList.lastActivityColumnTitle",{defaultMessage:"Last activity"}),render:t=>{try{return e.getInstance("date",{pattern:"MMM D, YYYY @ HH:mm:ss"}).convert(t)}catch(e){return l.a.createElement(u.FormattedDate,{value:t,year:"numeric",month:"short",day:"2-digit"})}}},{field:"size_in_bytes",sortable:!0,name:d.i18n.translate("xpack.fleet.dataStreamList.sizeColumnTitle",{defaultMessage:"Size"}),render:t=>{try{return e.getInstance("bytes").convert(t)}catch(e){return`${t}b`}}},{name:d.i18n.translate("xpack.fleet.dataStreamList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>l.a.createElement(V,{datastream:e})}]}]),[e]),m=Object(n.useMemo)((()=>l.a.createElement(c.EuiEmptyPrompt,{title:l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.noDataStreamsPrompt",defaultMessage:"No data streams"}))})),[]),p={dataset:[],type:[],namespace:[],package:[]};if(s&&s.data_streams.length){const e={dataset:[],type:[],namespace:[],package:[]};s.data_streams.forEach((t=>{const{dataset:a,type:n,namespace:l,package:i}=t;e.dataset.includes(a)||e.dataset.push(a),e.type.includes(n)||e.type.push(n),e.namespace.includes(l)||e.namespace.push(l),e.package.includes(i)||e.package.push(i)}));for(const t in e)p[t]&&(p[t]=e[t].sort().map((e=>({value:e,name:e}))))}return l.a.createElement(c.EuiInMemoryTable,{loading:i,hasActions:!0,tableLayout:"auto",message:i?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.loadingDataStreamsMessage",defaultMessage:"Loading data streams…"}):s&&!s.data_streams.length?m:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.noFilteredDataStreamsMessage",defaultMessage:"No matching data streams found"}),items:s?s.data_streams:[],itemId:"index",columns:g,pagination:{initialPageSize:t.pageSize,pageSizeOptions:a},sorting:!0,search:{toolsRight:[l.a.createElement(c.EuiButton,{key:"reloadButton",color:"primary",iconType:"refresh",onClick:()=>r()},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.dataStreamList.reloadDataStreamsButtonText",defaultMessage:"Reload"}))],box:{placeholder:d.i18n.translate("xpack.fleet.dataStreamList.searchPlaceholderTitle",{defaultMessage:"Filter data streams"}),incremental:!0},filters:[{type:"field_value_selection",field:"dataset",name:d.i18n.translate("xpack.fleet.dataStreamList.datasetColumnTitle",{defaultMessage:"Dataset"}),multiSelect:"or",operator:"exact",options:p.dataset},{type:"field_value_selection",field:"type",name:d.i18n.translate("xpack.fleet.dataStreamList.typeColumnTitle",{defaultMessage:"Type"}),multiSelect:"or",operator:"exact",options:p.type},{type:"field_value_selection",field:"namespace",name:d.i18n.translate("xpack.fleet.dataStreamList.namespaceColumnTitle",{defaultMessage:"Namespace"}),multiSelect:"or",operator:"exact",options:p.namespace},{type:"field_value_selection",field:"package",name:d.i18n.translate("xpack.fleet.dataStreamList.integrationColumnTitle",{defaultMessage:"Integration"}),multiSelect:"or",operator:"exact",options:p.package}]}})},Q=()=>{const e=Object(r.useHistory)();return l.a.createElement(r.Router,{history:e},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:v.g.data_streams},l.a.createElement(k.a,{section:"data_streams"},l.a.createElement(K,null)))))};var Y=a(94);var Z=a(68);const X=Object(c.euiPaletteColorBlindBehindText)(),J={default:Z.euiLightVars.euiColorLightShade,primary:X[1],success:X[0],accent:X[2],warning:X[5],danger:X[9],inactive:Z.euiLightVars.euiColorDarkShade},ee=["healthy","unhealthy","updating","offline","inactive"];function te(e){switch(e){case"healthy":return J.success;case"offline":return J.default;case"inactive":return J.inactive;case"unhealthy":return J.warning;case"updating":return J.primary;default:throw new Error(`Insuported Agent status ${e}`)}}const ae=m()(c.EuiColorPaletteDisplay).withConfig({displayName:"StyledEuiColorPaletteDisplay",componentId:"sc-147tmhq-0"})(["&.ingest-agent-status-bar{border:none;border-radius:0;&:after{border:none;}}"]),ne=({agentStatus:e})=>{const t=Object(n.useMemo)((()=>ee.reduce(((t,a)=>{const n=t.length>0?t[t.length-1].stop:0;return t.push({stop:n+(e[a]||0),color:te(a)}),t}),[])),[e]);return l.a.createElement(l.a.Fragment,null,l.a.createElement(ae,{className:"ingest-agent-status-bar",size:"s",palette:t}))},le=m.a.div.withConfig({displayName:"Divider",componentId:"sc-1ynhme7-0"})(["width:0;height:",";border-left:",";"],(e=>e.theme.eui.euiSizeL),(e=>e.theme.eui.euiBorderThin)),ie=m()(c.EuiFlexItem).withConfig({displayName:"FlexItem",componentId:"sc-1ynhme7-1"})(["height:",";"],(e=>e.theme.eui.euiSizeL)),se=m()(c.EuiButtonEmpty).withConfig({displayName:"Button",componentId:"sc-1ynhme7-2"})([".euiButtonEmpty__text{font-size:",";}"],(e=>e.theme.eui.euiFontSizeXS)),re=({totalAgents:e,totalInactiveAgents:t,selectableAgents:a,selectionMode:i,setSelectionMode:s,currentQuery:r,selectedAgents:d,setSelectedAgents:g,refreshAgents:m})=>{const p=Object(o.jb)(),[f,E]=Object(n.useState)(!1),h=()=>E(!1),[b,y]=Object(n.useState)(!1),[k,x]=Object(n.useState)(!1),[M,O]=Object(n.useState)(!1),F="manual"===i?!!d.find((e=>e.active)):e>t,S=[{id:0,items:[{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.reassignPolicy",defaultMessage:"Assign to new policy"}),icon:l.a.createElement(c.EuiIcon,{type:"pencil",size:"m"}),disabled:!F,onClick:()=>{h(),y(!0)}},{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.unenrollAgents",defaultMessage:"Unenroll agents"}),icon:l.a.createElement(c.EuiIcon,{type:"trash",size:"m"}),disabled:!F,onClick:()=>{h(),x(!0)}},{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.upgradeAgents",defaultMessage:"Upgrade agents"}),icon:l.a.createElement(c.EuiIcon,{type:"refresh",size:"m"}),disabled:!F,onClick:()=>{h(),O(!0)}},{name:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.clearSelection",defaultMessage:"Clear selection"}),icon:l.a.createElement(c.EuiIcon,{type:"cross",size:"m"}),onClick:()=>{h(),s("manual"),g([])}}]}],j="manual"===i&&d.length===a&&a<e,I=e-t,C="manual"===i?d.length:I,P="manual"===i?d:r;return l.a.createElement(l.a.Fragment,null,b&&l.a.createElement(c.EuiPortal,null,l.a.createElement(Y.c,{agents:P,onClose:()=>{y(!1),m()}})),k&&l.a.createElement(c.EuiPortal,null,l.a.createElement(Y.d,{agents:P,agentCount:C,onClose:()=>{x(!1),m()}})),M&&l.a.createElement(c.EuiPortal,null,l.a.createElement(Y.e,{version:p,agents:P,agentCount:C,onClose:()=>{O(!1),m()}})),l.a.createElement(c.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{size:"xs",color:"subdued"},e>v.m?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.totalAgentsWithLimit",defaultMessage:"Showing {count} of {total} agents",values:{count:l.a.createElement(u.FormattedNumber,{value:v.m}),total:l.a.createElement(u.FormattedNumber,{value:e})}}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.totalAgents",defaultMessage:"Showing {count, plural, one {# agent} other {# agents}}",values:{count:e}}))),"manual"===i&&d.length||"query"===i&&e>0?l.a.createElement(l.a.Fragment,null,l.a.createElement(ie,{grow:!1},l.a.createElement(le,null)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiPopover,{id:"agentBulkActionsMenu",button:l.a.createElement(se,{size:"xs",iconType:"arrowDown",iconSide:"right",flush:"left",onClick:()=>E(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.agentsSelected",defaultMessage:"{count, plural, one {# agent} other {# agents} =all {All agents}} selected",values:{count:"manual"===i?d.length:"all"}})),isOpen:f,closePopover:h,panelPaddingSize:"none",anchorPosition:"downLeft"},l.a.createElement(c.EuiContextMenu,{initialPanelId:0,panels:S}))),j?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(se,{size:"xs",iconType:"pagesSelect",iconSide:"left",flush:"left",onClick:()=>s("query")},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentBulkActions.selectAll",defaultMessage:"Select everything on all pages"}))):null):l.a.createElement(ie,{grow:!1})))},oe=Object(n.memo)((({agentStatus:e,showInactive:t})=>{const a=Object(n.useMemo)((()=>ee.filter((e=>!!t||"inactive"!==e))),[t]);return l.a.createElement(c.EuiFlexGroup,{gutterSize:"m"},a.map((t=>l.a.createElement(c.EuiFlexItem,{key:t,grow:!1},l.a.createElement(ce,{status:t,count:e[t]||0})))))})),ce=Object(n.memo)((({status:e,count:t})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiHealth,{color:te(e)},l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:!1},function(e){switch(e){case"healthy":return d.i18n.translate("xpack.fleet.agentStatus.healthyLabel",{defaultMessage:"Healthy"});case"offline":return d.i18n.translate("xpack.fleet.agentStatus.offlineLabel",{defaultMessage:"Offline"});case"inactive":return d.i18n.translate("xpack.fleet.agentStatus.inactiveLabel",{defaultMessage:"Inactive"});case"unhealthy":return d.i18n.translate("xpack.fleet.agentStatus.unhealthyLabel",{defaultMessage:"Unhealthy"});case"updating":return d.i18n.translate("xpack.fleet.agentStatus.updatingLabel",{defaultMessage:"Updating"});default:throw new Error(`Insuported Agent status ${e}`)}}(e)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiNotificationBadge,{size:"s",color:"subdued"},t))))))),ue=({agentStatus:e,totalAgents:t,totalInactiveAgents:a,selectableAgents:n,selectionMode:i,setSelectionMode:s,currentQuery:r,selectedAgents:o,setSelectedAgents:u,refreshAgents:d,showInactive:g})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(re,{totalAgents:t,totalInactiveAgents:a,selectableAgents:n,selectionMode:i,setSelectionMode:s,currentQuery:r,selectedAgents:o,setSelectedAgents:u,refreshAgents:d})),l.a.createElement(c.EuiFlexItem,{grow:!1},e&&l.a.createElement(oe,{showInactive:g,agentStatus:e}))),l.a.createElement(c.EuiSpacer,{size:"s"}),e&&l.a.createElement(ne,{agentStatus:e})),de=[{status:"healthy",label:d.i18n.translate("xpack.fleet.agentList.statusHealthyFilterText",{defaultMessage:"Healthy"})},{status:"unhealthy",label:d.i18n.translate("xpack.fleet.agentList.statusUnhealthyFilterText",{defaultMessage:"Unhealthy"})},{status:"updating",label:d.i18n.translate("xpack.fleet.agentList.statusUpdatingFilterText",{defaultMessage:"Updating"})},{status:"offline",label:d.i18n.translate("xpack.fleet.agentList.statusOfflineFilterText",{defaultMessage:"Offline"})},{status:"inactive",label:d.i18n.translate("xpack.fleet.agentList.statusInactiveFilterText",{defaultMessage:"Inactive"})}],ge=({agentPolicies:e,draftKuery:t,onDraftKueryChange:a,onSubmitSearch:i,selectedAgentPolicies:s,onSelectedAgentPoliciesChange:r,selectedStatus:o,onSelectedStatusChange:d,showUpgradeable:g,onShowUpgradeableChange:m})=>{const[p,f]=Object(n.useState)(!1),[E,h]=Object(n.useState)(!1),[b,k]=Object(n.useState)(!1);return l.a.createElement(l.a.Fragment,null,p?l.a.createElement(c.EuiPortal,null,l.a.createElement(y.b,{onClose:()=>f(!1)})):null,l.a.createElement(c.EuiFlexGroup,{alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:4},l.a.createElement(c.EuiFlexGroup,{gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:6},l.a.createElement(y.p,{value:t,onChange:(e,t)=>{a(e),t&&i(e)},indexPattern:v.a})),l.a.createElement(c.EuiFlexItem,{grow:2},l.a.createElement(c.EuiFilterGroup,null,l.a.createElement(c.EuiPopover,{ownFocus:!0,button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:()=>k(!b),isSelected:b,hasActiveFilters:o.length>0,disabled:0===e.length},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.statusFilterText",defaultMessage:"Status"})),isOpen:b,closePopover:()=>k(!1),panelPaddingSize:"none"},l.a.createElement("div",{className:"euiFilterSelect__items"},de.map((({label:e,status:t},a)=>l.a.createElement(c.EuiFilterSelectItem,{key:a,checked:o.includes(t)?"on":void 0,onClick:()=>{o.includes(t)?d([...o.filter((e=>e!==t))]):d([...o,t])}},e))))),l.a.createElement(c.EuiPopover,{ownFocus:!0,button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:()=>h(!E),isSelected:E,hasActiveFilters:s.length>0,numActiveFilters:s.length,numFilters:e.length,disabled:0===e.length},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.policyFilterText",defaultMessage:"Agent policy"})),isOpen:E,closePopover:()=>h(!1),panelPaddingSize:"none"},l.a.createElement("div",{className:"euiFilterSelect__items"},e.map(((e,t)=>l.a.createElement(c.EuiFilterSelectItem,{checked:s.includes(e.id)?"on":void 0,key:t,onClick:()=>{var t;s.includes(e.id)?(t=e.id,r(s.filter((e=>e!==t)))):(e=>{r([...s,e])})(e.id)}},e.name))))),l.a.createElement(c.EuiFilterButton,{hasActiveFilters:g,onClick:()=>{m(!g)}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.showUpgradeableFilterLabel",defaultMessage:"Upgrade available"})))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>f(!0),"data-test-subj":"addAgentButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addButton",defaultMessage:"Add agent"})))))))},me=l.a.memo((({agent:e,agentPolicy:t,refresh:a,onReassignClick:i,onUnenrollClick:s,onUpgradeClick:r})=>{const{getHref:d}=Object(o.lb)(),g=Object(o.Q)().fleet.all,m="unenrolling"===e.status,p=Object(o.jb)(),[f,E]=Object(n.useState)(!1),h=[l.a.createElement(c.EuiContextMenuItem,{icon:"inspect",href:d("agent_details",{agentId:e.id}),key:"viewAgent"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.viewActionText",defaultMessage:"View agent"}))];return!1===(null==t?void 0:t.is_managed)&&h.push(l.a.createElement(c.EuiContextMenuItem,{icon:"pencil",onClick:()=>{i()},disabled:!e.active,key:"reassignPolicy"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.reassignActionText",defaultMessage:"Assign to new policy"})),l.a.createElement(c.EuiContextMenuItem,{disabled:!g||!e.active,icon:"trash",onClick:()=>{s()}},m?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.forceUnenrollOneButton",defaultMessage:"Force unenroll"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.unenrollOneButton",defaultMessage:"Unenroll agent"})),l.a.createElement(c.EuiContextMenuItem,{icon:"refresh",disabled:!Object(C.j)(e,p),onClick:()=>{r()}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.upgradeOneButton",defaultMessage:"Upgrade agent"}))),l.a.createElement(y.f,{isOpen:f,onChange:e=>E(e),items:h})}));function pe(e){return"string"!=typeof e?"-":e}const fe=()=>{const{notifications:e,cloud:t}=Object(o.rb)();Object(o.R)("agent_list");const{getHref:a}=Object(o.lb)(),i=Object(o.ub)().urlParams.kuery||"",s=Object(o.Q)().fleet.all,r=Object(o.kb)().isGoldPlus(),g=Object(o.jb)(),[m,p]=Object(n.useState)(!1),[f,E]=Object(n.useState)(i),[h,b]=Object(n.useState)(i),[k,x]=Object(n.useState)("manual"),[M,O]=Object(n.useState)([]),F=Object(n.useRef)(null),{pagination:S,pageSizeOptions:j,setPagination:I}=Object(o.nb)(),P=Object(n.useCallback)((e=>{b(e),I({...S,currentPage:1})}),[b,S,I]),[w,T]=Object(n.useState)([]),[L,A]=Object(n.useState)([]),_=h.trim()||w.length||L.length||m,D=Object(n.useCallback)((()=>{E(""),b(""),T([]),A([]),p(!1)}),[b,E,T,A,p]),[N,B]=Object(n.useState)({isOpen:!1}),[R,z]=Object(n.useState)(void 0),[U,H]=Object(n.useState)(void 0),[q,G]=Object(n.useState)(void 0),W=Object(n.useMemo)((()=>{let e=h.trim();if(w.length&&(e&&(e=`(${e}) and`),e=`${e} ${v.b}.policy_id : (${w.map((e=>`"${e}"`)).join(" or ")})`),L.length){const t=L.map((e=>{switch(e){case"healthy":return C.a.buildKueryForOnlineAgents();case"unhealthy":return C.a.buildKueryForErrorAgents();case"offline":return C.a.buildKueryForOfflineAgents();case"updating":return C.a.buildKueryForUpdatingAgents();case"inactive":return C.a.buildKueryForInactiveAgents()}})).filter((e=>void 0!==e)).join(" or ");e=e?`(${e}) and (${t})`:t}return e}),[L,w,h]),$=Object(n.useMemo)((()=>L.includes("inactive")),[L]),[V,K]=Object(n.useState)([]),[Q,Z]=Object(n.useState)(),[X,J]=Object(n.useState)(!1),[ee,te]=Object(n.useState)(0),[ae,ne]=Object(n.useState)(0),le=Object(n.useRef)(0),ie=Object(n.useCallback)((()=>{!async function(){le.current++;const t=le.current;try{J(!0);const[e,a]=await Promise.all([Object(o.r)({page:S.currentPage,perPage:S.pageSize,kuery:W&&""!==W?W:void 0,showInactive:$,showUpgradeable:m}),Object(o.q)({kuery:W&&""!==W?W:void 0})]);if(le.current!==t)return;if(e.error)throw e.error;if(!e.data)throw new Error("Invalid GET /agents response");if(a.error)throw a.error;if(!a.data)throw new Error("Invalid GET /agents-status response");Z({healthy:a.data.results.online,unhealthy:a.data.results.error,offline:a.data.results.offline,updating:a.data.results.updating,inactive:e.data.totalInactive}),K(e.data.items),te(e.data.total),ne(e.data.totalInactive)}catch(t){e.toasts.addError(t,{title:d.i18n.translate("xpack.fleet.agentList.errorFetchingDataTitle",{defaultMessage:"Error fetching agents"})})}J(!1)}()}),[S,W,$,m,e.toasts]);Object(n.useEffect)((()=>{ie();const e=setInterval((()=>{ie()}),3e4);return()=>clearInterval(e)}),[ie]);const se=Object(o.W)({page:1,perPage:1e3,full:!0}),re=Object(n.useMemo)((()=>se.data?se.data.items:[]),[se]),oe=Object(n.useMemo)((()=>re.reduce(((e,t)=>(e[t.id]=t,e)),{})),[re]),ce=e=>{if(!e.active)return!1;if(!e.policy_id)return!0;const t=oe[e.policy_id];return!(!0===(null==t?void 0:t.is_managed))},de=Object(n.useMemo)((()=>{if(!U||!U.policy_id)return!1;const e=oe[U.policy_id];return!!e&&e.package_policies.some((e=>{var t;return"string"!=typeof e&&(null===(t=e.package)||void 0===t?void 0:t.name)===v.h}))}),[U,oe]),{isUnhealthy:fe}=function(){const{notifications:e}=Object(o.rb)(),[t,a]=Object(n.useState)(!0),[l,i]=Object(n.useState)(!1),s=Object(n.useCallback)((async()=>{try{var t,n;const e=await Object(o.y)({page:1,perPage:1e4,kuery:`${v.l}.package.name:${v.h}`});if(e.error)throw e.error;const r=[...new Set(null!==(t=null===(n=e.data)||void 0===n?void 0:n.items.map((e=>e.policy_id)))&&void 0!==t?t:[])];if(r.length>0){var l,s;const e=await Object(o.q)({kuery:r.map((e=>`policy_id:"${e}"`)).join(" or ")});if(e.error)throw e.error;0===(null===(l=e.data)||void 0===l?void 0:l.results.online)&&0===(null===(s=e.data)||void 0===s?void 0:s.results.updating)&&i(!0)}a(!1)}catch(t){e.toasts.addError(t,{title:d.i18n.translate("xpack.fleet.fleetServerUnhealthy.requestError",{defaultMessage:"An error happened while fetching fleet server status"})}),a(!1)}}),[e.toasts]);return Object(n.useEffect)((()=>{s()}),[s]),{isLoading:t,isUnhealthy:l}}(),Ee=Object(n.useCallback)((()=>{B({isOpen:!0,selectedPolicyId:re.length>0?re[0].id:void 0})}),[re]),he=[{field:"local_metadata.host.hostname",name:d.i18n.translate("xpack.fleet.agentList.hostColumnTitle",{defaultMessage:"Host"}),render:(e,t)=>l.a.createElement(c.EuiLink,{href:a("agent_details",{agentId:t.id})},pe(e))},{field:"active",width:"120px",name:d.i18n.translate("xpack.fleet.agentList.statusColumnTitle",{defaultMessage:"Status"}),render:(e,t)=>l.a.createElement(Y.a,{agent:t})},{field:"policy_id",name:d.i18n.translate("xpack.fleet.agentList.policyColumnTitle",{defaultMessage:"Agent policy"}),render:(e,t)=>{const a=oe[e],n=t.policy_revision&&(null==a?void 0:a.revision)>t.policy_revision;return l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center",style:{minWidth:0}},a&&l.a.createElement(y.e,{policy:a}),n&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},l.a.createElement(c.EuiIcon,{size:"m",type:"alert",color:"warning"})," ",l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.outOfDateLabel",defaultMessage:"Out-of-date"}))))}},{field:"local_metadata.elastic.agent.version",width:"200px",name:d.i18n.translate("xpack.fleet.agentList.versionTitle",{defaultMessage:"Version"}),render:(e,t)=>l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center",style:{minWidth:0}},l.a.createElement(c.EuiFlexItem,{grow:!1,className:"eui-textNoWrap"},pe(e)),ce(t)&&Object(C.j)(t,g)?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},l.a.createElement(c.EuiIcon,{size:"m",type:"alert",color:"warning"})," ",l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.agentUpgradeLabel",defaultMessage:"Upgrade available"}))):null)},{field:"last_checkin",name:d.i18n.translate("xpack.fleet.agentList.lastCheckinTitle",{defaultMessage:"Last activity"}),render:(e,t)=>e?l.a.createElement(u.FormattedRelative,{value:e}):null},{name:d.i18n.translate("xpack.fleet.agentList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>{const t="string"==typeof e.policy_id?oe[e.policy_id]:void 0;return l.a.createElement(me,{agent:e,agentPolicy:t,refresh:()=>ie(),onReassignClick:()=>z(e),onUnenrollClick:()=>H(e),onUpgradeClick:()=>G(e)})}}],width:"100px"}],be=l.a.createElement(c.EuiEmptyPrompt,{title:l.a.createElement("h2",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.noAgentsPrompt",defaultMessage:"No agents enrolled"})),actions:s?l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>B({isOpen:!0})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.addButton",defaultMessage:"Add agent"})):null});return l.a.createElement(l.a.Fragment,null,N.isOpen?l.a.createElement(c.EuiPortal,null,l.a.createElement(y.b,{agentPolicy:re.find((e=>e.id===N.selectedPolicyId)),onClose:()=>B({isOpen:!1})})):null,R&&l.a.createElement(c.EuiPortal,null,l.a.createElement(Y.c,{agents:[R],onClose:()=>{z(void 0),ie()}})),U&&l.a.createElement(c.EuiPortal,null,l.a.createElement(Y.d,{agents:[U],agentCount:1,onClose:()=>{H(void 0),ie()},useForceUnenroll:"unenrolling"===U.status,hasFleetServer:de})),q&&l.a.createElement(c.EuiPortal,null,l.a.createElement(Y.e,{agents:[q],agentCount:1,onClose:()=>{G(void 0),ie()},version:g})),fe&&l.a.createElement(l.a.Fragment,null,null!=t&&t.deploymentUrl?l.a.createElement(Y.g,{deploymentUrl:t.deploymentUrl}):l.a.createElement(Y.i,{onClickAddFleetServer:Ee}),l.a.createElement(c.EuiSpacer,{size:"l"})),l.a.createElement(ge,{agentPolicies:re,draftKuery:f,onDraftKueryChange:E,onSubmitSearch:P,selectedAgentPolicies:w,onSelectedAgentPoliciesChange:T,selectedStatus:L,onSelectedStatusChange:A,showUpgradeable:m,onShowUpgradeableChange:p}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(ue,{showInactive:$,totalAgents:ee,totalInactiveAgents:ae,agentStatus:Q,selectableAgents:(null==V?void 0:V.filter(ce).length)||0,selectionMode:k,setSelectionMode:x,currentQuery:W,selectedAgents:M,setSelectedAgents:e=>{null!=F&&F.current&&(F.current.setSelection(e),x("manual"))},refreshAgents:()=>ie()}),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiBasicTable,{ref:F,className:"fleet__agentList__table","data-test-subj":"fleetAgentListTable",loading:X,hasActions:!0,noItemsMessage:X&&1===le.current?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.loadingAgentsMessage",defaultMessage:"Loading agents…"}):_?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.noFilteredAgentsPrompt",defaultMessage:"No agents found. {clearFiltersLink}",values:{clearFiltersLink:l.a.createElement(c.EuiLink,{onClick:()=>D()},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.clearFiltersLinkText",defaultMessage:"Clear filters"}))}}):be,items:ee?m?V.filter((e=>ce(e)&&Object(C.j)(e,g))):V:[],itemId:"id",columns:he,pagination:{pageIndex:S.currentPage-1,pageSize:S.pageSize,totalItemCount:ee,pageSizeOptions:j},isSelectable:!0,selection:r?{onSelectionChange:e=>{O(e),x("manual")},selectable:ce,selectableMessage:(e,t)=>e?"":t.active?t.policy_id&&oe[t.policy_id].is_managed?"This action is not available for agents enrolled in an externally managed agent policy":"":"This agent is not active"}:void 0,onChange:({page:e})=>{const t={...S,currentPage:e.index+1,pageSize:e.size};I(t)}}))};var Ee=a(121);const he=l.a.createContext({refresh:()=>{}});var be=a(38);const ye="logs-elastic_agent-*,logs-elastic_agent.*-*",ve="elastic_agent",ke="elastic_agent.id",xe={name:"data_stream.dataset",type:"string",aggregatable:!0},Me={name:"log.level",type:"string",aggregatable:!0},Oe="now-1d",Fe="now",Se={start:Oe,end:Fe,logLevels:[],datasets:[ve],query:""},je={ERROR:"error",WARNING:"warning",INFO:"info",DEBUG:"debug"},Ie=["error","warning","warn","notice","info","debug"],Ce=je.INFO;var Pe=a(279),we=a.n(Pe),Te=a(142),Le=a(74),Ae=a(286),_e=a.n(Ae),De=a(143),Ne=a(285),Be=a.n(Ne),Re=a(34),ze=a.n(Re),Ue=a(75);const He=Object(n.memo)((({selectedDatasets:e,onToggleDataset:t})=>{const{data:a}=Object(o.rb)(),[i,s]=Object(n.useState)(!1),[r,u]=Object(n.useState)(!1),[g,m]=Object(n.useState)([ve]),p=Object(n.useCallback)((()=>s((e=>!e))),[s]),f=Object(n.useCallback)((()=>s(!1)),[s]);return Object(n.useEffect)((()=>{(async()=>{u(!0);try{const e=await a.autocomplete.getValueSuggestions({indexPattern:{title:ye,fields:[xe]},field:xe,query:""});e.length>0&&m(e.sort())}catch(e){m([ve])}u(!1)})()}),[a.autocomplete]),l.a.createElement(c.EuiPopover,{button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:p,isSelected:i,isLoading:r,numFilters:g.length,hasActiveFilters:e.length>0,numActiveFilters:e.length},d.i18n.translate("xpack.fleet.agentLogs.datasetSelectText",{defaultMessage:"Dataset"})),isOpen:i,closePopover:f,panelPaddingSize:"none"},g.map((a=>l.a.createElement(c.EuiFilterSelectItem,{checked:e.includes(a)?"on":void 0,key:a,onClick:()=>t(a)},a))))}));const qe=Object(n.memo)((({selectedLevels:e,onToggleLevel:t})=>{const{data:a}=Object(o.rb)(),[i,s]=Object(n.useState)(!1),[r,u]=Object(n.useState)(!1),[g,m]=Object(n.useState)([]),p=Object(n.useCallback)((()=>s((e=>!e))),[]),f=Object(n.useCallback)((()=>s(!1)),[]);Object(n.useEffect)((()=>{(async()=>{u(!0);try{const t=await a.autocomplete.getValueSuggestions({indexPattern:{title:ye,fields:[Me]},field:Me,query:""});m((e=t,[...new Set([...Ie.filter((t=>e.includes(t))),...e.sort()])]))}catch(e){m([])}var e;u(!1)})()}),[a.autocomplete]);const E=l.a.createElement("div",{className:"euiFilterSelect__note"},l.a.createElement("div",{className:"euiFilterSelect__noteContent"},l.a.createElement(c.EuiIcon,{type:"minusInCircle"}),l.a.createElement(c.EuiSpacer,{size:"xs"}),l.a.createElement("p",null,d.i18n.translate("xpack.fleet.agentLogs.logLevelEmpty",{defaultMessage:"No Logs Found"})))),h=g.map((a=>l.a.createElement(c.EuiFilterSelectItem,{checked:e.includes(a)?"on":void 0,key:a,onClick:()=>t(a)},a)));return l.a.createElement(c.EuiPopover,{button:l.a.createElement(c.EuiFilterButton,{iconType:"arrowDown",onClick:p,isSelected:i,isLoading:r,numFilters:g.length,hasActiveFilters:e.length>0,numActiveFilters:e.length},d.i18n.translate("xpack.fleet.agentLogs.logLevelSelectText",{defaultMessage:"Log level"})),isOpen:i,closePopover:f,panelPaddingSize:"none"},0===g.length?E:h)}));var Ge=a(67);const We=[ke,xe.name,Me.name],$e=Object(n.memo)((({query:e,isQueryValid:t,onUpdateQuery:a})=>{const{data:i}=Object(o.rb)(),[s,r]=Object(n.useState)();return Object(n.useEffect)((()=>{(async()=>{try{const e=(await i.dataViews.getFieldsForWildcard({pattern:ye})||[]).filter((e=>!We.includes(e.name)));r(e)}catch(e){r(void 0)}})()}),[i.dataViews]),l.a.createElement(Ge.QueryStringInput,{iconType:"search",disableLanguageSwitcher:!0,indexPatterns:s?[{title:ye,fields:s}]:[],query:{query:e,language:"kuery"},isInvalid:!t,disableAutoFocus:!0,placeholder:d.i18n.translate("xpack.fleet.agentLogs.searchPlaceholderText",{defaultMessage:"Search logs…"}),onChange:e=>{a(e.query)},onSubmit:e=>{a(e.query,!0)}})})),Ve=Object.values(je),Ke=Object(n.memo)((({agent:e})=>{var t,a,i,s;const{notifications:r}=Object(o.rb)(),[g,m]=Object(n.useState)(!1),[p,f]=Object(n.useState)(null!==(t=null===(a=e.local_metadata)||void 0===a||null===(i=a.elastic)||void 0===i||null===(s=i.agent)||void 0===s?void 0:s.log_level)&&void 0!==t?t:Ce),[E,h]=Object(n.useState)(p),b=Object(n.useCallback)((()=>{m(!0),async function(){try{const t=await Object(o.A)(e.id,{action:{type:"SETTINGS",data:{log_level:E}}});if(t.error)throw t.error;f(E),r.toasts.addSuccess(d.i18n.translate("xpack.fleet.agentLogs.selectLogLevel.successText",{defaultMessage:"Changed agent logging level to '{logLevel}'.",values:{logLevel:E}}))}catch(e){r.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.agentLogs.selectLogLevel.errorTitleText",{defaultMessage:"Error updating agent logging level"})})}m(!1)}()}),[r,E,e.id]);return l.a.createElement(c.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFormLabel,{htmlFor:"selectAgentLogLevel"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.selectLogLevelLabelText",defaultMessage:"Agent logging level"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiSelect,{disabled:g,compressed:!0,id:"selectAgentLogLevel",value:E,onChange:e=>{h(e.target.value)},options:Ve.map((e=>({text:e,value:e})))})),p!==E&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{flush:"left",size:"xs",isLoading:g,disabled:p===E,iconType:"refresh",onClick:b},g?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.updateButtonLoadingText",defaultMessage:"Applying changes..."}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.updateButtonText",defaultMessage:"Apply changes"}))))})),Qe=m()(c.EuiFlexGroup).withConfig({displayName:"WrapperFlexGroup",componentId:"sc-mjo9ba-0"})(["height:100%;"]),Ye=m()(c.EuiFlexItem).withConfig({displayName:"DatePickerFlexItem",componentId:"sc-mjo9ba-1"})(["max-width:312px;"]),Ze=Object(be.createStateContainerReactHelpers)(),Xe=({agentPolicy:e})=>{const{getHref:t}=Object(o.lb)();return l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiCallOut,{size:"m",color:"primary",iconType:"iInCircle",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.logDisabledCallOutTitle",defaultMessage:"Log collection is disabled"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.logDisabledCallOutDescription",defaultMessage:"Update the agent's policy {settingsLink} to enable logs collection.",values:{settingsLink:l.a.createElement(c.EuiLink,{href:t("policy_details",{policyId:e.id,tabId:"settings"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.settingsLink",defaultMessage:"settings"}))}})))},Je=Object(n.memo)((({agent:e,agentPolicy:t,state:a})=>{var i,s,r,d;const{data:g,application:m,http:p}=Object(o.rb)(),{update:f}=Ze.useTransitions(),h=Object(n.useCallback)((e=>{const{min:t,max:a}=g.query.timefilter.timefilter.calculateBounds(e);return t&&a?{start:t.valueOf(),end:a.valueOf()}:void 0}),[g.query.timefilter.timefilter]),b=Object(n.useCallback)((e=>{h(e)&&f({start:e.from,end:e.to})}),[h,f]),[y,v]=Object(n.useState)(h({from:a.start,to:a.end})||h({from:Oe,to:Fe}));Object(n.useEffect)((()=>{const e=h({from:a.start,to:a.end});e?v(e):b({from:Oe,to:Fe})}),[a.start,a.end,h,b]);const k=Object(n.useCallback)((e=>{try{return Object(De.a)(e),!0}catch(e){return!1}}),[]),[x,M]=Object(n.useState)(a.query),[O,F]=Object(n.useState)(k(a.query)),S=Object(n.useCallback)(((e,t)=>{M(e),k(e)?(F(!0),t&&f({query:e})):F(!1)}),[k,f]),j=Object(n.useMemo)((()=>(({agentId:e,datasets:t,logLevels:a,userQuery:n})=>{const l=`${ke}:${e}`,i=t.length?t.map((e=>`${xe.name}:${e}`)).join(" or "):`${xe.name}:elastic_agent or ${xe.name}:elastic_agent.*`,s=a.map((e=>`${Me.name}:${e}`)).join(" or "),r=`${l} and (${i})`,o=s?`${r} and (${s})`:r;return n?`(${o}) and (${n})`:o})({agentId:e.id,datasets:a.datasets,logLevels:a.logLevels,userQuery:a.query})),[e.id,a.datasets,a.logLevels,a.query]),I=Object(n.useMemo)((()=>p.basePath.prepend(we.a.format({pathname:"/app/logs/stream",search:Object(Te.stringify)({logPosition:Object(Le.encode)({start:a.start,end:a.end,streamLive:!1}),logFilter:Object(Le.encode)({expression:j,kind:"kuery"})})}))),[p.basePath,a.start,a.end,j]),C=null===(i=e.local_metadata)||void 0===i||null===(s=i.elastic)||void 0===s||null===(r=s.agent)||void 0===r?void 0:r.version,P=Object(n.useMemo)((()=>{var e;if(!C)return!1;const t=null===(e=ze()(C))||void 0===e?void 0:e.version;return!!t&&Be()(t,"7.11.0")}),[C]),[w,{height:T}]=_e()(),L=Object(n.useMemo)((()=>Math.max(T,600)),[T]);return P?l.a.createElement(Qe,{direction:"column",gutterSize:"m"},t&&!(null!==(d=t.monitoring_enabled)&&void 0!==d&&d.includes("logs"))&&!t.is_managed&&l.a.createElement(Xe,{agentPolicy:t}),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexGroup,{gutterSize:"m"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement($e,{query:x,onUpdateQuery:S,isQueryValid:O})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFilterGroup,null,l.a.createElement(He,{selectedDatasets:a.datasets,onToggleDataset:e=>{const t=[...a.datasets],n=t.indexOf(e);n>=0?(t.splice(n,1),f({datasets:t})):f({datasets:[...a.datasets,e]})}}),l.a.createElement(qe,{selectedLevels:a.logLevels,onToggleLevel:e=>{const t=[...a.logLevels],n=t.indexOf(e);n>=0?(t.splice(n,1),f({logLevels:t})):f({logLevels:[...a.logLevels,e]})}}))),l.a.createElement(Ye,{grow:!1},l.a.createElement(c.EuiSuperDatePicker,{showUpdateButton:!1,start:a.start,end:a.end,onTimeChange:({start:e,end:t})=>{b({from:e,to:t})}})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(E.RedirectAppLinks,{application:m},l.a.createElement(c.EuiButtonEmpty,{href:I,iconType:"popout",flush:"both"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.openInLogsUiLinkText",defaultMessage:"Open in Logs"})))))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiPanel,{paddingSize:"none",panelRef:w},l.a.createElement(Ue.LogStream,{height:L,startTimestamp:y.start,endTimestamp:y.end,query:j}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(Ke,{agent:e}))):l.a.createElement(c.EuiCallOut,{size:"m",color:"warning",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.oldAgentWarningTitle",defaultMessage:"The Logs view requires Elastic Agent 7.11 or higher. To upgrade an agent, go to the Actions menu, or {downloadLink} a newer version.",values:{downloadLink:l.a.createElement(c.EuiLink,{href:"https://ela.st/download-elastic-agent",external:!0,target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentLogs.downloadLink",defaultMessage:"download"}))}})})})),et=Object(n.memo)((({agent:e,agentPolicy:t})=>{const a=Object(n.useMemo)((()=>Object(be.createStateContainer)({...Se,...Object(be.getStateFromKbnUrl)("_q",window.location.href,{getFromHashQuery:!1})},{update:e=>t=>({...e,...t})})),[]),i=Object(n.useMemo)((()=>Ze.connect((e=>({state:e||Se})))(Je)),[]),[s,r]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{const e=Object(be.createKbnUrlStateStorage)({useHashQuery:!1,useHash:!1}),{start:t,stop:n}=Object(be.syncState)({storageKey:"_q",stateContainer:a,stateStorage:e});return t(),r(!0),()=>{n(),a.set(Se)}}),[a]),l.a.createElement(Ze.Provider,{value:a},s?l.a.createElement(i,{agent:e,agentPolicy:t}):null)}));var tt=a(101);const at=Object(n.memo)((({agent:e,assignFlyoutOpenByDefault:t=!1,onCancelReassign:a,agentPolicy:i})=>{const s=Object(o.Q)().fleet.all,r=Object(o.jb)(),d=l.a.useContext(he).refresh,[g,m]=Object(n.useState)(t),[p,f]=Object(n.useState)(!1),[E,h]=Object(n.useState)(!1),b="unenrolling"===e.status,v=i&&Object(tt.a)(i),k=Object(n.useMemo)((()=>a||(()=>m(!1))),[a,m]);return l.a.createElement(l.a.Fragment,null,g&&l.a.createElement(c.EuiPortal,null,l.a.createElement(Y.c,{agents:[e],onClose:k})),p&&l.a.createElement(c.EuiPortal,null,l.a.createElement(Y.d,{agents:[e],agentCount:1,onClose:()=>{f(!1),d()},useForceUnenroll:b,hasFleetServer:v})),E&&l.a.createElement(c.EuiPortal,null,l.a.createElement(Y.e,{agents:[e],agentCount:1,version:r,onClose:()=>{h(!1),d()}})),l.a.createElement(y.f,{button:{props:{iconType:"arrowDown",iconSide:"right",color:"primary"},children:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.actionsButton",defaultMessage:"Actions"})},items:[l.a.createElement(c.EuiContextMenuItem,{icon:"pencil",onClick:()=>{m(!0)},disabled:!e.active,key:"reassignPolicy"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.reassignActionText",defaultMessage:"Assign to new policy"})),l.a.createElement(c.EuiContextMenuItem,{icon:"cross",disabled:!s||!e.active,onClick:()=>{f(!0)}},b?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.forceUnenrollOneButton",defaultMessage:"Force unenroll"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.unenrollOneButton",defaultMessage:"Unenroll agent"})),l.a.createElement(c.EuiContextMenuItem,{icon:"refresh",disabled:!Object(C.j)(e,r),onClick:()=>{h(!0)}},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.upgradeOneButton",defaultMessage:"Upgrade agent"}))]}))})),nt=m()(c.EuiFlexItem).withConfig({displayName:"FlexItemWithMinWidth",componentId:"sc-19wc892-0"})(["min-width:0px;"]),lt=Object(n.memo)((({agent:e,agentPolicy:t})=>{var a,n,i,s,r,g,m,p,f,E,h,b,v,k,x;const M=Object(o.jb)();return l.a.createElement(c.EuiPanel,null,l.a.createElement(c.EuiDescriptionList,{compressed:!0},[{title:d.i18n.translate("xpack.fleet.agentDetails.hostIdLabel",{defaultMessage:"Agent ID"}),description:e.id},{title:d.i18n.translate("xpack.fleet.agentDetails.agentPolicyLabel",{defaultMessage:"Agent policy"}),description:t?l.a.createElement(y.e,{policy:t}):e.policy_id||"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.versionLabel",{defaultMessage:"Agent version"}),description:"string"==typeof(null===(a=e.local_metadata)||void 0===a||null===(n=a.elastic)||void 0===n||null===(i=n.agent)||void 0===i?void 0:i.version)?l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center",style:{minWidth:0}},l.a.createElement(c.EuiFlexItem,{grow:!1,className:"eui-textNoWrap"},e.local_metadata.elastic.agent.version),Object(C.j)(e,M)?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiToolTip,{position:"right",content:d.i18n.translate("xpack.fleet.agentList.agentUpgradeLabel",{defaultMessage:"Upgrade available"})},l.a.createElement(c.EuiIcon,{type:"alert",color:"warning"}))):null):"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.integrationsLabel",{defaultMessage:"Integrations"}),description:e.policy_id?l.a.createElement(y.d,{agentPolicyId:e.policy_id,hideTitle:!0}):null},{title:d.i18n.translate("xpack.fleet.agentDetails.hostNameLabel",{defaultMessage:"Host name"}),description:"string"==typeof(null===(s=e.local_metadata)||void 0===s||null===(r=s.host)||void 0===r?void 0:r.hostname)?e.local_metadata.host.hostname:"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.logLevel",{defaultMessage:"Logging level"}),description:"string"==typeof(null===(g=e.local_metadata)||void 0===g||null===(m=g.elastic)||void 0===m||null===(p=m.agent)||void 0===p?void 0:p.log_level)?e.local_metadata.elastic.agent.log_level:"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.releaseLabel",{defaultMessage:"Agent release"}),description:"boolean"==typeof(null===(f=e.local_metadata)||void 0===f||null===(E=f.elastic)||void 0===E||null===(h=E.agent)||void 0===h?void 0:h.snapshot)?!0===e.local_metadata.elastic.agent.snapshot?"snapshot":"stable":"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.platformLabel",{defaultMessage:"Platform"}),description:"string"==typeof(null===(b=e.local_metadata)||void 0===b||null===(v=b.os)||void 0===v?void 0:v.platform)?e.local_metadata.os.platform:"-"},{title:d.i18n.translate("xpack.fleet.agentDetails.monitorLogsLabel",{defaultMessage:"Monitor logs"}),description:Array.isArray(null==t?void 0:t.monitoring_enabled)?null!=t&&null!==(k=t.monitoring_enabled)&&void 0!==k&&k.includes("logs")?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorLogsEnabledText",defaultMessage:"True"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorLogsDisabledText",defaultMessage:"False"}):null},{title:d.i18n.translate("xpack.fleet.agentDetails.monitorMetricsLabel",{defaultMessage:"Monitor metrics"}),description:Array.isArray(null==t?void 0:t.monitoring_enabled)?null!=t&&null!==(x=t.monitoring_enabled)&&void 0!==x&&x.includes("metrics")?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorMetricsEnabledText",defaultMessage:"True"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentList.monitorMetricsDisabledText",defaultMessage:"False"}):null}].map((({title:e,description:t})=>l.a.createElement(c.EuiFlexGroup,null,l.a.createElement(nt,{grow:3},l.a.createElement(c.EuiDescriptionListTitle,null,e)),l.a.createElement(nt,{grow:7},l.a.createElement(c.EuiDescriptionListDescription,{className:"eui-textTruncate"},t)))))))}));function it(e){return"logfile"===e?"(datasets:!(elastic_agent.filebeat))":e.match(/\/metrics$/)?"(datasets:!(elastic_agent.metricbeat))":"osquery"===e?"(datasets:!(elastic_agent.osquerybeat))":e.match(/^synthetics\//)?"(datasets:!(elastic_agent.heartbeat))":"apm"===e?"(datasets:!(elastic_agent.apm_server))":"endpoint"===e?"(datasets:!(elastic_agent.endpoint_security))":""}const st=m()(c.EuiAccordion).withConfig({displayName:"StyledEuiAccordion",componentId:"sc-12a1xr8-0"})([".ingest-integration-title-button{padding:",";}&.euiAccordion-isOpen .ingest-integration-title-button{border-bottom:1px solid ",";}.euiTableRow:last-child .euiTableRowCell{border-bottom:none;}.euiIEFlexWrapFix{min-width:0;}"],(e=>e.theme.eui.paddingSizes.m),(e=>e.theme.eui.euiColorLightShade)),rt=({id:e,title:t,children:a})=>l.a.createElement(c.EuiPanel,{paddingSize:"none"},l.a.createElement(st,{id:e,arrowDisplay:"right",buttonClassName:"ingest-integration-title-button",buttonContent:t},a)),ot=Object(n.memo)((({agent:e,agentPolicy:t,packagePolicy:a})=>{const{getHref:i}=Object(o.lb)(),s=Object(n.useMemo)((()=>a.inputs.filter((e=>e.enabled))),[a.inputs]),r=[{field:"type",width:"100%",name:d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeLabel",{defaultMessage:"Input"}),render:e=>function(e){return"logfile"===e?d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeLogText",{defaultMessage:"Logs"}):"endpoint"===e?d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeEndpointText",{defaultMessage:"Endpoint"}):e.match(/\/metrics$/)?d.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeMetricsText",{defaultMessage:"Metrics"}):e}(e)},{align:"right",name:d.i18n.translate("xpack.fleet.agentDetailsIntegrations.actionsLabel",{defaultMessage:"Actions"}),field:"type",width:"auto",render:t=>l.a.createElement(c.EuiToolTip,{content:d.i18n.translate("xpack.fleet.agentDetailsIntegrations.viewLogsButton",{defaultMessage:"View logs"})},l.a.createElement(c.EuiButtonIcon,{href:i("agent_details",{agentId:e.id,tabId:"logs",logQuery:it(t)}),iconType:"editorAlignLeft","aria-label":d.i18n.translate("xpack.fleet.agentDetailsIntegrations.viewLogsButton",{defaultMessage:"View logs"})}))}];return l.a.createElement(rt,{id:a.id,title:l.a.createElement(c.EuiTitle,{size:"xs"},l.a.createElement("h3",null,l.a.createElement(c.EuiFlexGroup,{gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:!1},a.package?l.a.createElement(y.n,{packageName:a.package.name,version:a.package.version,size:"l",tryApi:!0}):l.a.createElement(y.n,{size:"l",packageName:"default",version:"0"})),l.a.createElement(c.EuiFlexItem,{className:"eui-textTruncate"},l.a.createElement(c.EuiLink,{className:"eui-textTruncate","data-test-subj":"agentPolicyDetailsLink",href:i("edit_integration",{policyId:t.id,packagePolicyId:a.id})},a.name)))))},l.a.createElement(c.EuiBasicTable,{tableLayout:"auto",items:s,columns:r}))})),ct=Object(n.memo)((({agent:e,agentPolicy:t})=>t&&t.package_policies?l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"m"},t.package_policies.map((a=>l.a.createElement(c.EuiFlexItem,{grow:!1,key:a.id},l.a.createElement(ot,{agent:e,agentPolicy:t,packagePolicy:a}))))):null)),ut=m()(c.EuiFlexItem).withConfig({displayName:"FlexItemWithMinWidth",componentId:"sc-1svqtoc-0"})(["min-width:0px;"]),dt=Object(n.memo)((({agent:e,agentPolicy:t})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{alignItems:"flexStart"},l.a.createElement(ut,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.overviewSectionTitle",defaultMessage:"Overview"}))),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(lt,{agent:e,agentPolicy:t})),l.a.createElement(ut,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.integrationsSectionTitle",defaultMessage:"Integrations"}))),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(ct,{agent:e,agentPolicy:t})))))),gt=()=>{var e,t,a;const{params:{agentId:i,tabId:s=""}}=Object(r.useRouteMatch)(),{getHref:g}=Object(o.lb)(),m=Object(o.jb)(),{isLoading:p,isInitialRequest:f,error:E,data:h,resendRequest:b}=Object(o.Z)(i,{pollIntervalMs:5e3}),{isLoading:v,data:x,sendRequest:M}=Object(o.ab)(null==h||null===(e=h.item)||void 0===e?void 0:e.policy_id),{application:{navigateToApp:O}}=Object(o.rb)(),F=Object(o.hb)(),S="true"===new URLSearchParams(Object(r.useLocation)().search).get("openReassignFlyout"),j=Object(n.useCallback)((()=>{F&&F.onDoneNavigateTo&&O(F.onDoneNavigateTo[0],F.onDoneNavigateTo[1])}),[F,O]),I=null==h||null===(t=h.item)||void 0===t||null===(a=t.local_metadata)||void 0===a?void 0:a.host,P=Object(n.useMemo)((()=>l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"s",alignItems:"flexStart"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiButtonEmpty,{iconType:"arrowLeft",href:g("agent_list"),flush:"left",size:"xs"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.viewAgentListTitle",defaultMessage:"View all agents"}))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{className:"eui-textBreakWord"},l.a.createElement("h1",null,p&&f?l.a.createElement(y.l,null):"object"==typeof I&&"string"==typeof(null==I?void 0:I.hostname)?I.hostname:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.agentDetailsTitle",defaultMessage:"Agent '{id}'",values:{id:i}})))))),[I,i,g,f,p]),w=Object(n.useMemo)((()=>{var e;return h&&h.item?l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",direction:"row"},[{label:d.i18n.translate("xpack.fleet.agentDetails.statusLabel",{defaultMessage:"Status"}),content:l.a.createElement(Y.a,{agent:h.item})},{label:d.i18n.translate("xpack.fleet.agentDetails.lastActivityLabel",{defaultMessage:"Last activity"}),content:h.item.last_checkin?l.a.createElement(u.FormattedRelative,{value:new Date(h.item.last_checkin)}):"-"},{label:d.i18n.translate("xpack.fleet.agentDetails.policyLabel",{defaultMessage:"Policy"}),content:v?l.a.createElement(y.l,{size:"m"}):null!=x&&x.item?l.a.createElement(c.EuiLink,{href:g("policy_details",{policyId:h.item.policy_id}),className:"eui-textBreakWord"},x.item.name||h.item.policy_id):h.item.policy_id||"-"},{label:d.i18n.translate("xpack.fleet.agentDetails.agentVersionLabel",{defaultMessage:"Agent version"}),content:"object"==typeof h.item.local_metadata.elastic&&"object"==typeof h.item.local_metadata.elastic.agent&&"string"==typeof h.item.local_metadata.elastic.agent.version?l.a.createElement(c.EuiFlexGroup,{gutterSize:"s"},l.a.createElement(c.EuiFlexItem,{grow:!1,className:"eui-textNoWrap"},h.item.local_metadata.elastic.agent.version),Object(C.j)(h.item,m)?l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiIconTip,{"aria-label":d.i18n.translate("xpack.fleet.agentDetails.upgradeAvailableTooltip",{defaultMessage:"Upgrade available"}),size:"m",type:"alert",color:"warning",content:d.i18n.translate("xpack.fleet.agentDetails.upgradeAvailableTooltip",{defaultMessage:"Upgrade available"})})):null):"-"},{content:v||null!=x&&null!==(e=x.item)&&void 0!==e&&e.is_managed?void 0:l.a.createElement(at,{agent:h.item,agentPolicy:null==x?void 0:x.item,assignFlyoutOpenByDefault:S,onCancelReassign:F&&F.onDoneNavigateTo?j:void 0})}].map(((e,t)=>l.a.createElement(c.EuiFlexItem,{grow:!1,key:t},e.label?l.a.createElement(c.EuiDescriptionList,{compressed:!0},l.a.createElement(c.EuiDescriptionListTitle,null,e.label),l.a.createElement(c.EuiDescriptionListDescription,null,e.content)):e.content)))):void 0}),[x,h,g,v]),T=Object(n.useMemo)((()=>[{id:"details",name:d.i18n.translate("xpack.fleet.agentDetails.subTabs.detailsTab",{defaultMessage:"Agent details"}),href:g("agent_details",{agentId:i,tabId:"details"}),isSelected:!s||"details"===s},{id:"logs",name:d.i18n.translate("xpack.fleet.agentDetails.subTabs.logsTab",{defaultMessage:"Logs"}),href:g("agent_details_logs",{agentId:i,tabId:"logs"}),isSelected:"logs"===s}]),[g,i,s]);return l.a.createElement(he.Provider,{value:{refresh:()=>{b(),M()}}},l.a.createElement(k.c,{leftColumn:P,rightColumn:w,tabs:T},p&&f?l.a.createElement(y.l,null):E?l.a.createElement(y.h,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.unexceptedErrorTitle",defaultMessage:"Error loading agent"}),error:E}):h&&h.item?l.a.createElement(mt,{agent:h.item,agentPolicy:null==x?void 0:x.item}):l.a.createElement(y.h,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentDetails.agentNotFoundErrorTitle",defaultMessage:"Agent not found"}),error:d.i18n.translate("xpack.fleet.agentDetails.agentNotFoundErrorDescription",{defaultMessage:"Cannot find agent ID {agentId}",values:{agentId:i}})})))},mt=({agent:e,agentPolicy:t})=>(Object(o.R)("agent_details",{agentHost:"object"==typeof e.local_metadata.host&&"string"==typeof e.local_metadata.host.hostname?e.local_metadata.host.hostname:"-"}),l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:v.g.agent_details_logs,render:()=>l.a.createElement(et,{agent:e,agentPolicy:t})}),l.a.createElement(r.Route,{path:v.g.agent_details,render:()=>l.a.createElement(dt,{agent:e,agentPolicy:t})}))),pt=Object(r.withRouter)((({actionSection:e,title:t,modalClosePath:a,children:n})=>l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceAround"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiPageContent,null,l.a.createElement(c.EuiEmptyPrompt,{iconType:"logoBeats",title:l.a.createElement("h2",null,t),body:n,actions:e})))))),ft=Object(u.injectI18n)((({intl:e})=>l.a.createElement(pt,{title:e.formatMessage({id:"xpack.fleet.noAccess.accessDeniedTitle",defaultMessage:"Access denied"}),actionSection:[]},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.noAccess.accessDeniedDescription",defaultMessage:"You are not authorized to access Elastic Fleet. To use Elastic Fleet, you need a user role that contains All permissions for this application."}))))),Et=({onClose:e})=>{const{getAssetsPath:t}=Object(o.lb)(),{notifications:a,cloud:i,docLinks:s}=Object(o.rb)(),r=!(null==i||!i.cloudId),[g,m]=Object(n.useState)(!1),[p,f]=Object(n.useState)(!1);Object(n.useEffect)((()=>{!async function(){try{const a={},s=await Object(o.r)({page:1,perPage:10,showInactive:!1});if(s.error)throw s.error;for(const r of null!==(t=null===(n=s.data)||void 0===n?void 0:n.items)&&void 0!==t?t:[]){var t,n,l,i;if(!r.policy_id||a[r.policy_id])continue;a[r.policy_id]=!0;const s=await Object(o.u)(r.policy_id);if(!(null!==(l=(null===(i=s.data)||void 0===i?void 0:i.item.package_policies).some((e=>{var t;return(null===(t=e.package)||void 0===t?void 0:t.name)===v.h})))&&void 0!==l&&l))return await Object(o.J)({has_seen_fleet_migration_notice:!0}),void e()}f(!0)}catch(e){a.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.fleetServerUpgradeModal.errorLoadingAgents",{defaultMessage:"Error loading agents"})})}}()}),[a.toasts,e]);const E=Object(n.useCallback)((async()=>{try{m(!g),await Object(o.J)({has_seen_fleet_migration_notice:!g})}catch(e){a.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.fleetServerUpgradeModal.failedUpdateTitle",{defaultMessage:"Error saving settings"})})}}),[g,m,a]);return p?l.a.createElement(c.EuiModal,{onClose:e},l.a.createElement(c.EuiModalHeader,null,l.a.createElement(c.EuiModalHeaderTitle,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.modalTitle",defaultMessage:"Enroll your agents into Fleet Server"}))),l.a.createElement(c.EuiModalBody,null,l.a.createElement(c.EuiImage,{size:"fullWidth",src:t("./announcement.jpg"),alt:d.i18n.translate("xpack.fleet.fleetServerUpgradeModal.announcementImageAlt",{defaultMessage:"Fleet Server upgrade announcement"})}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiText,null,r?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.cloudDescriptionMessage",defaultMessage:"Fleet Server is now available and it provides improved scalability and security. If you already had an APM instance on Elastic Cloud, we've upgraded it to APM & Fleet. If not, you can add one to your deployment for free. {existingAgentsMessage} To continue using Fleet, you must use Fleet Server and install the new version of Elastic Agent on each host.",values:{existingAgentsMessage:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.existingAgentText",defaultMessage:"Your existing Elastic Agents have been automatically unenrolled and have stopped sending data."}))}}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.onPremDescriptionMessage",defaultMessage:"Fleet Server is now available and it provides improved scalability and security. {existingAgentsMessage} To continue using Fleet, you must install a Fleet Server and the new version of Elastic Agent on each host. Learn more in our {link}.",values:{existingAgentsMessage:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.existingAgentText",defaultMessage:"Your existing Elastic Agents have been automatically unenrolled and have stopped sending data."})),link:l.a.createElement(c.EuiLink,{href:s.links.fleet.upgradeElasticAgent712lower,external:!0,target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.fleetServerMigrationGuide",defaultMessage:"Fleet Server migration guide"}))}})),l.a.createElement(c.EuiSpacer,{size:"l"}),l.a.createElement(c.EuiText,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.breakingChangeMessage",defaultMessage:"This is a breaking change, which is why we are making it in a beta release. We are sorry for the inconvenience. Please share {link} if you have questions or need help.",values:{link:l.a.createElement(c.EuiLink,{href:"https://ela.st/fleet-feedback",target:"_blank"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.fleetFeedbackLink",defaultMessage:"feedback"}))}}))),l.a.createElement(c.EuiModalFooter,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiCheckbox,{id:"fleetServerModalCheckbox",label:d.i18n.translate("xpack.fleet.fleetServerUpgradeModal.checkboxLabel",{defaultMessage:"Do not show this message again"}),checked:g,onChange:E})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,onClick:e},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.fleetServerUpgradeModal.closeButton",defaultMessage:"Close and get started"})))))):null},ht=()=>{var e;Object(o.R)("agent_list");const t=Object(r.useHistory)(),{agents:a}=Object(o.T)(),i=Object(o.Q)().fleet.all,s=Object(o.V)(),d=Object(o.fb)(),[g,m]=Object(n.useState)(!1),[p,f]=Object(n.useState)(!1),E=Object(n.useCallback)((()=>{f(!1)}),[f]);if(Object(n.useEffect)((()=>{var e;d.data&&!1===(null===(e=d.data)||void 0===e?void 0:e.item.has_seen_fleet_migration_notice)&&f(!0)}),[d.data]),!a.enabled)return null;if(!s.missingRequirements&&s.isLoading)return l.a.createElement(y.l,null);if(s.error)return l.a.createElement(k.d,null,l.a.createElement(y.h,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.agentsInitializationErrorMessageTitle",defaultMessage:"Unable to initialize central management for Elastic Agents"}),error:s.error}));const h=1===(null==s||null===(e=s.missingRequirements)||void 0===e?void 0:e.length)&&"fleet_server"===s.missingRequirements[0];if(!h&&s.missingRequirements&&s.missingRequirements.length>0)return l.a.createElement(Ee.b,{missingRequirements:s.missingRequirements});if(!i)return l.a.createElement(ft,null);const b=h?l.a.createElement(l.a.Fragment,null,g&&l.a.createElement(c.EuiPortal,null,l.a.createElement(y.b,{defaultMode:"standalone",onClose:()=>m(!1)})),l.a.createElement(c.EuiFlexGroup,{justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>m(!0),"data-test-subj":"addAgentBtnTop"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.addAgentButton",defaultMessage:"Add Agent"}))))):void 0;return l.a.createElement(r.Router,{history:t},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:v.g.agent_details},l.a.createElement(gt,null)),l.a.createElement(r.Route,{path:v.g.agents},l.a.createElement(k.a,{section:"agents",rightColumn:b},p&&l.a.createElement(Et,{onClose:E}),h?l.a.createElement(Ee.a,null):l.a.createElement(fe,null)))))};var bt=a(90),yt=a(105),vt=a(95),kt=a(14);var xt=a(138),Mt=a(139);const Ot=m()(c.EuiFormRow).withConfig({displayName:"AgentPolicyFormRow",componentId:"sc-1qoukpq-0"})([".euiFormRow__label{width:100%;}"]),Ft=({packageInfo:e,agentPolicy:t,updateAgentPolicy:a,setHasAgentPolicyError:i,selectedAgentPolicyId:s})=>{var r,g,m;const{isReady:p}=Object(o.V)(),[f,E]=Object(n.useState)(),{data:h,error:b,isLoading:v}=Object(o.W)({page:1,perPage:1e3,sortField:"name",sortOrder:"asc",full:!0}),k=Object(n.useMemo)((()=>(null==h?void 0:h.items.filter((e=>!e.is_managed)))||[]),[null==h?void 0:h.items]),x=Object(n.useMemo)((()=>k.reduce(((e,t)=>(e[t.id]=t,e)),{})),[k]),[M,O]=Object(n.useState)(null!==(r=null==t?void 0:t.id)&&void 0!==r?r:s||(1===k.length?k[0].id:void 0)),F=Object(n.useCallback)(((e,t)=>!!e&&(Object(C.k)(t)&&Object(C.e)(e,t.name))),[]);Object(n.useEffect)((()=>{t&&M===t.id||(async()=>{if(M){const{data:e,error:t}=await Object(o.u)(M);t?(E(t),a(void 0)):e&&e.item&&(E(void 0),a(e.item))}else E(void 0),a(void 0)})()}),[M,t,a]);const S=Object(n.useMemo)((()=>e?k.map((t=>({text:t.name,value:t.id,disabled:F(t,e),"data-test-subj":"agentPolicyItem"}))):[]),[k,F,e]);return Object(n.useEffect)((()=>{if(!M&&k.length&&S.length){const e=S.filter((e=>!e.disabled));1===e.length&&O(e[0].value)}}),[k,S,M]),Object(n.useEffect)((()=>{i(!(M&&!f))}),[f,M,i]),b?l.a.createElement(y.h,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.errorLoadingAgentPoliciesTitle",defaultMessage:"Error loading agent policies"}),error:b}):l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFlexGroup,{direction:"column",gutterSize:"m"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiDescribedFormGroup,{title:l.a.createElement(c.EuiTitle,{size:"xs"},l.a.createElement("h3",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.agentPolicyFormGroupTitle",defaultMessage:"Agent policy"}))),description:l.a.createElement(c.EuiText,{color:"subdued",size:"s"},l.a.createElement("p",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.agentPolicyFormGroupDescription",defaultMessage:"Agent policies are used to manage a group of integrations across a set of agents."})))},l.a.createElement(Ot,{fullWidth:!0,label:l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.agentPolicyLabel",defaultMessage:"Agent policy"}))),helpText:p&&M?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.agentPolicyAgentsDescriptionText",defaultMessage:"{count, plural, one {# agent is} other {# agents are}} enrolled with the selected agent policy.",values:{count:null!==(g=null===(m=x[M])||void 0===m?void 0:m.agents)&&void 0!==g?g:0}}):null,isInvalid:Boolean(!M||!e||F(x[M],e)),error:M?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.cannotAddLimitedIntegrationError",defaultMessage:"This integration can only be added once per agent policy."}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.noPolicySelectedError",defaultMessage:"An agent policy is required."})},l.a.createElement(c.EuiSelect,{placeholder:d.i18n.translate("xpack.fleet.createPackagePolicy.StepSelectPolicy.agentPolicyPlaceholderText",{defaultMessage:"Select an agent policy to add this integration to"}),hasNoInitialSelection:k.length>1,fullWidth:!0,isLoading:v||!e,options:S,value:M||void 0,onChange:e=>O(e.target.value),"data-test-subj":"agentPolicySelect","aria-label":"Select Agent Policy"})))),f?l.a.createElement(c.EuiFlexItem,null,l.a.createElement(y.h,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.errorLoadingSelectedAgentPolicyTitle",defaultMessage:"Error loading selected agent policy"}),error:f})):null))};let St;!function(e){e.NEW="new",e.EXISTING="existing"}(St||(St={}));const jt=m()(c.EuiTabbedContent).withConfig({displayName:"StyledEuiTabbedContent",componentId:"sc-1lgx42c-0"})(["[role='tabpanel']{padding-top:",";}"],(e=>e.theme.eui.paddingSizes.m)),It=({agentPolicy:e,updateAgentPolicy:t,newAgentPolicy:a,updateNewAgentPolicy:i,withSysMonitoring:s,updateSysMonitoring:r,validation:c,packageInfo:u,setHasAgentPolicyError:d,updateSelectedTab:g,selectedAgentPolicyId:m})=>{let p=[];const{data:f,error:E}=Object(o.W)({page:1,perPage:1e3,sortField:"name",sortOrder:"asc",full:!0});E&&console.debug("Could not retrieve agent policies"),p=Object(n.useMemo)((()=>(null==f?void 0:f.items.filter((e=>!e.is_managed)))||[]),[null==f?void 0:f.items]),Object(n.useEffect)((()=>{p.length>0&&i({...a,name:Object(C.i)(p)})}),[p.length]);const h=[{id:St.NEW,name:"New hosts",content:l.a.createElement(x.d,{agentPolicy:a,updateAgentPolicy:i,withSysMonitoring:s,updateSysMonitoring:r,validation:c})},{id:St.EXISTING,name:"Existing hosts",content:l.a.createElement(Ft,{packageInfo:u,agentPolicy:e,updateAgentPolicy:t,setHasAgentPolicyError:d,selectedAgentPolicyId:m})}];return p.length>0?l.a.createElement(jt,{initialSelectedTab:m?h[1]:h[0],tabs:h,onTabClick:e=>g(e.id)}):l.a.createElement(x.d,{agentPolicy:a,updateAgentPolicy:i,withSysMonitoring:s,updateSysMonitoring:r,validation:c})},Ct=m()(c.EuiSteps).withConfig({displayName:"StepsWithLessPadding",componentId:"sc-1smjujo-0"})([".euiStep__content{padding-bottom:",";}@media (max-width:","){margin-bottom:100px;}"],(e=>e.theme.eui.paddingSizes.m),(e=>e.theme.eui.euiBreakpoints.m)),Pt=m()(c.EuiBottomBar).withConfig({displayName:"CustomEuiBottomBar",componentId:"sc-1smjujo-1"})(["z-index:50;"]),wt=()=>{var e,t;const{application:{navigateToApp:a},notifications:i}=Object(o.rb)(),{agents:{enabled:s}}=Object(o.T)(),{params:g}=Object(r.useRouteMatch)(),{getHref:m,getPath:p}=Object(o.lb)(),f=Object(r.useHistory)(),E=Object(o.hb)(),{search:h}=Object(r.useLocation)(),b=Object(n.useMemo)((()=>new URLSearchParams(h)),[h]),v=Object(n.useMemo)((()=>{var e;return null!==(e=b.get("policyId"))&&void 0!==e?e:void 0}),[b]),k="policyId"in g||v?"policy":"package",[M,S]=Object(n.useState)(),[j,I]=Object(n.useState)({name:"Agent policy 1",description:"",namespace:"default",monitoring_enabled:Object.values(F.dataTypes)}),[P,w]=Object(n.useState)(!0),T=Object(x.g)(j),[L,A]=Object(n.useState)(),_=null==M?void 0:M.id;Object(n.useEffect)((()=>{s&&_&&(async()=>{const{data:e}=await Object(o.q)({policyId:_});void 0!==(null==e?void 0:e.results.total)&&N(e.results.total)})()}),[_,s]);const[D,N]=Object(n.useState)(0),[B,R]=Object(n.useState)(v?St.EXISTING:St.NEW),[z,U]=Object(n.useState)({name:"",description:"",namespace:"default",policy_id:"",enabled:!0,output_id:"",inputs:[]}),[H,q]=Object(n.useState)(),[G,W]=Object(n.useState)(!1),[$,V]=Object(n.useState)("VALID"),{pkgName:K,pkgVersion:Q}=Object(F.splitPkgKey)(g.pkgkey),{data:Y,error:Z,isLoading:X}=Object(o.db)(K,Q),J=Object(n.useMemo)((()=>{if(Y&&Y.item)return Y.item}),[Y]),ee=Object(n.useCallback)((e=>{e?(S(e),J&&W(!1)):(W(!0),S(void 0)),console.debug("Agent policy updated",e)}),[J,S]),te=(e,t)=>{e===St.NEW&&(t.name&&""!==t.name.trim()&&t.namespace&&""!==t.namespace.trim()?W(!1):W(!0))},ae=Object(n.useCallback)((e=>{const t={...j,...e};I(t),te(B,t)}),[I,j,B]),ne=Object(n.useCallback)((e=>{R(e),te(e,j)}),[R,j]),le=!!H&&Object(vt.f)(H),ie=Object(n.useCallback)((e=>{if(J){const t=Object(vt.d)(e||z,J,bt.safeLoad);return q(t),console.debug("Package policy validation results",t),t}}),[z,J]),se=Object(n.useCallback)((e=>{const t={...z,...e};U(t),console.debug("Package policy updated",t);const a=ie(t),n=t.package,l=!!a&&Object(vt.f)(a),i=t.policy_id&&""!==t.policy_id;!n||!i&&B!==St.NEW||l?V("INVALID"):V("VALID")}),[z,ie,B]),re=Object(n.useCallback)((({isValid:e,updatedPolicy:t})=>{se(t),V((t=>"VALID"!==t||e?t:"INVALID"))}),[se]),oe=Object(n.useMemo)((()=>E&&E.onCancelUrl?E.onCancelUrl:"policy"===k&&_?m("policy_details",{policyId:_}):m("integration_details_overview",{pkgkey:g.pkgkey})),[E,k,_,m,g.pkgkey]),ce=Object(n.useCallback)((e=>{E&&E.onCancelNavigateTo&&(e.preventDefault(),a(...E.onCancelNavigateTo))}),[E,a]),ue=Object(n.useCallback)((async e=>{V("LOADING");const t=await Object(o.k)(e);return V(D?"SUBMITTED":"SUBMITTED_NO_AGENTS"),t}),[D]),de=Object(n.useRef)(!0);Object(n.useEffect)((()=>()=>{de.current=!1}),[]);const ge=Object(n.useCallback)(((e,t=[])=>{if(!de.current)return;const n=p("policy_details",{policyId:z.policy_id});if(null!=E&&E.onSaveNavigateTo&&e){const[l,i]=E.onSaveNavigateTo;if(null!=i&&i.path){const s=function({path:e,policy:t,paramsToApply:a,mappingOptions:n={}}){const[l,i]=e.split("?"),s=Object(kt.parse)(i);a.forEach((e=>{const a=n[e];if(a){const[n,l]=function(e,t,a){if(!t)return[];if("boolean"==typeof t&&t)return[e,"true"];return[t.renameKey?t.renameKey:e,t.policyIdAsValue?a:"true"]}(e,a,t.policy_id);n&&l&&(s[n]=l)}}));const r=Object(kt.stringify)(s);return l+(r?`?${r}`:"")}({path:v?n:i.path,policy:e,mappingOptions:E.onSaveQueryParams,paramsToApply:t});a(l,{...i,path:s})}else a(...E.onSaveNavigateTo)}else f.push(n)}),[z.policy_id,p,a,f,E,v]),me=Object(n.useCallback)((async()=>{var e;let t;V("LOADING");const a=(null==z||null===(e=z.package)||void 0===e?void 0:e.name)===F.FLEET_SYSTEM_PACKAGE,n=await Object(o.i)(j,{withSysMonitoring:P&&!a});if(n.error)throw V("VALID"),n.error;return n.data&&(t=n.data.item.id,S(n.data.item),se({policy_id:t})),t}),[j,se,P,z]),pe=Object(n.useCallback)((async()=>{var e;if("VALID"===$&&le)return void V("INVALID");if(0!==D&&"CONFIRM"!==$)return void V("CONFIRM");let t;if(B===St.NEW)try{t=await me()}catch(e){return void i.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"})})}V("LOADING");const{error:a,data:n}=await ue({...z,policy_id:null!==(e=t)&&void 0!==e?e:z.policy_id});if(a)i.toasts.addError(a,{title:"Error"}),V("VALID");else{A(n.item);const e=D&&M;if(!e)return void V("SUBMITTED_NO_AGENTS");ge(n.item),i.toasts.addSuccess({title:d.i18n.translate("xpack.fleet.createPackagePolicy.addedNotificationTitle",{defaultMessage:"'{packagePolicyName}' integration added.",values:{packagePolicyName:z.name}}),text:e?d.i18n.translate("xpack.fleet.createPackagePolicy.addedNotificationMessage",{defaultMessage:"Fleet will deploy updates to all agents that use the '{agentPolicyName}' policy.",values:{agentPolicyName:M.name}}):void 0,"data-test-subj":"packagePolicyCreateSuccessToast"})}}),[$,le,D,ue,ge,M,i.toasts,z,B,me]),fe=Object(n.useMemo)((()=>{var e;return g.integration?null==J||null===(e=J.policy_templates)||void 0===e?void 0:e.find((e=>e.name===g.integration)):void 0}),[null==J?void 0:J.policy_templates,g]),Ee=Object(n.useMemo)((()=>({from:k,cancelUrl:oe,onCancel:ce,agentPolicy:M,packageInfo:J,integrationInfo:fe})),[M,ce,oe,k,fe,J]),he=Object(n.useMemo)((()=>l.a.createElement(It,{agentPolicy:M,updateAgentPolicy:ee,newAgentPolicy:j,updateNewAgentPolicy:ae,withSysMonitoring:P,updateSysMonitoring:e=>w(e),validation:T,packageInfo:J,setHasAgentPolicyError:W,updateSelectedTab:ne,selectedAgentPolicyId:v})),[J,M,ee,j,ae,T,P,ne,v]),be=Object(o.tb)(null!==(e=null===(t=z.package)||void 0===t?void 0:t.name)&&void 0!==e?e:"","package-policy-create"),ye=Object(n.useMemo)((()=>{var e;return X?l.a.createElement(y.l,null):J?l.a.createElement(l.a.Fragment,null,l.a.createElement(Mt.a,{agentPolicy:M,packageInfo:J,packagePolicy:z,updatePackagePolicy:se,validationResults:H,submitAttempted:"INVALID"===$,integrationToEnable:null==fe?void 0:fe.name}),!be&&l.a.createElement(xt.a,{packageInfo:J,showOnlyIntegration:null==fe?void 0:fe.name,packagePolicy:z,updatePackagePolicy:se,validationResults:H,submitAttempted:"INVALID"===$}),be&&(null===(e=z.package)||void 0===e?void 0:e.name)&&l.a.createElement(y.i,null,l.a.createElement(be.Component,{newPolicy:z,onChange:re}))):l.a.createElement("div",null)}),[X,M,J,z,se,H,$,null==fe?void 0:fe.name,be,re]),ve=[{title:d.i18n.translate("xpack.fleet.createPackagePolicy.stepConfigurePackagePolicyTitle",{defaultMessage:"Configure integration"}),"data-test-subj":"dataCollectionSetupStep",children:ye},{title:d.i18n.translate("xpack.fleet.createPackagePolicy.stepSelectAgentPolicyTitle",{defaultMessage:"Where to add this integration?"}),children:he}];return Z?l.a.createElement(y.h,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:Z}):l.a.createElement(yt.a,O()({},Ee,{"data-test-subj":"createPackagePolicy"}),l.a.createElement(c.EuiErrorBoundary,null,"CONFIRM"===$&&M&&l.a.createElement(x.e,{agentCount:D,agentPolicy:M,onConfirm:pe,onCancel:()=>V("VALID")}),"SUBMITTED_NO_AGENTS"===$&&M&&J&&l.a.createElement(yt.d,{packageInfo:J,agentPolicy:M,onConfirm:()=>ge(L,["openEnrollmentFlyout"]),onCancel:()=>ge(L,["showAddAgentHelp"])}),J&&l.a.createElement(Tt,{pkgTitle:(null==fe?void 0:fe.title)||J.title,pkgkey:Object(C.n)(J),integration:null==fe?void 0:fe.name}),l.a.createElement(Ct,{steps:ve}),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(c.EuiSpacer,{size:"xl"}),l.a.createElement(Pt,{"data-test-subj":"integrationsBottomBar"},l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},l.a.createElement(c.EuiFlexItem,{grow:!1},J&&("INVALID"===$||G)?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorOnSaveText",defaultMessage:"Your integration policy has errors. Please fix them before saving."}):null),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{color:"ghost",href:oe,onClick:ce,"data-test-subj":"createPackagePolicyCancelButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.cancelButton",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{onClick:pe,isLoading:"LOADING"===$,disabled:"VALID"!==$||G||!H,iconType:"save",color:"primary",fill:!0,"data-test-subj":"createPackagePolicySaveButton"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.saveButton",defaultMessage:"Save and continue"})))))))))},Tt=({pkgTitle:e,pkgkey:t,integration:a})=>(Object(o.R)("add_integration_to_policy",{pkgTitle:e,pkgkey:t,...a?{integration:a}:{}}),null);var Lt=a(109);const At=e=>{const{onCancel:t,onConfirm:a,enrollmentKey:n}=e;return l.a.createElement(c.EuiConfirmModal,{title:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.title",{defaultMessage:"Revoke enrollment token"}),onCancel:t,onConfirm:a,cancelButtonText:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.deleteButton",{defaultMessage:"Revoke enrollment token"}),defaultFocusedButton:"confirm",buttonColor:"danger"},l.a.createElement(c.EuiCallOut,{title:d.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.description",{defaultMessage:"Are your sure you want to revoke {keyName}? New agents will no longer be able to be enrolled using this token.",values:{keyName:n.name}}),color:"danger"}))},_t=({apiKeyId:e})=>{const{notifications:t}=Object(o.rb)(),[a,i]=Object(n.useState)("HIDDEN"),[s,r]=Object(n.useState)();return l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiText,{color:"subdued",size:"xs"},"VISIBLE"===a?s:"•••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••")),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiToolTip,{content:"VISIBLE"===a?d.i18n.translate("xpack.fleet.enrollmentTokensList.hideTokenButtonLabel",{defaultMessage:"Hide token"}):d.i18n.translate("xpack.fleet.enrollmentTokensList.showTokenButtonLabel",{defaultMessage:"Show token"})},l.a.createElement(c.EuiButtonIcon,{"aria-label":"VISIBLE"===a?d.i18n.translate("xpack.fleet.enrollmentTokensList.hideTokenButtonLabel",{defaultMessage:"Hide token"}):d.i18n.translate("xpack.fleet.enrollmentTokensList.showTokenButtonLabel",{defaultMessage:"Show token"}),color:"text",onClick:async()=>{if("VISIBLE"===a)i("HIDDEN");else if("HIDDEN"===a)try{var n;i("LOADING");const t=await Object(o.v)(e);if(t.error)throw t.error;r(null===(n=t.data)||void 0===n?void 0:n.item.api_key),i("VISIBLE")}catch(e){t.toasts.addError(e,{title:"Error"}),i("HIDDEN")}},iconType:"VISIBLE"===a?"eyeClosed":"eye"}))))},Dt=({apiKey:e,refresh:t})=>{const{notifications:a}=Object(o.rb)(),[i,s]=Object(n.useState)("CONFIRM_HIDDEN");return l.a.createElement(l.a.Fragment,null,"CONFIRM_VISIBLE"===i&&l.a.createElement(At,{enrollmentKey:e,onCancel:()=>s("CONFIRM_HIDDEN"),onConfirm:async()=>{try{const t=await Object(o.m)(e.id);if(t.error)throw t.error}catch(e){a.toasts.addError(e,{title:"Error"})}s("CONFIRM_HIDDEN"),t()}}),l.a.createElement(c.EuiToolTip,{content:d.i18n.translate("xpack.fleet.enrollmentTokensList.revokeTokenButtonLabel",{defaultMessage:"Revoke token"})},l.a.createElement(c.EuiButtonIcon,{"aria-label":d.i18n.translate("xpack.fleet.enrollmentTokensList.revokeTokenButtonLabel",{defaultMessage:"Revoke token"}),onClick:()=>s("CONFIRM_VISIBLE"),iconType:"trash",color:"danger"})))},Nt=()=>{var e,t,a;Object(o.R)("enrollment_tokens");const[i,s]=Object(n.useState)(!1),[r,g]=Object(n.useState)(""),{pagination:m,setPagination:p,pageSizeOptions:f}=Object(o.nb)(),E=Object(o.Y)({page:m.currentPage,perPage:m.pageSize,kuery:""!==r.trim()?r:void 0}),h=Object(o.W)({page:1,perPage:1e3}),b=h.data?h.data.items:[],x=b.reduce(((e,t)=>(e[t.id]=t,e)),{}),M=null!==(e=null==E||null===(t=E.data)||void 0===t?void 0:t.total)&&void 0!==e?e:0,O=(null==E||null===(a=E.data)||void 0===a?void 0:a.items.filter((e=>{if(!b.length||!e.policy_id)return!1;const t=x[e.policy_id];return!(null!=t&&t.is_managed)})))||[],F=[{field:"name",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.nameTitle",{defaultMessage:"Name"}),render:e=>l.a.createElement("span",{className:"eui-textTruncate",title:e},e)},{field:"id",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.secretTitle",{defaultMessage:"Secret"}),width:"215px",render:e=>l.a.createElement(_t,{apiKeyId:e})},{field:"policy_id",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.policyTitle",{defaultMessage:"Agent policy"}),render:e=>{const t=x[e],a=t?t.name:e;return l.a.createElement("span",{className:"eui-textTruncate",title:a},a)}},{field:"created_at",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.createdAtTitle",{defaultMessage:"Created on"}),width:"150px",render:e=>e?l.a.createElement(u.FormattedDate,{year:"numeric",month:"short",day:"2-digit",value:e}):null},{field:"active",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.activeTitle",{defaultMessage:"Active"}),width:"70px",align:"center",render:e=>l.a.createElement(c.EuiIcon,{size:"m",color:e?"success":"danger",type:"dot"})},{field:"actions",name:d.i18n.translate("xpack.fleet.enrollmentTokensList.actionsTitle",{defaultMessage:"Actions"}),width:"70px",render:(e,t)=>{const a=b.find((e=>e.id===t.policy_id));return t.active&&!(null!=a&&a.is_managed)&&l.a.createElement(Dt,{apiKey:t,refresh:()=>E.resendRequest()})}}],S=E.isLoading&&E.isInitialRequest||h.isLoading&&h.isInitialRequest;return l.a.createElement(k.a,{section:"enrollment_tokens"},i&&l.a.createElement(y.m,{agentPolicies:b,onClose:e=>{s(!1),E.resendRequest()}}),l.a.createElement(c.EuiText,{color:"subdued"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollmentTokensList.pageDescription",defaultMessage:"Create and revoke enrollment tokens. An enrollment token enables one or more agents to enroll in Fleet and send data."})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiFlexGroup,{alignItems:"center"},l.a.createElement(c.EuiFlexItem,null,l.a.createElement(Lt.a,{value:r,onChange:e=>{p({...m,currentPage:1}),g(e)},indexPattern:v.e})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>s(!0)},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollmentTokensList.newKeyButton",defaultMessage:"Create enrollment token"})))),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiBasicTable,{loading:S,hasActions:!0,noItemsMessage:S?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollemntAPIKeyList.loadingTokensMessage",defaultMessage:"Loading enrollment tokens..."}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.enrollemntAPIKeyList.emptyMessage",defaultMessage:"No enrollment tokens found."}),items:M?O:[],itemId:"id",columns:F,pagination:{pageIndex:m.currentPage-1,pageSize:m.pageSize,totalItemCount:M,pageSizeOptions:f},onChange:({page:e})=>{const t={...m,currentPage:e.index+1,pageSize:e.size};p(t)}}))},Bt=({fleetServerHosts:e})=>{const{docLinks:t}=Object(o.rb)(),{getHref:a}=Object(o.lb)(),i=Object(n.useMemo)((()=>[{render:e=>e,name:d.i18n.translate("xpack.fleet.settings.fleetServerHostUrlColumnTitle",{defaultMessage:"Host URL"})}]),[]);return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h4",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostSectionTitle",defaultMessage:"Fleet server hosts"}))),l.a.createElement(c.EuiSpacer,{size:"xs"}),l.a.createElement(c.EuiText,{color:"subdued",size:"m"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostSectionSubtitle",defaultMessage:"Specify the URLs that your agents will use to connect to a Fleet Server. If multiple URLs exist, Fleet will show the first provided URL for enrollment purposes. For more information, see the {guideLink} .",values:{guideLink:l.a.createElement(c.EuiLink,{href:t.links.fleet.guide,target:"_blank",external:!0},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetUserGuideLink",defaultMessage:"Fleet User Guide"}))}})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiBasicTable,{columns:i,items:e}),l.a.createElement(c.EuiSpacer,{size:"s"}),l.a.createElement(c.EuiButtonEmpty,{iconType:"pencil",href:a("settings_edit_fleet_server_hosts"),"data-test-subj":"editHostsBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostEditButtonLabel",defaultMessage:"Edit hosts"})),l.a.createElement(c.EuiSpacer,{size:"m"}))},Rt=l.a.memo((({output:e})=>{const t=Object(n.useMemo)((()=>{const t=[];return e.is_default&&t.push(l.a.createElement(zt,{key:"default-output"})),e.is_default_monitoring&&t.push(l.a.createElement(Ut,{key:"default-monitoring-output"})),t}),[e]);return l.a.createElement(c.EuiBadgeGroup,{gutterSize:"xs"},t.map(((e,t)=>e)))})),zt=()=>l.a.createElement(c.EuiBadge,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.outputs.defaultOutputBadgeTitle",defaultMessage:"Agent integrations"})),Ut=()=>l.a.createElement(c.EuiBadge,null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.outputs.defaultMonitoringOutputBadgeTitle",defaultMessage:"Agent monitoring"})),Ht=m()(c.EuiFlexItem).withConfig({displayName:"NameFlexItemWithMaxWidth",componentId:"sc-zxtmo5-0"})(["max-width:250px;"]),qt=m()(c.EuiFlexGroup).withConfig({displayName:"FlexGroupWithMinWidth",componentId:"sc-zxtmo5-1"})(["min-width:0px;"]);const Gt=({outputs:e,deleteOutput:t})=>{const{getHref:a}=Object(o.lb)(),i=Object(n.useMemo)((()=>[{render:e=>l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},l.a.createElement(Ht,{grow:!1},l.a.createElement("p",{title:e.name,className:"eui-textTruncate"},e.name)),e.is_preconfigured&&l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiIcon,{type:"lock"}))),width:"288px",name:d.i18n.translate("xpack.fleet.settings.outputsTable.nameColomnTitle",{defaultMessage:"Name"})},{width:"172px",render:e=>function(e){switch(e){case"elasticsearch":return d.i18n.translate("xpack.fleet.settings.outputsTable.elasticsearchTypeLabel",{defaultMessage:"Elasticsearch"});default:return e}}(e.type),name:d.i18n.translate("xpack.fleet.settings.outputsTable.typeColomnTitle",{defaultMessage:"Type"})},{truncateText:!0,render:e=>l.a.createElement(qt,{direction:"column",gutterSize:"xs"},(e.hosts||[]).map((e=>l.a.createElement(c.EuiFlexItem,{key:e},l.a.createElement("p",{title:e,className:"eui-textTruncate"},e))))),name:d.i18n.translate("xpack.fleet.settings.outputsTable.hostColomnTitle",{defaultMessage:"Hosts"})},{render:e=>l.a.createElement(Rt,{output:e}),width:"200px",name:d.i18n.translate("xpack.fleet.settings.outputSection.defaultColomnTitle",{defaultMessage:"Default"})},{width:"68px",render:e=>{const n=!e.is_default&&!e.is_default_monitoring&&!e.is_preconfigured;return l.a.createElement(c.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},l.a.createElement(c.EuiFlexItem,{grow:!1},n&&l.a.createElement(c.EuiButtonIcon,{color:"text",iconType:"trash",onClick:()=>t(e),title:d.i18n.translate("xpack.fleet.settings.outputSection.deleteButtonTitle",{defaultMessage:"Delete"})})),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonIcon,{color:"text",iconType:"pencil",href:a("settings_edit_outputs",{outputId:e.id}),title:d.i18n.translate("xpack.fleet.settings.outputSection.editButtonTitle",{defaultMessage:"Edit"}),"data-test-subj":"editOutputBtn"})))},name:d.i18n.translate("xpack.fleet.settings.outputSection.actionsColomnTitle",{defaultMessage:"Actions"})}]),[t,a]);return l.a.createElement(c.EuiBasicTable,{columns:i,items:e})},Wt=({outputs:e,deleteOutput:t})=>{const{getHref:a}=Object(o.lb)();return l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiTitle,{size:"s"},l.a.createElement("h4",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.outputSectionTitle",defaultMessage:"Outputs"}))),l.a.createElement(c.EuiSpacer,{size:"xs"}),l.a.createElement(c.EuiText,{color:"subdued",size:"m"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.outputSectionSubtitle",defaultMessage:"Specify where agents will send data."})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(Gt,{outputs:e,deleteOutput:t}),l.a.createElement(c.EuiSpacer,{size:"s"}),false)},$t=({settings:e,outputs:t,deleteOutput:a})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(Bt,{fleetServerHosts:e.fleet_server_hosts}),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(Wt,{outputs:t,deleteOutput:a})),Vt=l.a.createContext(null);function Kt(){const e=Object(n.useContext)(Vt);return{confirm:Object(n.useCallback)((async(t,a,n)=>{if(null===e)throw new Error("Context need to be provided to use useConfirmModal");return new Promise((l=>{e.showModal({title:t,description:a,onConfirm:()=>l(!0),onCancel:()=>l(!1),buttonColor:null==n?void 0:n.buttonColor})}))}),[e])}}const Qt=({children:e})=>{const[t,a]=Object(n.useState)(!1),[i,s]=Object(n.useState)({onCancel:()=>{},onConfirm:()=>{}}),r=Object(n.useCallback)((({title:e,description:t,onConfirm:n,onCancel:l})=>{a(!0),s({title:e,description:t,onConfirm:()=>{a(!1),n()},onCancel:()=>{a(!1),l()}})}),[]);return l.a.createElement(Vt.Provider,{value:{showModal:r}},t&&l.a.createElement(c.EuiPortal,null,l.a.createElement(c.EuiConfirmModal,{title:i.title,buttonColor:i.buttonColor,onCancel:i.onCancel,onConfirm:i.onConfirm,cancelButtonText:d.i18n.translate("xpack.fleet.settings.confirmModal.cancelButtonText",{defaultMessage:"Cancel"}),confirmButtonText:d.i18n.translate("xpack.fleet.settings.confirmModal.confirmButtonText",{defaultMessage:"Save and deploy"}),defaultFocusedButton:"confirm"},i.description)),e)},Yt=m.a.div.withConfig({displayName:"DraggableDiv",componentId:"sc-b43cpi-0"})(["margin:",";"],(e=>e.theme.eui.euiSizeS));function Zt(e){return null!=e&&e.length?e.map(((e,t)=>l.a.createElement(c.EuiFormErrorText,{key:t},e))):null}const Xt=l.a.memo((({id:e,index:t,value:a,onChange:i,onDelete:s,autoFocus:r,errors:o,disabled:u})=>{var m;const p=Object(n.useCallback)((()=>{s(t)}),[s,t]),f=(null!==(m=null==o?void 0:o.length)&&void 0!==m?m:0)>0,E=Object(g.useTheme)();return l.a.createElement(c.EuiDraggable,{spacing:"m",index:t,draggableId:e,isDragDisabled:u,customDragHandle:!0,style:{paddingLeft:0,paddingRight:0}},((e,t)=>l.a.createElement(c.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1,style:t.isDragging?{background:E.eui.euiPanelBackgroundColorModifiers.plain}:{}},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(Yt,O()({},e.dragHandleProps,{"aria-label":d.i18n.translate("xpack.fleet.settings.sortHandle",{defaultMessage:"Sort host handle"})}),l.a.createElement(c.EuiIcon,{color:"text",type:"grab"}))),l.a.createElement(c.EuiFlexItem,null,l.a.createElement(c.EuiFieldText,{fullWidth:!0,value:a,onChange:i,autoFocus:r,isInvalid:f,disabled:u,placeholder:d.i18n.translate("xpack.fleet.hostsInput.placeholder",{defaultMessage:"Specify host URL"})}),Zt(o)),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonIcon,{color:"text",onClick:p,iconType:"cross",disabled:u,"aria-label":d.i18n.translate("xpack.fleet.settings.deleteHostButton",{defaultMessage:"Delete host"})})))))})),Jt=({id:e,value:t,onChange:a,helpText:i,label:s,isInvalid:r,errors:o,disabled:g})=>{const[m,p]=Object(n.useState)(!1),f=Object(n.useMemo)((()=>t.length?t:[""]),[t]),E=Object(n.useMemo)((()=>f.map(((e,t)=>({value:e,onChange:e=>{const n=[...f];n[t]=e.target.value,a(n)}})))),[f,a]),h=Object(n.useMemo)((()=>o?o.reduce(((e,t)=>(void 0===t.index||(e[t.index]||(e[t.index]=[]),e[t.index].push(t.message)),e)),[]):[]),[o]),b=Object(n.useCallback)((e=>{h.splice(e,1),a([...f.slice(0,e),...f.slice(e+1)])}),[f,a,h]),y=Object(n.useCallback)((()=>{p(!0),a([...f,""])}),[f,a]),v=Object(n.useCallback)((({source:e,destination:t})=>{if(e&&t){const n=Object(c.euiDragDropReorder)(f,e.index,t.index),l=h[e.index];h.splice(e.index,1),h.splice(t.index,0,l),a(n)}}),[f,a,h]),k=Object(n.useMemo)((()=>o&&o.filter((e=>void 0===e.index)).map((({message:e})=>e))),[o]),x=E.length>1;return l.a.createElement(c.EuiFormRow,{fullWidth:!0,label:s,isInvalid:r},l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFormHelpText,null,i),i&&l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiDragDropContext,{onDragEnd:v},l.a.createElement(c.EuiDroppable,{droppableId:`${e}Droppable`,spacing:"none"},E.map(((t,a)=>l.a.createElement(l.a.Fragment,{key:a},x?l.a.createElement(Xt,{id:`${e}${a}Draggable`,index:a,onChange:t.onChange,onDelete:b,value:t.value,autoFocus:m,errors:h[a],disabled:g}):l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiFieldText,{fullWidth:!0,value:t.value,onChange:t.onChange,isInvalid:!!h[a],placeholder:d.i18n.translate("xpack.fleet.hostsInput.placeholder",{defaultMessage:"Specify host URL"}),disabled:g}),Zt(h[a]))))))),Zt(k),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(c.EuiButtonEmpty,{disabled:g,size:"xs",flush:"left",iconType:"plusInCircle",onClick:y},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.hostsInput.addRow",defaultMessage:"Add row"}))))};async function ea(e){var t,a,n;let l=`${v.c}.data_output_id:"${e.id}" or ${v.c}.monitoring_output_id:"${e.id}"`;e.is_default&&(l+=` or (not ${v.c}.data_output_id:*)`);const i=await Object(o.p)({kuery:l,page:1,perPage:v.m});if(i.error)throw i.error;const s=null!==(t=null===(a=i.data)||void 0===a||null===(n=a.items)||void 0===n?void 0:n.length)&&void 0!==t?t:0;let r=0;if(s>0){var c,u,d;const e=await Object(o.r)({page:1,perPage:0,showInactive:!1,kuery:null===(c=i.data)||void 0===c?void 0:c.items.map((e=>`policy_id:"${e.id}"`)).join(" or ")});if(e.error)throw e.error;r=null!==(u=null===(d=e.data)||void 0===d?void 0:d.total)&&void 0!==u?u:0}return{agentPolicyCount:s,agentCount:r}}const ta=/^(https?):\/\/[^\s$.?#].[^\s]*$/gm,aa=()=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.confirmModalTitle",defaultMessage:"Save and deploy changes?"}),na=({agentCount:e,agentPolicyCount:t})=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.confirmModalText",defaultMessage:"This action will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{agents:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:e}})),policies:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:t}}))}});function la(e){if(0===e.length)return[{message:d.i18n.translate("xpack.fleet.settings.fleetServerHostsEmptyError",{defaultMessage:"At least one URL is required"})}];const t=[],a={};return e.forEach(((e,n)=>{e.match(ta)||t.push({message:d.i18n.translate("xpack.fleet.settings.fleetServerHostsError",{defaultMessage:"Invalid URL"}),index:n});const l=a[e]||[];a[e]=[...l,n]})),Object.values(a).filter((({length:e})=>e>1)).forEach((e=>{e.forEach((e=>t.push({message:d.i18n.translate("xpack.fleet.settings.fleetServerHostsDuplicateError",{defaultMessage:"Duplicate URL"}),index:e})))})),t.length?t:e.length&&Object(F.isDiffPathProtocol)(e)?[{message:d.i18n.translate("xpack.fleet.settings.fleetServerHostsDifferentPathOrProtocolError",{defaultMessage:"Protocol and path must be the same for each URL"})}]:void 0}function ia(e,t){const[a,i]=Object(n.useState)(!1),{notifications:s}=Object(o.rb)(),{confirm:r}=Kt(),c=Object(o.S)("fleetServerHostsInput",e,la),u=c.validate,g=Object(n.useCallback)((()=>u()),[u]),m=Object(n.useCallback)((async()=>{try{if(!g())return;const{agentCount:e,agentPolicyCount:a}=await async function(){var e,t,a,n;const l=await Object(o.p)({perPage:0});if(l.error)throw l.error;const i=null!==(e=null===(t=l.data)||void 0===t?void 0:t.total)&&void 0!==e?e:0,s=await Object(o.r)({page:1,perPage:0,showInactive:!1});if(s.error)throw s.error;return{agentPolicyCount:i,agentCount:null!==(a=null===(n=s.data)||void 0===n?void 0:n.total)&&void 0!==a?a:0}}();if(!await r(l.a.createElement(aa,null),l.a.createElement(na,{agentCount:e,agentPolicyCount:a})))return;i(!0);const n=await Object(o.J)({fleet_server_hosts:c.value});if(n.error)throw n.error;s.toasts.addSuccess(d.i18n.translate("xpack.fleet.settings.fleetServerHostsFlyout.successToastTitle",{defaultMessage:"Settings saved"})),i(!1),t()}catch(e){i(!1),s.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.settings.fleetServerHostsFlyout.errorToastTitle",{defaultMessage:"An error happened while saving settings"})})}}),[c.value,g,s,r,t]);return{isLoading:a,isDisabled:a||!c.hasChanged||c.props.isInvalid,submit:m,fleetServerHostsInput:c}}const sa=({onClose:e,fleetServerHosts:t})=>{const{docLinks:a}=Object(o.rb)(),n=ia(t,e);return l.a.createElement(c.EuiFlyout,{maxWidth:670,onClose:e},l.a.createElement(c.EuiFlyoutHeader,{hasBorder:!0},l.a.createElement(c.EuiTitle,{size:"m"},l.a.createElement("h2",{id:"FleetPackagePolicyPreviousVersionFlyoutTitle"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.title",defaultMessage:"Fleet Server hosts"})))),l.a.createElement(c.EuiFlyoutBody,null,l.a.createElement(c.EuiText,{color:"subdued"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.description",defaultMessage:"Specify the URLs that your agents will use to connect to a Fleet Server. If multiple URLs exist, Fleet shows the first provided URL for enrollment purposes. Fleet Server uses port 8220 by default. Refer to the {link}.",values:{link:l.a.createElement(c.EuiLink,{href:a.links.fleet.settingsFleetServerHostSettings,target:"_blank",external:!0},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.userGuideLink",defaultMessage:"Fleet and Elastic Agent Guide"}))}})),l.a.createElement(c.EuiSpacer,{size:"m"}),l.a.createElement(Jt,O()({},n.fleetServerHostsInput.props,{id:"fleet-server-inputs"}))),l.a.createElement(c.EuiFlyoutFooter,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{onClick:()=>e(),flush:"left"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,isLoading:n.isLoading,isDisabled:n.isDisabled,onClick:n.submit,"data-test-subj":"saveApplySettingsBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))},ra=m.a.div.withConfig({displayName:"CodeEditorContainer",componentId:"sc-11vyk7j-0"})(["min-height:0;position:relative;height:116px;"]),oa=m()(c.EuiTextColor).attrs((e=>({color:"subdued",size:"xs"}))).withConfig({displayName:"CodeEditorPlaceholder",componentId:"sc-11vyk7j-1"})(["position:absolute;top:0;left:0;font-family:Menlo,Monaco,'Courier New',monospace;font-size:12px;line-height:21px;pointer-events:none;"]),ca={minimap:{enabled:!1},ariaLabel:d.i18n.translate("xpack.fleet.settings.yamlCodeEditor",{defaultMessage:"YAML Code Editor"}),scrollBeyondLastLine:!1,wordWrap:"on",wrappingIndent:"indent",automaticLayout:!0,tabSize:2,lineNumbers:"off",lineNumbersMinChars:0,glyphMargin:!1,folding:!1,lineDecorationsWidth:0},ua=e=>{const{placeholder:t,disabled:a,...n}=e;return a?l.a.createElement(c.EuiCodeBlock,{style:{height:"116px"},language:"yaml",isCopyable:!1,paddingSize:"s"},l.a.createElement("pre",null,n.value)):l.a.createElement(ra,null,l.a.createElement(E.CodeEditor,O()({languageId:"yaml",width:"100%",height:"116px",options:ca},n)),(!n.value||""===n.value)&&l.a.createElement(oa,null,t))};function da(e){const t=[],a={};if(e.forEach(((e,n)=>{try{if(!e)throw new Error("Host URL required");const t=new URL(e);if(!["http:","https:"].includes(t.protocol))throw new Error("Invalid protocol")}catch(e){t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.elasticHostError",{defaultMessage:"Invalid URL"}),index:n})}const l=a[e]||[];a[e]=[...l,n]})),Object.values(a).filter((({length:e})=>e>1)).forEach((e=>{e.forEach((e=>t.push({message:d.i18n.translate("xpack.fleet.settings.outputForm.elasticHostDuplicateError",{defaultMessage:"Duplicate URL"}),index:e})))})),t.length)return t}function ga(e){try{return void Object(bt.safeLoad)(e)}catch(e){return[d.i18n.translate("xpack.fleet.settings.outputForm.invalidYamlFormatErrorMessage",{defaultMessage:"Invalid YAML: {reason}",values:{reason:e.message}})]}}function ma(e){if(!e||""===e)return[d.i18n.translate("xpack.fleet.settings.outputForm.nameIsRequiredErrorMessage",{defaultMessage:"Name is required"})]}function pa(e){if(""!==e&&!e.match(/^[a-zA-Z0-9]+$/))return[d.i18n.translate("xpack.fleet.settings.outputForm.caTrusterdFingerprintInvalidErrorMessage",{defaultMessage:"CA trusted fingerprint should be a base64 CA sha256 fingerprint"})]}const fa=()=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.confirmModalTitle",defaultMessage:"Save and deploy changes?"}),Ea=({output:e,agentCount:t,agentPolicyCount:a})=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.confirmModalText",defaultMessage:"This action will update {outputName} output. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{outputName:l.a.createElement("strong",null,e.name),agents:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}});function ha(e,t){var a,i,s,r,c,u,g,m;const[p,f]=Object(n.useState)(!1),{notifications:E}=Object(o.rb)(),{confirm:h}=Kt(),b=null!==(a=null==t?void 0:t.is_preconfigured)&&void 0!==a&&a,y=Object(o.gb)(null!==(i=null==t?void 0:t.name)&&void 0!==i?i:"",ma,b),v=Object(o.gb)(null!==(s=null==t?void 0:t.type)&&void 0!==s?s:"",void 0,b),k=Object(o.S)("esHostsComboxBox",null!==(r=null==t?void 0:t.hosts)&&void 0!==r?r:[],da,b),x=Object(o.gb)(null!==(c=null==t?void 0:t.config_yaml)&&void 0!==c?c:"",ga,b),M=Object(o.gb)(null!==(u=null==t?void 0:t.ca_trusted_fingerprint)&&void 0!==u?u:"",pa,b),O=Object(o.sb)(null!==(g=null==t?void 0:t.is_default)&&void 0!==g&&g,b||(null==t?void 0:t.is_default)),F=Object(o.sb)(null!==(m=null==t?void 0:t.is_default_monitoring)&&void 0!==m&&m,b||(null==t?void 0:t.is_default_monitoring)),S={nameInput:y,typeInput:v,elasticsearchUrlInput:k,additionalYamlConfigInput:x,defaultOutputInput:O,defaultMonitoringOutputInput:F,caTrustedFingerprintInput:M},j=Object.values(S).some((e=>e.hasChanged)),I=Object(n.useCallback)((()=>{const e=y.validate(),t=k.validate(),a=x.validate(),n=M.validate();return!!(t&&a&&e&&n)}),[y,k,x,M]);return{inputs:S,submit:Object(n.useCallback)((async()=>{try{if(!I())return;f(!0);const a={name:y.value,type:"elasticsearch",hosts:k.value,is_default:O.value,is_default_monitoring:F.value,config_yaml:x.value,ca_trusted_fingerprint:M.value};if(t){if(!await async function(e,t){const{agentCount:a,agentPolicyCount:n}=await ea(e);return t(l.a.createElement(fa,null),l.a.createElement(Ea,{agentCount:a,agentPolicyCount:n,output:e}))}(t,h))return void f(!1);const e=await Object(o.I)(t.id,a);if(e.error)throw e.error}else{const e=await Object(o.G)(a);if(e.error)throw e.error}e(),f(!1)}catch(e){f(!1),E.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.settings.outputForm.errorToastTitle",{defaultMessage:"Error while saving output"})})}}),[I,h,x.value,F.value,O.value,k.value,M.value,y.value,E.toasts,e,t]),isLoading:p,isDisabled:p||b||t&&!j}}const ba=({onClose:e,output:t})=>{const a=ha(e,t),n=a.inputs;return l.a.createElement(c.EuiFlyout,{maxWidth:670,onClose:e},l.a.createElement(c.EuiFlyoutHeader,{hasBorder:!0},l.a.createElement(c.EuiTitle,{size:"m"},l.a.createElement("h2",{id:"FleetEditOutputFlyoutTitle"},t?l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.editTitle",defaultMessage:"Edit output"}):l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.createTitle",defaultMessage:"Add new output"})))),l.a.createElement(c.EuiFlyoutBody,null,(null==t?void 0:t.is_preconfigured)&&l.a.createElement(l.a.Fragment,null,l.a.createElement(c.EuiCallOut,{iconType:"lock",title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.preconfiguredOutputCalloutTitle",defaultMessage:"This output is managed outside of Fleet"})},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.preconfiguredOutputCalloutDescription",defaultMessage:"Most actions related to this output are unavailable. Refer to your kibana config for more detail."})),l.a.createElement(c.EuiSpacer,{size:"m"})),l.a.createElement(c.EuiForm,null,l.a.createElement(c.EuiFormRow,O()({fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.nameInputLabel",defaultMessage:"Name"})},n.nameInput.formRowProps),l.a.createElement(c.EuiFieldText,O()({fullWidth:!0},n.nameInput.props,{placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.nameInputPlaceholder",{defaultMessage:"Specify name"})}))),l.a.createElement(c.EuiFormRow,{fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.typeInputLabel",defaultMessage:"Type"})},l.a.createElement(c.EuiSelect,O()({fullWidth:!0},n.typeInput.props,{options:[{value:"elasticsearch",text:"Elasticsearch"}],placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.typeInputPlaceholder",{defaultMessage:"Specify type"})}))),l.a.createElement(Jt,O()({label:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.hostsInputLabel",{defaultMessage:"Hosts"})},n.elasticsearchUrlInput.props)),l.a.createElement(c.EuiFormRow,O()({fullWidth:!0,label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.caTrustedFingerprintInputLabel",defaultMessage:"Elasticsearch CA trusted fingerprint (optional)"})},n.caTrustedFingerprintInput.formRowProps),l.a.createElement(c.EuiFieldText,O()({fullWidth:!0},n.caTrustedFingerprintInput.props,{placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.caTrustedFingerprintInputPlaceholder",{defaultMessage:"Specify Elasticsearch CA trusted fingerprint"})}))),l.a.createElement(c.EuiFormRow,O()({label:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.yamlConfigInputLabel",{defaultMessage:"Advanced YAML configuration"})},n.additionalYamlConfigInput.formRowProps,{fullWidth:!0}),l.a.createElement(ua,{value:n.additionalYamlConfigInput.value,onChange:n.additionalYamlConfigInput.setValue,disabled:n.additionalYamlConfigInput.props.disabled,placeholder:d.i18n.translate("xpack.fleet.settings.editOutputFlyout.yamlConfigInputPlaceholder",{defaultMessage:"# YAML settings here will be added to the Elasticsearch output section of each agent policy."})})),l.a.createElement(c.EuiFormRow,O()({fullWidth:!0},n.defaultOutputInput.formRowProps),l.a.createElement(c.EuiSwitch,O()({},n.defaultOutputInput.props,{label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.defaultOutputSwitchLabel",defaultMessage:"Make this output the default for {boldAgentIntegrations}.",values:{boldAgentIntegrations:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.agentIntegrationsBold",defaultMessage:"agent integrations"}))}})}))),l.a.createElement(c.EuiFormRow,O()({fullWidth:!0},n.defaultMonitoringOutputInput.formRowProps),l.a.createElement(c.EuiSwitch,O()({},n.defaultMonitoringOutputInput.props,{label:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.defaultMontoringOutputSwitchLabel",defaultMessage:"Make this output the default for {boldAgentMonitoring}.",values:{boldAgentMonitoring:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.agentMonitoringBold",defaultMessage:"agent monitoring"}))}})}))))),l.a.createElement(c.EuiFlyoutFooter,null,l.a.createElement(c.EuiFlexGroup,{justifyContent:"spaceBetween"},l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButtonEmpty,{onClick:e,flush:"left"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),l.a.createElement(c.EuiFlexItem,{grow:!1},l.a.createElement(c.EuiButton,{fill:!0,isLoading:a.isLoading,isDisabled:a.isDisabled,onClick:a.submit,"data-test-subj":"saveApplySettingsBtn"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))},ya=()=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.confirmModalTitle",defaultMessage:"Delete and deploy changes?"}),va=({output:e,agentCount:t,agentPolicyCount:a})=>l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.confirmModalText",defaultMessage:"This action will delete {outputName} output. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{outputName:l.a.createElement("strong",null,e.name),agents:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:l.a.createElement("strong",null,l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}});const ka=(xa=()=>{var e,t,a,i;Object(o.R)("settings");const s=Object(r.useHistory)(),u=Object(o.fb)(),g=Object(o.cb)(),{deleteOutput:m}=function(e){const{confirm:t}=Kt(),{notifications:a}=Object(o.rb)();return{deleteOutput:Object(n.useCallback)((async n=>{try{const{agentCount:a,agentPolicyCount:i}=await ea(n);if(!await t(l.a.createElement(ya,null),l.a.createElement(va,{output:n,agentCount:a,agentPolicyCount:i}),{buttonColor:"danger"}))return;const s=await Object(o.n)(n.id);if(s.error)throw s.error;e()}catch(e){a.toasts.addError(e,{title:d.i18n.translate("xpack.fleet.settings.deleteOutputs.errorToastTitle",{defaultMessage:"Error deleting output"})})}}),[t,a.toasts,e])}}(g.resendRequest),p=u.resendRequest,f=g.resendRequest,E=Object(n.useCallback)((()=>{p(),f(),s.replace(v.n.settings()[1])}),[s,p,f]);return u.isLoading&&u.isInitialRequest||null===(e=u.data)||void 0===e||!e.item||g.isLoading&&g.isInitialRequest||null===(t=g.data)||void 0===t||!t.items?l.a.createElement(k.a,{section:"settings"},l.a.createElement(y.l,null)):l.a.createElement(k.a,{section:"settings"},l.a.createElement(r.Router,{history:s},l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:v.g.settings_edit_fleet_server_hosts},l.a.createElement(c.EuiPortal,null,l.a.createElement(sa,{onClose:E,fleetServerHosts:null!==(a=null===(i=u.data)||void 0===i?void 0:i.item.fleet_server_hosts)&&void 0!==a?a:[]}))),!1,l.a.createElement(r.Route,{path:v.g.settings_edit_outputs},(e=>{var t;const a=null===(t=g.data)||void 0===t?void 0:t.items.find((t=>e.match.params.outputId===t.id));return a?l.a.createElement(c.EuiPortal,null,l.a.createElement(ba,{onClose:E,output:a})):l.a.createElement(r.Redirect,{to:v.g.settings})})))),l.a.createElement($t,{settings:u.data.item,outputs:g.data.items,deleteOutput:m}))},e=>l.a.createElement(Qt,null,l.a.createElement(xa,e)));var xa;const Ma=({isAddIntegrationsPath:e,children:t})=>l.a.createElement(c.EuiErrorBoundary,null,e?l.a.createElement(k.c,{leftColumn:l.a.createElement(k.b,null)},t):l.a.createElement(k.a,null,l.a.createElement(k.d,null,t))),Oa=m()(c.EuiPanel).withConfig({displayName:"Panel",componentId:"sc-11e0awm-0"})(["max-width:500px;margin-right:auto;margin-left:auto;"]),Fa=Object(n.memo)((({error:e})=>"MISSING_SECURITY"===e?l.a.createElement(Ee.b,{missingRequirements:["security_required","api_keys"]}):"MISSING_PRIVILEGES"===e?l.a.createElement(Oa,{"data-test-subj":"missingPrivilegesPrompt"},l.a.createElement(c.EuiEmptyPrompt,{iconType:"securityApp",title:l.a.createElement("h2",{"data-test-subj":"missingPrivilegesPromptTitle"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.permissionDeniedErrorTitle",defaultMessage:"Permission denied"})),body:l.a.createElement("p",{"data-test-subj":"missingPrivilegesPromptMessage"},l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.permissionDeniedErrorMessage",defaultMessage:"You are not authorized to access Fleet. It requires the {roleName1} Kibana privilege for Fleet, and the {roleName2} or {roleName1} privilege for Integrations.",values:{roleName1:l.a.createElement(c.EuiCode,null,'"All"'),roleName2:l.a.createElement(c.EuiCode,null,'"Read"')}}))})):l.a.createElement(y.h,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.permissionsRequestErrorMessageTitle",defaultMessage:"Unable to check permissions"}),error:d.i18n.translate("xpack.fleet.permissionsRequestErrorMessageDescription",{defaultMessage:"There was a problem checking Fleet permissions"})}))),Sa=Object(n.memo)((({children:e})=>{Object(o.R)("base");const t=Object(o.rb)(),{notifications:a}=t,i=Object(o.Q)().fleet.all,[s,c]=Object(n.useState)(!1),[g,m]=Object(n.useState)(),[p,f]=Object(n.useState)(!1),[E,h]=Object(n.useState)(null),b=!!Object(r.useRouteMatch)(v.g.add_integration_to_policy);return Object(n.useEffect)((()=>{(async()=>{c(!1),m(void 0),f(!1),h(null);try{var e;c(!0);const s=await Object(o.z)();if(c(!1),null!==(e=s.data)&&void 0!==e&&e.success){try{var t,n;const e=await Object(o.L)();e.error&&h(e.error),null!==(t=e.data)&&void 0!==t&&null!==(n=t.nonFatalErrors)&&void 0!==n&&n.length&&a.toasts.addError(e.data.nonFatalErrors[0],{title:d.i18n.translate("xpack.fleet.setup.uiPreconfigurationErrorTitle",{defaultMessage:"Configuration error"})}),i||m("MISSING_PRIVILEGES")}catch(e){h(e)}f(!0)}else{var l;m((null===(l=s.data)||void 0===l?void 0:l.error)||"REQUEST_ERROR")}}catch(e){m("REQUEST_ERROR")}})()}),[a.toasts,i]),s||g?l.a.createElement(Ma,{isAddIntegrationsPath:b},s?l.a.createElement(y.l,null):l.a.createElement(Fa,{error:g})):!p||E?l.a.createElement(Ma,{isAddIntegrationsPath:b},E?l.a.createElement(y.h,{title:l.a.createElement(u.FormattedMessage,{id:"xpack.fleet.initializationErrorMessageTitle",defaultMessage:"Unable to initialize Fleet"}),error:E}):l.a.createElement(y.j,null)):l.a.createElement(l.a.Fragment,null,e)})),ja=Object(n.memo)((({children:e,startServices:t,config:a,history:n,kibanaVersion:i,extensions:s,routerHistory:u,theme$:d})=>{const g=f()(t.uiSettings.get$("theme:darkMode"));return l.a.createElement(E.RedirectAppLinks,{application:t.application},l.a.createElement(t.i18n.Context,null,l.a.createElement(E.KibanaContextProvider,{services:{...t}},l.a.createElement(c.EuiErrorBoundary,null,l.a.createElement(o.b.Provider,{value:a},l.a.createElement(o.d.Provider,{value:i},l.a.createElement(E.KibanaThemeProvider,{theme$:d},l.a.createElement(h.EuiThemeProvider,{darkMode:g},l.a.createElement(o.f.Provider,{value:s},l.a.createElement(o.c,null,l.a.createElement(r.Router,{history:n},l.a.createElement(b.c,{notifications:t.notifications,theme$:d},e))))))))))))})),Ia=Object(n.memo)((({setHeaderActionMenu:e})=>{const t=Object(o.rb)(),{TopNavMenu:a}=t.navigation.ui,n=[{label:d.i18n.translate("xpack.fleet.appNavigation.sendFeedbackButton",{defaultMessage:"Send Feedback"}),iconType:"popout",run:()=>window.open("https://ela.st/fleet-feedback")}];return l.a.createElement(a,{appName:d.i18n.translate("xpack.fleet.appTitle",{defaultMessage:"Fleet"}),config:n,setMenuMountPoint:e})})),Ca=Object(n.memo)((({setHeaderActionMenu:e})=>l.a.createElement(l.a.Fragment,null,l.a.createElement(Ia,{setHeaderActionMenu:e}),l.a.createElement(r.Switch,null,l.a.createElement(r.Route,{path:v.g.agents},l.a.createElement(ht,null)),l.a.createElement(r.Route,{path:v.g.policies},l.a.createElement($,null)),l.a.createElement(r.Route,{path:v.g.enrollment_tokens},l.a.createElement(Nt,null)),l.a.createElement(r.Route,{path:v.g.data_streams},l.a.createElement(Q,null)),l.a.createElement(r.Route,{path:v.g.settings},l.a.createElement(ka,null)),l.a.createElement(r.Route,{path:v.g.add_integration_to_policy},l.a.createElement(wt,null)),l.a.createElement(r.Route,{render:({location:e})=>{if(!(""===e.pathname&&e.hash.length>0))return l.a.createElement(r.Redirect,{to:v.g.agents});const t=e.hash.replace(/^#(\/fleet)?/,"");return l.a.createElement(r.Redirect,{to:{...e,pathname:t,hash:void 0}})}}))))),Pa=({isAllowed:e=!1,restrictedPath:t="/",...a})=>e?l.a.createElement(r.Route,a):l.a.createElement(r.Redirect,{to:{pathname:t}}),wa=({basepath:e,startServices:t,config:a,history:n,kibanaVersion:i,extensions:s,setHeaderActionMenu:r,theme$:o})=>l.a.createElement(ja,{basepath:e,startServices:t,config:a,history:n,kibanaVersion:i,extensions:s,theme$:o},l.a.createElement(Sa,null,l.a.createElement(Ca,{setHeaderActionMenu:r})));function Ta(e,{element:t,appBasePath:a,history:n,setHeaderActionMenu:i,theme$:r},o,c,u){return s.a.render(l.a.createElement(wa,{basepath:a,startServices:e,config:o,history:n,kibanaVersion:c,extensions:u,setHeaderActionMenu:i,theme$:r}),t),()=>{s.a.unmountComponentAtNode(t)}}const La=e=>{e.chrome.docTitle.reset(),e.chrome.setBreadcrumbs([]),o.g.stop()}}}]);