(window.discover_bundle_jsonpfunction=window.discover_bundle_jsonpfunction||[]).push([[6],{225:function(e,t,s){"use strict";s.r(t),s.d(t,"SavedSearchEmbeddable",(function(){return saved_search_embeddable_SavedSearchEmbeddable}));var i=s(0),r=s.n(i),a=s(3),o=s.n(a),n=s(50),c=s.n(n),h=s(2),l=s(11),u=s(41),d=s(10),p=s(63),g=s(13),b=s(6),S=s(66),v=s.n(S),m=s(15),j=s(97),x=s(5);const O=({totalHitCount:e})=>Object(x.jsx)(m.EuiText,{grow:!1,size:"s",style:{paddingRight:2}},Object(x.jsx)(u.FormattedMessage,{id:"discover.docTable.totalDocuments",defaultMessage:"{totalDocuments} documents",values:{totalDocuments:Object(x.jsx)("strong",null,e)}})),P=Object(a.memo)(j.a);function f(e){const[t,s]=Object(a.useState)(void 0);return Object(x.jsx)(m.EuiFlexGroup,{style:{width:"100%"},direction:"column",gutterSize:"xs",responsive:!1},0!==e.totalHitCount&&Object(x.jsx)(m.EuiFlexItem,{grow:!1,style:{alignSelf:"flex-end"}},Object(x.jsx)(O,{totalHitCount:e.totalHitCount})),Object(x.jsx)(m.EuiFlexItem,{style:{minHeight:0}},Object(x.jsx)(P,v()({},e,{setExpandedDoc:s,expandedDoc:t}))))}s(95);var C=s(8),E=s(87);const T={marginLeft:"auto",marginRight:s(47).euiLightVars.euiSizeL},I=({pageSize:e,pageCount:t,activePage:s,onPageSizeChange:i,onPageClick:r})=>{const[o,n]=Object(a.useState)(!1),c=h.i18n.translate("discover.docTable.rows",{defaultMessage:"rows"}),l=()=>n(!1),d=[25,50,100].map((t=>{return Object(x.jsx)(m.EuiContextMenuItem,{key:`${t} rows`,icon:(s=t,s===e?"check":"empty"),onClick:()=>{l(),i(t)}},t," ",c);var s}));return Object(x.jsx)(m.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",responsive:!1},Object(x.jsx)(m.EuiFlexItem,{grow:!1},Object(x.jsx)(m.EuiPopover,{button:Object(x.jsx)(m.EuiButtonEmpty,{size:"xs",color:"text",iconType:"arrowDown",iconSide:"right",onClick:()=>n((e=>!e))},Object(x.jsx)(u.FormattedMessage,{id:"discover.docTable.rowsPerPage",defaultMessage:"Rows per page: {pageSize}",values:{pageSize:e}})),isOpen:o,closePopover:l,panelPaddingSize:"none"},Object(x.jsx)(m.EuiContextMenuPanel,{items:d}))),Object(x.jsx)(m.EuiFlexItem,{grow:!1,style:T},Object(x.jsx)(m.EuiPagination,{"aria-label":h.i18n.translate("discover.docTable.documentsNavigation",{defaultMessage:"Documents navigation"}),pageCount:t,activePage:s,onPageClick:r,compressed:!0})))};var F=s(98),w=s(19);const _=Object(a.memo)(F.a),R=e=>{const t=Object(w.a)(),s=Object(a.useRef)(null),{curPageIndex:i,pageSize:r,totalPages:o,startIndex:n,hasNextPage:c,changePageIndex:h,changePageSize:l}=Object(E.a)({initialPageSize:50,totalItems:e.rows.length}),d=0!==o,p=Object(a.useCallback)((()=>{s.current&&s.current.scrollTo(0,0)}),[]),g=Object(a.useMemo)((()=>e.rows.slice(n,r+n)),[r,n,e.rows]),b=Object(a.useCallback)((e=>{p(),h(e)}),[h,p]),S=Object(a.useCallback)((e=>{p(),l(e)}),[l,p]),j=Object(a.useMemo)((()=>!c&&e.rows.length<e.totalHitCount),[c,e.rows.length,e.totalHitCount]),P=Object(a.useMemo)((()=>t.uiSettings.get(C.SAMPLE_SIZE_SETTING,500)),[t]),f=Object(a.useCallback)((e=>Object(x.jsx)("div",{className:"kbnDocTable__container"},Object(x.jsx)("table",{className:"kbnDocTable table","data-test-subj":"docTable"},Object(x.jsx)("thead",null,e.renderHeader()),Object(x.jsx)("tbody",null,e.renderRows(g))))),[g]);return Object(x.jsx)(m.EuiFlexGroup,{style:{width:"100%"},direction:"column",gutterSize:"xs",responsive:!1},Object(x.jsx)(m.EuiFlexItem,{grow:!1},Object(x.jsx)(m.EuiFlexGroup,{justifyContent:"flexEnd",alignItems:"center",gutterSize:"xs",responsive:!1,wrap:!0},j&&Object(x.jsx)(m.EuiFlexItem,{grow:!1},Object(x.jsx)(m.EuiText,{grow:!1,size:"s",color:"subdued"},Object(x.jsx)(u.FormattedMessage,{id:"discover.docTable.limitedSearchResultLabel",defaultMessage:"Limited to {resultCount} results. Refine your search.",values:{resultCount:P}}))),0!==e.totalHitCount&&Object(x.jsx)(m.EuiFlexItem,{grow:!1,"data-test-subj":"toolBarTotalDocsText"},Object(x.jsx)(O,{totalHitCount:e.totalHitCount})))),Object(x.jsx)(m.EuiFlexItem,{style:{minHeight:0}},Object(x.jsx)(_,v()({ref:s},e,{render:f}))),d&&Object(x.jsx)(m.EuiFlexItem,{grow:!1},Object(x.jsx)(I,{pageSize:r,pageCount:o,activePage:i,onPageClick:b,onPageSizeChange:S})))};function y(e){return Object(x.jsx)(u.I18nProvider,null,Object(x.jsx)(R,{columns:e.columns,rows:e.rows,totalHitCount:e.totalHitCount,indexPattern:e.indexPattern,onSort:e.onSort,onAddColumn:e.onAddColumn,onMoveColumn:e.onMoveColumn,onRemoveColumn:e.onRemoveColumn,sort:e.sort,onFilter:e.onFilter,useNewFieldsApi:e.useNewFieldsApi,searchDescription:e.searchDescription,sharedItemTitle:e.sharedItemTitle,isLoading:e.isLoading,dataTestSubj:"embeddedSavedSearchDocTable"}))}const A=o.a.memo(y),D=o.a.memo(f);function L({searchProps:e,useLegacyTable:t}){return t?Object(x.jsx)(A,e):Object(x.jsx)(D,v()({},e,{className:"dscDiscoverGrid"}))}var M=s(101),z=s(75),H=s(68),q=s(80);var G=s(107),N=s(20);class saved_search_embeddable_SavedSearchEmbeddable extends d.Embeddable{constructor({savedSearch:e,editUrl:t,editPath:s,indexPatterns:i,editable:a,filterManager:o,services:n},c,l,u){super(c,{defaultTitle:e.title,editUrl:t,editPath:s,editApp:"discover",indexPatterns:i,editable:a},u),r()(this,"savedSearch",void 0),r()(this,"inspectorAdapters",void 0),r()(this,"panelTitle",""),r()(this,"filtersSearchSource",void 0),r()(this,"subscription",void 0),r()(this,"type",g.a),r()(this,"filterManager",void 0),r()(this,"abortController",void 0),r()(this,"services",void 0),r()(this,"prevTimeRange",void 0),r()(this,"prevFilters",void 0),r()(this,"prevQuery",void 0),r()(this,"prevSearchSessionId",void 0),r()(this,"searchProps",void 0),r()(this,"node",void 0),r()(this,"fetch",(async()=>{const e=this.input.searchSessionId,t=!this.services.uiSettings.get(C.SEARCH_FIELDS_FROM_SOURCE,!1);if(!this.searchProps)return;const{searchSource:s}=this.savedSearch;this.abortController&&this.abortController.abort(),this.abortController=new AbortController,((e,t,s,i,r)=>{const{sampleSize:a,defaultSort:o}=r;if(e.setField("size",a),e.setField("sort",Object(H.c)(s,t,o)),i){e.removeField("fieldsFromSource");const t={field:"*",include_unmapped:"true"};e.setField("fields",[t])}else e.removeField("fields")})(s,this.searchProps.indexPattern,this.searchProps.sort,t,{sampleSize:this.services.uiSettings.get(C.SAMPLE_SIZE_SETTING),defaultSort:this.services.uiSettings.get(C.SORT_DEFAULT_ORDER_SETTING)}),this.inspectorAdapters.requests.reset(),this.searchProps.isLoading=!0,this.updateOutput({loading:!0,error:void 0});const i=this.input.executionContext,r={type:this.type,name:"discover",id:this.savedSearch.id,description:this.output.title||this.output.defaultTitle||"",url:this.output.editUrl},a=i?{...i,child:r}:r;try{const{rawResponse:t}=await s.fetch$({abortSignal:this.abortController.signal,sessionId:e,inspector:{adapter:this.inspectorAdapters.requests,title:h.i18n.translate("discover.embeddable.inspectorRequestDataTitle",{defaultMessage:"Data"}),description:h.i18n.translate("discover.embeddable.inspectorRequestDescription",{defaultMessage:"This request queries Elasticsearch to fetch the data for the search."})},executionContext:a}).toPromise();this.updateOutput({loading:!1,error:void 0}),this.searchProps.rows=t.hits.hits,this.searchProps.totalHitCount=t.hits.total,this.searchProps.isLoading=!1}catch(e){this.destroyed||(this.updateOutput({loading:!1,error:e}),this.searchProps.isLoading=!1)}})),this.executeTriggerActions=l,this.services=n,this.filterManager=o,this.savedSearch=e,this.inspectorAdapters={requests:new p.RequestAdapter},this.initializeSearchEmbeddableProps(),this.subscription=this.getUpdated$().subscribe((()=>{this.panelTitle=this.output.title||"",this.searchProps&&this.pushContainerStateParamsToProps(this.searchProps)}))}initializeSearchEmbeddableProps(){const{searchSource:e}=this.savedSearch,t=e.getField("index");if(!t)return;this.savedSearch.sort&&this.savedSearch.sort.length||(this.savedSearch.sort=Object(H.a)(t,this.services.uiSettings.get(C.SORT_DEFAULT_ORDER_SETTING,"desc")));const s={columns:this.savedSearch.columns,indexPattern:t,isLoading:!1,sort:Object(H.a)(t,this.services.uiSettings.get(C.SORT_DEFAULT_ORDER_SETTING,"desc")),rows:[],searchDescription:this.savedSearch.description,description:this.savedSearch.description,inspectorAdapters:this.inspectorAdapters,searchTitle:this.savedSearch.title,services:this.services,onAddColumn:e=>{if(!s.columns)return;const t=M.a(s.columns,e,!0);this.updateInput({columns:t})},onRemoveColumn:e=>{if(!s.columns)return;const t=M.d(s.columns,e,!0);this.updateInput({columns:t})},onMoveColumn:(e,t)=>{if(!s.columns)return;const i=M.c(s.columns,e,t);this.updateInput({columns:i})},onSetColumns:e=>{this.updateInput({columns:e})},onSort:e=>{const t=[];e.forEach((e=>{t.push(e)})),this.updateInput({sort:t})},sampleSize:500,onFilter:async(e,s,i)=>{let r=b.esFilters.generateFilters(this.filterManager,e,s,i,t.id);r=r.map((e=>({...e,$state:{store:b.esFilters.FilterStateStore.APP_STATE}}))),await this.executeTriggerActions(b.APPLY_FILTER_TRIGGER,{embeddable:this,filters:r})},useNewFieldsApi:!this.services.uiSettings.get(C.SEARCH_FIELDS_FROM_SOURCE,!1),showTimeCol:!this.services.uiSettings.get(C.DOC_HIDE_TIME_COLUMN_SETTING,!1),ariaLabelledBy:"documentsAriaLabel",rowHeightState:this.input.rowHeight||this.savedSearch.rowHeight,onUpdateRowHeight:e=>{this.updateInput({rowHeight:e})}},i=e.create();i.setField("filter",(()=>{if(this.searchProps&&this.input.timeRange)return this.services.timefilter.createFilter(t,this.input.timeRange)})),this.filtersSearchSource=e.create(),this.filtersSearchSource.setParent(i),e.setParent(this.filtersSearchSource),this.pushContainerStateParamsToProps(s),s.isLoading=!0,this.savedSearch.grid&&(s.settings=this.savedSearch.grid)}async pushContainerStateParamsToProps(e,{forceFetch:t=!1}={forceFetch:!1}){var s;const i=!(b.esFilters.onlyDisabledFiltersChanged(this.input.filters,this.prevFilters)&&Object(l.isEqual)(this.prevQuery,this.input.query)&&Object(l.isEqual)(this.prevTimeRange,this.input.timeRange)&&Object(l.isEqual)(e.sort,this.input.sort||this.savedSearch.sort)&&this.prevSearchSessionId===this.input.searchSessionId);e.columns=Object(z.a)({columns:this.input.columns||this.savedSearch.columns},this.services.core.uiSettings).columns;const r=this.savedSearch.sort&&this.savedSearch.sort.length?this.savedSearch.sort:Object(H.a)(null===(s=this.searchProps)||void 0===s?void 0:s.indexPattern,this.services.uiSettings.get(C.SORT_DEFAULT_ORDER_SETTING,"desc"));var a,o;(e.sort=this.input.sort||r,e.sharedItemTitle=this.panelTitle,e.rowHeightState=this.input.rowHeight||this.savedSearch.rowHeight,t||i)?(this.filtersSearchSource.setField("filter",this.input.filters),this.filtersSearchSource.setField("query",this.input.query),null!==(a=this.input.query)&&void 0!==a&&a.query||null!==(o=this.input.filters)&&void 0!==o&&o.length?this.filtersSearchSource.setField("highlightAll",!0):this.filtersSearchSource.removeField("highlightAll"),this.prevFilters=this.input.filters,this.prevQuery=this.input.query,this.prevTimeRange=this.input.timeRange,this.prevSearchSessionId=this.input.searchSessionId,this.searchProps=e,await this.fetch()):this.searchProps&&this.node&&(this.searchProps=e);this.node&&this.renderReactComponent(this.node,this.searchProps)}async render(e){if(!this.searchProps)throw new Error("Search props not defined");this.node&&c.a.unmountComponentAtNode(this.node),this.node=e}renderReactComponent(e,t){if(!this.searchProps)return;if(!0===this.services.uiSettings.get(C.SHOW_FIELD_STATISTICS)&&this.savedSearch.viewMode===q.b.AGGREGATED_LEVEL&&t.services&&t.indexPattern&&Array.isArray(t.columns))return void c.a.render(Object(x.jsx)(u.I18nProvider,null,Object(x.jsx)(N.KibanaThemeProvider,{theme$:t.services.core.theme.theme$},Object(x.jsx)(N.KibanaContextProvider,{services:t.services},Object(x.jsx)(G.a,{indexPattern:t.indexPattern,columns:t.columns,savedSearch:this.savedSearch,filters:this.input.filters,query:this.input.query,onAddFilter:t.onFilter,searchSessionId:this.input.searchSessionId})))),e);const s=this.services.uiSettings.get(C.DOC_TABLE_LEGACY),i={savedSearch:this.savedSearch,searchProps:t,useLegacyTable:s};t.services&&c.a.render(Object(x.jsx)(u.I18nProvider,null,Object(x.jsx)(N.KibanaThemeProvider,{theme$:t.services.core.theme.theme$},Object(x.jsx)(N.KibanaContextProvider,{services:t.services},Object(x.jsx)(L,i)))),e)}reload(){this.searchProps&&this.pushContainerStateParamsToProps(this.searchProps,{forceFetch:!0})}getSavedSearch(){return this.savedSearch}getInspectorAdapters(){return this.inspectorAdapters}getDescription(){return this.savedSearch.description}destroy(){var e;super.destroy(),this.searchProps&&delete this.searchProps,null===(e=this.subscription)||void 0===e||e.unsubscribe(),this.abortController&&this.abortController.abort()}}},87:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var i=s(3);const r=({initialPageSize:e,totalItems:t})=>{const[s,r]=Object(i.useState)(e),[a,o]=Object(i.useState)(0),n=Object(i.useMemo)((()=>{const e=Math.ceil(t/s);return{totalPages:e,startIndex:s*a,hasNextPage:a+1<e}}),[a,s,t]),c=Object(i.useCallback)((e=>o(e)),[]),h=Object(i.useCallback)((e=>r(e)),[]);return Object(i.useEffect)((()=>{n.totalPages<a+1&&c(0)}),[a,n.totalPages,c]),Object(i.useMemo)((()=>({...n,curPageIndex:a,pageSize:s,changePageIndex:c,changePageSize:h})),[c,h,a,n,s])}}}]);