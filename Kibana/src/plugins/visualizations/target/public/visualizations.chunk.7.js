(window.visualizations_bundle_jsonpfunction=window.visualizations_bundle_jsonpfunction||[]).push([[7],{53:function(t,e,i){"use strict";i.r(e),i.d(e,"Vis",(function(){return vis_Vis}));var s=i(0),n=i.n(s),r=i(5),a=i(2),o=i(59),h=i(27);function c(t,e,i){return void 0===e&&(Object(r.isPlainObject)(t)||i.length>0)&&(e=t,t=void 0),{value:Object(r.cloneDeep)(e),key:t}}class persisted_state_PersistedState extends o.EventEmitter{constructor(t,e){if(super(),n()(this,"_path",void 0),n()(this,"_initialized",void 0),n()(this,"_changedState",void 0),n()(this,"_defaultState",void 0),n()(this,"_mergedState",void 0),this._path=this.setPath(e),!this._path.length&&t&&!Object(r.isPlainObject)(t))throw new Error("State value must be a plain object");t=t||this.getDefault(),this.set(t),this._initialized=!0}get(t,e){return this.hasPath()||void 0!==t?Object(r.cloneDeep)(Object(r.get)(this._mergedState,this.getIndex(t||""),e)):this._mergedState}set(t,e){const i=c(t,e,this._path),s=this.setValue(i.key,i.value);return this.emit("set"),s}setSilent(t,e){const i=c(t,e,this._path);if(i.key||i.value)return this.setValue(i.key,i.value,!0)}clearAllKeys(){Object.getOwnPropertyNames(this._changedState).forEach((t=>{this.set(t,null)}))}reset(t){const e=this.getIndex(t),i=Object(r.get)(this._defaultState,e),s=Object(r.get)(this._mergedState,e);void 0===i?this.cleanPath(t,this._mergedState):Object(h.set)(this._mergedState,e,i),this.cleanPath(t,this._changedState),Object(r.isEqual)(s,i)||this.emit("change")}getChanges(){return Object(r.cloneDeep)(this._changedState)}toJSON(){return this.get()}toString(){return JSON.stringify(this.toJSON())}fromString(t){return this.set(JSON.parse(t))}getIndex(t){return void 0===t?this._path:[...this._path||[],...Object(r.toPath)(t)]}getPartialIndex(t){return this.getIndex(t).slice(this._path.length)}cleanPath(t,e){const i=this.getPartialIndex(t);let s=!0;if(Array.isArray(i))for(;i.length>0;){const t=i.splice(i.length-1,1)[0],n=[...this._path,i],a=n.length>0?Object(r.get)(e,n):e;if(!Object(r.isPlainObject)(a))return;s&&delete a[t],Object.keys(a).length>0&&(s=!1)}}getDefault(){return this.hasPath()?void 0:{}}setPath(t){return Array.isArray(t)?t:Object(r.isString)(t)?[...this.getIndex(t)]:[]}hasPath(){return this._path.length>0}setValue(t,e,i=!1){const s=this;let n=!1;const a=!this._initialized,o=this.getIndex(t),c=o.length>0;if(a&&(this._changedState={},this.hasPath()||void 0!==t?this._defaultState=Object(h.set)({},o,e):this._defaultState=e),!a)if(this.hasPath()||void 0!==t){const t=c?this.get(o):this._mergedState;n=!Object(r.isEqual)(t,e),Array.isArray(Object(r.get)(this._mergedState,o))&&(c?Object(h.set)(this._mergedState,o,void 0):this._mergedState=void 0),c?Object(h.set)(this._changedState,o,e):this._changedState=Object(r.isPlainObject)(e)?e:{}}else n=!Object(r.isEqual)(this._changedState,e),this._changedState=e,this._mergedState=Object(r.cloneDeep)(e);const u=this._mergedState||Object(r.cloneDeep)(this._defaultState),d=Object(r.merge)({},this._changedState);return this._mergedState=Object(r.mergeWith)(u,d,(function(t,e,i){if(!a&&Object(r.isEqual)(o,s.getIndex(i)))return void 0===e?t:e})),Object(r.isEqual)(this._mergedState,this._defaultState)&&(this._changedState={}),!i&&n&&this.emit("change",t),this}}var u=i(1),d=i(44);class vis_Vis{constructor(t,e={}){n()(this,"type",void 0),n()(this,"id",void 0),n()(this,"title",""),n()(this,"description",""),n()(this,"params",void 0),n()(this,"data",{}),n()(this,"uiState",void 0),this.type=this.getType(t),this.params=this.getParams(e.params),this.uiState=new persisted_state_PersistedState(e.uiState),this.id=e.id}getType(t){const e=Object(u.n)().get(t);if(!e){const e=a.i18n.translate("visualizations.visualizationTypeInvalidMessage",{defaultMessage:'Invalid visualization type "{visType}"',values:{visType:t}});throw new Error(e)}return e}getParams(t){var e,i;return Object(r.defaults)({},Object(r.cloneDeep)(null!=t?t:{}),Object(r.cloneDeep)(null!==(e=null===(i=this.type.visConfig)||void 0===i?void 0:i.defaults)&&void 0!==e?e:{}))}async setState(t){let e=t;const{updateVisTypeOnParamsChange:i}=this.type,s=i&&i(e.params);s&&(e={...t,type:s,params:{...t.params,type:s}});let n=!1;if(e.type&&this.type.name!==e.type&&(this.type=this.getType(e.type),n=!0),void 0!==e.title&&(this.title=e.title),void 0!==e.description&&(this.description=e.description),(e.params||n)&&(this.params=this.getParams(e.params)),e.data&&e.data.searchSource&&(this.data.searchSource=await Object(u.j)().searchSource.create(e.data.searchSource),this.data.indexPattern=this.data.searchSource.getField("index")),e.data&&e.data.savedSearchId&&(this.data.savedSearchId=e.data.savedSearchId,this.data.searchSource&&(this.data.searchSource=await(async(t,e)=>{if(e){const i=await Object(d.getSavedSearch)(e,{search:Object(u.j)(),savedObjectsClient:Object(u.i)().client,spaces:Object(u.k)()});await Object(d.throwErrorOnSavedSearchUrlConflict)(i),null!=i&&i.searchSource&&t.setParent(i.searchSource)}return t})(this.data.searchSource,this.data.savedSearchId),this.data.indexPattern=this.data.searchSource.getField("index"))),e.data&&(e.data.aggs||!this.data.aggs)){const t=e.data.aggs?Object(r.cloneDeep)(e.data.aggs):[],i=this.initializeDefaultsFromSchemas(t,this.type.schemas.all||[]);if(!this.data.indexPattern){if(t.length){const t=a.i18n.translate("visualizations.initializeWithoutIndexPatternErrorMessage",{defaultMessage:"Trying to initialize aggs without index pattern"});throw new Error(t)}return}this.data.aggs=Object(u.a)().createAggConfigs(this.data.indexPattern,i)}}clone(){const{data:t,...e}=this.serialize(),i=new vis_Vis(this.type.name,e);i.setState({...e,data:{}});const s=this.data.indexPattern?Object(u.a)().createAggConfigs(this.data.indexPattern,t.aggs):void 0;return i.data={...this.data,aggs:s},i}serialize(){const t=this.data.aggs?this.data.aggs.aggs.map((t=>t.serialize())):[];return{id:this.id,title:this.title,description:this.description,type:this.type.name,params:Object(r.cloneDeep)(this.params),uiState:this.uiState.toJSON(),data:{aggs:t,searchSource:this.data.searchSource?this.data.searchSource.getSerializedFields():{},...this.data.savedSearchId?{savedSearchId:this.data.savedSearchId}:{}}}}isHierarchical(){return Object(r.isFunction)(this.type.hierarchicalData)?!!this.type.hierarchicalData(this):!!this.type.hierarchicalData}initializeDefaultsFromSchemas(t,e){const i=[...t];return e.filter((t=>Array.isArray(t.defaults)&&t.defaults.length>0)).filter((e=>!t.find((t=>t.schema&&t.schema===e.name)))).forEach((t=>{t.defaults.slice(0,t.max).forEach((t=>i.push(t)))})),i}}e.default=vis_Vis},59:function(t,e,i){"use strict";var s,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};s=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var h=10;function c(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function u(t,e,i,s){var n,r,a,o;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(r=t._events)?(r=t._events=Object.create(null),t._eventsCount=0):(void 0!==r.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),r=t._events),a=r[e]),void 0===a)a=r[e]=i,++t._eventsCount;else if("function"==typeof a?a=r[e]=s?[i,a]:[a,i]:s?a.unshift(i):a.push(i),(n=c(t))>0&&a.length>n&&!a.warned){a.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=a.length,o=h,console&&console.warn&&console.warn(o)}return t}function d(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,r(this.listener,this.target,t))}function l(t,e,i){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},n=d.bind(s);return n.listener=i,s.wrapFn=n,n}function p(t,e,i){var s=t._events;if(void 0===s)return[];var n=s[e];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(n):v(n,n.length)}function f(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function v(t,e){for(var i=new Array(e),s=0;s<e;++s)i[s]=t[s];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");h=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var s="error"===t,n=this._events;if(void 0!==n)s=s&&void 0===n.error;else if(!s)return!1;if(s){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var h=n[t];if(void 0===h)return!1;if("function"==typeof h)r(h,this,e);else{var c=h.length,u=v(h,c);for(i=0;i<c;++i)r(u[i],this,e)}return!0},o.prototype.addListener=function(t,e){return u(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return u(this,t,e,!0)},o.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,l(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,l(this,t,e)),this},o.prototype.removeListener=function(t,e){var i,s,n,r,a;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(s=this._events))return this;if(void 0===(i=s[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(n=-1,r=i.length-1;r>=0;r--)if(i[r]===e||i[r].listener===e){a=i[r].listener,n=r;break}if(n<0)return this;0===n?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,n),1===i.length&&(s[t]=i[0]),void 0!==s.removeListener&&this.emit("removeListener",t,a||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,i,s;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var n,r=Object.keys(i);for(s=0;s<r.length;++s)"removeListener"!==(n=r[s])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this},o.prototype.listeners=function(t){return p(this,t,!0)},o.prototype.rawListeners=function(t){return p(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):f.call(t,e)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]}}}]);