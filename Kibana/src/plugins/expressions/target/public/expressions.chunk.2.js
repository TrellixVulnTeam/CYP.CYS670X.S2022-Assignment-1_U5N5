(window.expressions_bundle_jsonpfunction=window.expressions_bundle_jsonpfunction||[]).push([[2,3,8],{101:function(e,t,r){e.exports=r(24)(3)},102:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(55),n=r(103),i=s.__importDefault(r(104)),o=function(e,t){return e.every((function(e,r){return n.equal(e,t[r])}))};t.default=function(e,t){i.default(e,t,o)}},103:function(e,t){var r=Object.keys;t.equal=function(e,t){if(e===t)return!0;if(!(e instanceof Object&&t instanceof Object))return!1;for(var s=r(e),n=s.length,i=0;i<n;i++)if(!(s[i]in t))return!1;for(i=0;i<n;i++)if(e[s[i]]!==t[s[i]])return!1;return n===r(t).length}},104:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(21);t.default=function(e,t,r){var n=s.useRef(void 0);n.current&&r(t,n.current)||(n.current=t),s.useEffect(e,n.current)}},110:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return j}));var s=r(101),n=r.n(s),i=r(21),o=r(53),a=r.n(o),d=r(4),u=r(102),c=r.n(u),l=r(30),h=r(54),b=r(58),p=r(17);const v={isEmpty:!0,isLoading:!1,error:null};function j({className:e,dataAttrs:t,padding:r,renderError:s,expression:o,onEvent:u,onData$:j,onRender$:x,reload$:f,debounce:m,...E}){const S=Object(i.useRef)(null),[g,y]=Object(i.useState)({...v}),O=!!s,R=Object(i.useRef)(null),$=Object(i.useRef)(!1),C=Object(i.useRef)(null),[w,_]=Object(i.useState)(o),[H,A]=Object(i.useState)(!1),L=Object(i.useRef)(!0);c()((()=>{if(L.current)return void(L.current=!1);if(void 0===m)return;A(!0);const e=setTimeout((()=>{_(o),A(!1)}),m);return()=>{clearTimeout(e)}}),[o,E,m]);const M=void 0!==m?w:o;Object(i.useEffect)((()=>{const e=[];return R.current=new b.ExpressionLoader(S.current,M,{...E,onRenderError:O?(e,t,r)=>{C.current=r,y((()=>({...v,isEmpty:!1,error:t}))),E.onRenderError&&E.onRenderError(e,t,r)}:E.onRenderError}),u&&e.push(R.current.events$.subscribe((e=>{u(e)}))),j&&e.push(R.current.data$.subscribe((({partial:e,result:t})=>{var r;j(t,null===(r=R.current)||void 0===r?void 0:r.inspect(),e)}))),e.push(R.current.loading$.subscribe((()=>{$.current=!1,y((e=>({...e,isLoading:!0})))})),R.current.render$.pipe(Object(d.filter)((()=>!$.current))).subscribe((e=>{y((()=>({...v,isEmpty:!1}))),null==x||x(e)}))),()=>{e.forEach((e=>e.unsubscribe())),R.current&&(R.current.destroy(),R.current=null),C.current=null}}),[O,u,E.interactive,E.renderMode,E.syncColors]),Object(i.useEffect)((()=>{const e=null==f?void 0:f.subscribe((()=>{R.current&&R.current.update(M,E)}));return()=>null==e?void 0:e.unsubscribe()}),[f,M,...Object.values(E)]),c()((()=>{R.current&&!H&&R.current.update(M,E)}),void 0===m?[{activeExpression:M,...E}]:[{waitingForDebounceToComplete:H}]),Object(i.useLayoutEffect)((()=>{g.error&&C.current&&($.current=!0,C.current.done(),C.current=null)}),[g.error]);const P=a()("expExpressionRenderer",e,{"expExpressionRenderer-isEmpty":g.isEmpty,"expExpressionRenderer-hasError":!!g.error}),D={};return r&&(D.padding=h.euiLightVars.paddingSizes[r]),Object(p.jsx)("div",n()({},t,{className:P}),g.isEmpty&&Object(p.jsx)(l.EuiLoadingChart,{mono:!0,size:"l"}),(g.isLoading||H)&&Object(p.jsx)(l.EuiProgress,{size:"xs",color:"accent",position:"absolute"}),!g.isLoading&&g.error&&s&&s(g.error.message,g.error),Object(p.jsx)("div",{className:"expExpressionRenderer__expression",style:D,ref:S}))}},56:function(e,t,r){"use strict";r.r(t),r.d(t,"ExpressionRenderHandler",(function(){return render_ExpressionRenderHandler})),r.d(t,"render",(function(){return l}));var s=r(0),n=r.n(s),i=r(2),o=r(4),a=r(3),d=r(1),u=r(10);const c=(e,t,r)=>{"AbortError"!==t.name?(Object(u.c)().toasts.addError(t,{title:d.i18n.translate("expressions.defaultErrorRenderer.errorTitle",{defaultMessage:"Error in visualisation"}),toastMessage:t.message}),r.done()):r.done()};class render_ExpressionRenderHandler{constructor(e,{onRenderError:t,renderMode:r,syncColors:s,interactive:d,hasCompatibleActions:l=(async()=>!1)}={}){n()(this,"render$",void 0),n()(this,"update$",void 0),n()(this,"events$",void 0),n()(this,"element",void 0),n()(this,"destroyFn",void 0),n()(this,"renderCount",0),n()(this,"renderSubject",void 0),n()(this,"eventsSubject",void 0),n()(this,"updateSubject",void 0),n()(this,"handlers",void 0),n()(this,"onRenderError",void 0),n()(this,"render",(async(e,t)=>{if(!e||"object"!=typeof e)return this.handleRenderError(new Error("invalid data provided to the expression renderer"));if("render"!==e.type||!e.as)return"error"===e.type?this.handleRenderError(e.error):this.handleRenderError(new Error("invalid data provided to the expression renderer"));if(!Object(u.d)().get(e.as))return this.handleRenderError(new Error(`invalid renderer id '${e.as}'`));try{await Object(u.d)().get(e.as).render(this.element,e.value,{...this.handlers,uiState:t})}catch(e){return this.handleRenderError(e)}})),n()(this,"destroy",(()=>{this.renderSubject.complete(),this.eventsSubject.complete(),this.updateSubject.complete(),this.destroyFn&&this.destroyFn()})),n()(this,"getElement",(()=>this.element)),n()(this,"handleRenderError",(e=>{this.onRenderError(this.element,e,this.handlers)})),this.element=e,this.eventsSubject=new i.Subject,this.events$=this.eventsSubject.asObservable(),this.onRenderError=t||c,this.renderSubject=new i.BehaviorSubject(null),this.render$=this.renderSubject.asObservable().pipe(Object(o.filter)(a.isNumber)),this.updateSubject=new i.Subject,this.update$=this.updateSubject.asObservable(),this.handlers={onDestroy:e=>{this.destroyFn=e},done:()=>{this.renderCount++,this.renderSubject.next(this.renderCount)},reload:()=>{this.updateSubject.next(null)},update:e=>{this.updateSubject.next(e)},event:e=>{this.eventsSubject.next(e)},getRenderMode:()=>r||"view",isSyncColorsEnabled:()=>s||!1,isInteractive:()=>null==d||d,hasCompatibleActions:l}}}const l=async(e,t,r)=>{const s=new render_ExpressionRenderHandler(e,r);return s.render(t),s}},58:function(e,t,r){"use strict";r.r(t),r.d(t,"ExpressionLoader",(function(){return ExpressionLoader})),r.d(t,"loader",(function(){return c}));var s=r(0),n=r.n(s),i=r(2),o=r(4),a=r(3),d=r(56),u=r(10);class ExpressionLoader{constructor(e,t,r){n()(this,"data$",void 0),n()(this,"update$",void 0),n()(this,"render$",void 0),n()(this,"events$",void 0),n()(this,"loading$",void 0),n()(this,"execution",void 0),n()(this,"renderHandler",void 0),n()(this,"dataSubject",void 0),n()(this,"loadingSubject",void 0),n()(this,"data",void 0),n()(this,"params",{}),n()(this,"subscription",void 0),n()(this,"loadData",((e,t)=>{var r;null===(r=this.subscription)||void 0===r||r.unsubscribe(),this.execution&&this.execution.isPending&&this.execution.cancel(),this.setParams(t),this.execution=Object(u.b)().execute(e,t.context,{searchContext:t.searchContext,variables:t.variables||{},inspectorAdapters:t.inspectorAdapters,searchSessionId:t.searchSessionId,debug:t.debug,syncColors:t.syncColors,executionContext:t.executionContext}),this.subscription=this.execution.getData().pipe(Object(o.delay)(0),Object(o.filter)((({partial:e})=>t.partial||!e)),t.partial&&t.throttle?Object(o.throttleTime)(t.throttle,i.asyncScheduler,{leading:!0,trailing:!0}):i.identity).subscribe((e=>this.dataSubject.next(e)))})),this.dataSubject=new i.Subject,this.data$=this.dataSubject.asObservable(),this.loadingSubject=new i.BehaviorSubject(!1),this.loading$=this.loadingSubject.asObservable().pipe(Object(o.filter)((e=>!0===e)),Object(o.map)((()=>{}))),this.renderHandler=new d.ExpressionRenderHandler(e,{interactive:null==r?void 0:r.interactive,onRenderError:r&&r.onRenderError,renderMode:null==r?void 0:r.renderMode,syncColors:null==r?void 0:r.syncColors,hasCompatibleActions:null==r?void 0:r.hasCompatibleActions}),this.render$=this.renderHandler.render$,this.update$=this.renderHandler.update$,this.events$=this.renderHandler.events$,this.update$.subscribe((e=>{if(e){const{newExpression:t,newParams:r}=e;this.update(t,r)}})),this.data$.subscribe((({result:e})=>{this.render(e)})),this.render$.subscribe((()=>{this.loadingSubject.next(!1)})),this.setParams(r),t&&(this.loadingSubject.next(!0),this.loadData(t,this.params))}destroy(){var e;this.dataSubject.complete(),this.loadingSubject.complete(),this.renderHandler.destroy(),this.cancel(),null===(e=this.subscription)||void 0===e||e.unsubscribe()}cancel(){var e;null===(e=this.execution)||void 0===e||e.cancel()}getExpression(){var e;return null===(e=this.execution)||void 0===e?void 0:e.getExpression()}getAst(){var e;return null===(e=this.execution)||void 0===e?void 0:e.getAst()}getElement(){return this.renderHandler.getElement()}inspect(){var e;return null===(e=this.execution)||void 0===e?void 0:e.inspect()}update(e,t){this.setParams(t),this.loadingSubject.next(!0),e?this.loadData(e,this.params):this.data&&this.render(this.data)}render(e){this.renderHandler.render(e,this.params.uiState)}setParams(e){var t,r;e&&Object.keys(e).length&&(e.searchContext&&(this.params.searchContext=Object(a.defaults)({},e.searchContext,this.params.searchContext||{})),e.uiState&&this.params&&(this.params.uiState=e.uiState),e.variables&&this.params&&(this.params.variables=e.variables),e.searchSessionId&&this.params&&(this.params.searchSessionId=e.searchSessionId),this.params.syncColors=e.syncColors,this.params.debug=Boolean(e.debug),this.params.partial=Boolean(e.partial),this.params.throttle=Number(null!==(t=e.throttle)&&void 0!==t?t:1e3),this.params.inspectorAdapters=e.inspectorAdapters||(null===(r=this.execution)||void 0===r?void 0:r.inspect()),this.params.executionContext=e.executionContext)}}const c=async(e,t,r)=>new ExpressionLoader(e,t,r)}}]);